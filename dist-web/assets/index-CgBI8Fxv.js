import{j as e,a as Ie,r as N,L as G,g as st,f as It}from"./vendor-router-D4Yqsbqz.js";import{A as at,B as nt,E as it,F as rt,G as lt,u as ot,a as ct,f as kt,H as dt,T as ee,D as St,S as Ct,j as Z,l as X,m as mt,n as ut,I as Mt,J as Ve,K as ht,L as we,M as At,v as Tt,N as Rt,O as Et,P as Pt,Q as Ft,R as _t,U as he,V as Lt,c as se,W as Bt}from"./index-D5Ndap8n.js";/* empty css              */import{E as Vt}from"./EmptyState-r3axvhwz.js";import{R as $t}from"./RowActionsMenu-L_ZpjB9G.js";import{S as re,V as M,I as qt,T as g,D as Wt,P as Ot,p as Ut,a as ke}from"./fonts-B2QO5WSf.js";import{u as zt}from"./vendor-query-CI0tl4qS.js";import{u as Kt,f as Ht,C as _,o as Se,c as q,e as $e,d as xt,n as oe,_ as ce}from"./vendor-forms-Bf8hyTk9.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-db-BMy7eggi.js";/* empty css                       */import"./_commonjs-dynamic-modules-TDtrdbi3.js";function pt({size:t=24,className:c}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:c,children:[e.jsx("rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}function qe({size:t=16,className:c}){return e.jsx("svg",{width:t,height:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:c,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})})}const Yt={invoice:"Invoice",receipt:"Receipt",invoice_receipt:"Invoice Receipt",credit_note:"Credit Note",price_offer:"Price Offer",proforma_invoice:"Proforma",donation_receipt:"Donation"},We={draft:{label:"Draft",className:"badge badge-muted"},issued:{label:"Issued",className:"badge badge-warning"},paid:{label:"Paid",className:"badge badge-success"},voided:{label:"Voided",className:"badge badge-danger"}};function Ds(){const t=Ie(),c=at(),m=nt(),p=it(),o=rt(),h=lt(),j=ot(),{language:l}=ct(),k=ut(l),[S,b]=N.useState(()=>kt("all")),[x,D]=N.useState(void 0),[i,a]=N.useState(void 0),[y,u]=N.useState(""),[E,n]=N.useState(!1),P=N.useMemo(()=>({dateFrom:S.dateFrom,dateTo:S.dateTo,type:x,status:i,search:y||void 0,sort:{by:"issueDate",dir:"desc"},includeArchived:E}),[S,x,i,y,E]),{data:C=[],isLoading:L}=dt(P),A=d=>{t({to:"/documents/$documentId",params:{documentId:d}})};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Documents",filterSlot:e.jsx("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24,flexWrap:"nowrap"},children:e.jsx(St,{dateFrom:S.dateFrom,dateTo:S.dateTo,onChange:(d,U)=>b({dateFrom:d,dateTo:U})})})}),e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"filters-row",children:[e.jsxs("select",{className:"select",value:x||"",onChange:d=>D(d.target.value||void 0),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"invoice",children:"Invoice"}),e.jsx("option",{value:"receipt",children:"Receipt"}),e.jsx("option",{value:"invoice_receipt",children:"Invoice Receipt"}),e.jsx("option",{value:"credit_note",children:"Credit Note"}),e.jsx("option",{value:"price_offer",children:"Price Offer"}),e.jsx("option",{value:"proforma_invoice",children:"Proforma Invoice"}),e.jsx("option",{value:"donation_receipt",children:"Donation Receipt"})]}),e.jsxs("select",{className:"select",value:i||"",onChange:d=>a(d.target.value||void 0),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"voided",children:"Voided"})]}),e.jsx(Ct,{value:y,onChange:u,placeholder:"Search documents..."}),e.jsxs("label",{className:"toggle-label",style:{marginInlineStart:"auto"},children:[e.jsx("input",{type:"checkbox",checked:E,onChange:d=>n(d.target.checked)}),e.jsx("span",{children:"Show Archived"})]})]}),L?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):C.length===0?e.jsx(Vt,{title:"No documents yet",description:y?"No documents match your search":"Create your first document to get started",action:{label:"New Document",onClick:()=>t({to:"/documents/new"})}}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Number"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Client"}),e.jsx("th",{children:"Issue Date"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{style:{textAlign:"end"},children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:C.map(d=>e.jsxs("tr",{className:"clickable",onClick:()=>A(d.id),children:[e.jsx("td",{children:e.jsx(G,{to:"/documents/$documentId",params:{documentId:d.id},onClick:U=>U.stopPropagation(),className:"link",children:d.number})}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-muted",children:Yt[d.type]})}),e.jsx("td",{className:"text-secondary",children:d.clientName||"-"}),e.jsx("td",{children:Z(d.issueDate,k)}),e.jsx("td",{className:"text-secondary",children:d.dueDate?Z(d.dueDate,k):"-"}),e.jsx("td",{className:"amount-cell amount-positive",children:X(d.totalMinor,d.currency,k)}),e.jsxs("td",{children:[e.jsx("span",{className:We[d.status].className,children:We[d.status].label}),d.lockedAt&&e.jsx(pt,{size:12,className:"inline-icon text-muted"}),d.archivedAt&&e.jsx("span",{className:"badge badge-warning",style:{marginInlineStart:4},children:"Archived"})]}),e.jsx("td",{children:e.jsx($t,{actions:[{label:"View",onClick:()=>{t({to:"/documents/$documentId",params:{documentId:d.id}})}},{label:"Create Similar",onClick:()=>{t({to:"/documents/new",search:{duplicateFrom:d.id}})}},...d.status==="draft"&&!d.lockedAt?[{label:"Issue Document",onClick:()=>p.mutate(d.id)}]:[],...d.status==="issued"&&d.type==="invoice"?[{label:j("common.markPaid"),icon:e.jsx(mt,{size:16}),onClick:()=>c.mutate(d.id)}]:[],...d.status==="issued"&&!d.lockedAt?[{label:"Void",variant:"danger",onClick:()=>{confirm("Are you sure you want to void this document?")&&m.mutate(d.id)}}]:[],...d.status==="paid"&&d.type==="invoice"?[{label:"Create Credit Note",onClick:()=>t({to:"/documents/new"})}]:[],...d.archivedAt?[{label:"Unarchive",onClick:()=>h.mutate(d.id)}]:[{label:"Archive",onClick:()=>o.mutate(d.id)}]]})})]},d.id))})]})})]})]})}const jt={ar:{item:"بند",subject:"موضوع",quantity:"كمية",rate:"سعر",price:"مجموع",subtotal:"المجموع الفرعي",tax:"ضريبة",discount:"خصم",total:"المجموع",notes:"ملاحظات",issued:"تاريخ الإصدار",due:"تاريخ الاستحقاق",original:"الأصل",copy:"نسخة طبق الأصل",invoice:"فاتورة",receipt:"سند قبض",invoice_receipt:"فاتورة/إيصال",credit_note:"إشعار دائن",price_offer:"عرض سعر",proforma_invoice:"فاتورة أولية",donation_receipt:"سند تبرّع",to:"إلى",from:"من",bill_to:"فاتورة إلى",payment_method:"طريقة الدفع",cash:"نقداً",bank_transfer:"تحويل بنكي",cheque:"شيك",credit_card:"بطاقة ائتمان",other:"أخرى",digitally_certified:"موثّق رقمياً",page_of:"صفحة {0} من {1}",bank_details:"تفاصيل الحساب البنكي",bank_name:"البنك",branch:"الفرع",account:"رقم الحساب",iban:"IBAN",payment_instructions:"تعليمات الدفع"},en:{item:"Item",subject:"Subject",quantity:"Qty",rate:"Rate",price:"Price",subtotal:"Subtotal",tax:"Tax",discount:"Discount",total:"Total",notes:"Notes",issued:"Issue Date",due:"Due Date",original:"Original",copy:"Certified Copy",invoice:"Invoice",receipt:"Receipt",invoice_receipt:"Invoice Receipt",credit_note:"Credit Note",price_offer:"Price Offer",proforma_invoice:"Proforma Invoice",donation_receipt:"Donation Receipt",to:"To",from:"From",bill_to:"Bill To",payment_method:"Payment Method",cash:"Cash",bank_transfer:"Bank Transfer",cheque:"Cheque",credit_card:"Credit Card",other:"Other",digitally_certified:"Digitally Certified",page_of:"Page {0} of {1}",bank_details:"Bank Details",bank_name:"Bank",branch:"Branch",account:"Account",iban:"IBAN",payment_instructions:"Payment Instructions"}};function bt(t){return jt[t]}function Qt(t,c){return jt[c][t]}const te={page:{padding:"20mm",fontSize:12,lineHeight:1.5,display:"flex",flexDirection:"column",justifyContent:"space-between"},header:{marginBottom:12,fontWeight:700},tableHeader:{flexDirection:"row",borderBottom:"1px solid #000000",paddingBottom:8,marginBottom:4},tableRow:{flexDirection:"row",paddingVertical:4,borderBottom:"0.5px solid #e0e0e0"},tableCell:{padding:4},text:{fontWeight:"normal",fontSize:12},textBold:{fontWeight:600,fontSize:12},notes:{fontSize:11,marginTop:20,padding:10,backgroundColor:"#f5f5f5",borderRadius:4},footer:{marginTop:"auto",paddingTop:20,borderTop:"1px solid #e0e0e0",fontSize:10,color:"#666666"}},Oe=re.create({...te,page:{...te.page,backgroundColor:"#ffffff"},headerRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:20},businessInfo:{maxWidth:"50%"},documentInfo:{textAlign:"right"},clientSection:{marginTop:20,marginBottom:20,padding:12,backgroundColor:"#f9f9f9",borderRadius:4},itemsTable:{marginTop:20},summarySection:{marginTop:30,alignItems:"flex-end"},summaryRow:{flexDirection:"row",justifyContent:"flex-end",paddingVertical:4,minWidth:200},summaryLabel:{width:100,textAlign:"right",paddingRight:10},summaryValue:{width:100,textAlign:"right",fontWeight:600},totalRow:{flexDirection:"row",justifyContent:"flex-end",paddingVertical:8,minWidth:200,borderTop:"1px solid #000000",marginTop:4},documentLabel:{textAlign:"center",fontSize:10,color:"#666666",marginTop:10}}),Gt=re.create({...te,page:{...te.page,backgroundColor:"#ffffff"},accentBar:{position:"absolute",top:0,left:0,right:0,height:8},headerRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:20,marginTop:10},businessInfo:{maxWidth:"50%"},documentInfo:{textAlign:"right"},clientSection:{marginTop:20,marginBottom:20,padding:12,borderLeft:"3px solid"},itemsTable:{marginTop:20},summarySection:{marginTop:30,alignItems:"flex-end"},summaryRow:{flexDirection:"row",justifyContent:"flex-end",paddingVertical:4,minWidth:200},summaryLabel:{width:100,textAlign:"right",paddingRight:10},summaryValue:{width:100,textAlign:"right",fontWeight:600},totalRow:{flexDirection:"row",justifyContent:"flex-end",paddingVertical:8,minWidth:200,marginTop:4},documentLabel:{textAlign:"center",fontSize:10,color:"#666666",marginTop:10}}),Jt=re.create({...te,page:{...te.page,fontSize:14,backgroundColor:"#ffffff"},headerRow:{flexDirection:"row",justifyContent:"space-between",marginBottom:30},businessInfo:{maxWidth:"50%"},documentInfo:{textAlign:"right"},clientSection:{marginTop:30,marginBottom:30},itemsTable:{marginTop:30},summarySection:{marginTop:40,alignItems:"flex-end"},summaryRow:{flexDirection:"row",justifyContent:"flex-end",paddingVertical:6,minWidth:250},summaryLabel:{width:120,textAlign:"right",paddingRight:15,fontSize:14},summaryValue:{width:120,textAlign:"right",fontWeight:600,fontSize:14},totalRow:{flexDirection:"row",justifyContent:"flex-end",paddingVertical:10,minWidth:250,borderTop:"2px solid #000000",marginTop:6},documentLabel:{textAlign:"center",fontSize:12,color:"#666666",marginTop:15},text:{...te.text,fontSize:14},notes:{...te.notes,fontSize:13}});function Xt(t){switch(t){case"template1":return Oe;case"template2":return Gt;case"template3":return Jt;default:return Oe}}function Ce(t){return t==="ar"?"IBMPlexSansArabic":"IBMPlexSans"}function Me(t){return t==="ar"?"right":"left"}const B=re.create({header:{flexDirection:"row",justifyContent:"space-between",marginBottom:20,paddingBottom:15,borderBottomWidth:1,borderBottomColor:"#e5e7eb"},headerRtl:{flexDirection:"row-reverse"},logoSection:{flexDirection:"row",alignItems:"center",gap:12},logoSectionRtl:{flexDirection:"row-reverse"},logo:{width:50,height:50,objectFit:"contain"},businessInfo:{flexDirection:"column"},businessName:{fontSize:16,fontWeight:700,marginBottom:2},businessDetail:{fontSize:9,color:"#666666",marginTop:1},contactInfo:{flexDirection:"column",alignItems:"flex-end"},contactInfoRtl:{alignItems:"flex-start"},contactText:{fontSize:9,color:"#666666",marginTop:1}});function Zt({businessProfile:t,language:c}){const m=c==="ar",p=Ce(c),o=Me(c),h=c==="ar"?t.name:t.nameEn||t.name,j=c==="ar"?t.address1:t.address1En||t.address1,l=c==="ar"?t.city:t.cityEn||t.city,k=!!t.logoDataUrl;return e.jsxs(M,{style:m?[B.header,B.headerRtl]:B.header,children:[e.jsxs(M,{style:m?[B.logoSection,B.logoSectionRtl]:B.logoSection,children:[k&&e.jsx(qt,{src:t.logoDataUrl,style:B.logo}),e.jsxs(M,{style:B.businessInfo,children:[e.jsx(g,{style:[B.businessName,{fontFamily:p,textAlign:o}],children:h}),j&&e.jsx(g,{style:[B.businessDetail,{fontFamily:p,textAlign:o}],children:j}),l&&e.jsx(g,{style:[B.businessDetail,{fontFamily:p,textAlign:o}],children:l})]})]}),e.jsxs(M,{style:m?[B.contactInfo,B.contactInfoRtl]:B.contactInfo,children:[t.email&&e.jsx(g,{style:[B.contactText,{fontFamily:p}],children:t.email}),t.phone&&e.jsx(g,{style:[B.contactText,{fontFamily:p}],children:t.phone}),t.website&&e.jsx(g,{style:[B.contactText,{fontFamily:p}],children:t.website}),t.taxId&&e.jsx(g,{style:[B.contactText,{fontFamily:p}],children:t.taxId})]})]})}const R=re.create({footer:{position:"absolute",bottom:30,left:40,right:40,borderTopWidth:1,borderTopColor:"#e5e7eb",paddingTop:12},footerContent:{flexDirection:"column",gap:8},bankDetailsSection:{marginBottom:8},bankDetailsTitle:{fontSize:9,fontWeight:600,marginBottom:4,color:"#374151"},bankDetailsGrid:{flexDirection:"row",flexWrap:"wrap",gap:4},bankDetailItem:{flexDirection:"row",marginRight:16},bankDetailLabel:{fontSize:8,color:"#666666",marginRight:4},bankDetailValue:{fontSize:8,color:"#374151"},paymentNotes:{fontSize:8,color:"#666666",marginTop:4,fontStyle:"italic"},contactRow:{flexDirection:"row",justifyContent:"center",flexWrap:"wrap",gap:16},contactItem:{fontSize:8,color:"#666666"},pageNumber:{position:"absolute",bottom:0,right:0,fontSize:8,color:"#9ca3af"}}),es=["invoice","proforma_invoice","invoice_receipt"];function ts({businessProfile:t,language:c,documentType:m,showBankDetails:p}){const o=bt(c),h=Ce(c),j=Me(c),l=c==="ar",k=p!==void 0?p:es.includes(m),S=t.bankName||t.bankBranch||t.bankAccountNumber||t.bankIban,b=c==="ar"?t.address1:t.address1En||t.address1,x=c==="ar"?t.city:t.cityEn||t.city,D=[b,x].filter(Boolean).join(", ");return e.jsxs(M,{style:R.footer,children:[e.jsxs(M,{style:R.footerContent,children:[k&&S&&e.jsxs(M,{style:R.bankDetailsSection,children:[e.jsx(g,{style:[R.bankDetailsTitle,{fontFamily:h,textAlign:j}],children:o.bank_details}),e.jsxs(M,{style:[R.bankDetailsGrid,{flexDirection:l?"row-reverse":"row"}],children:[t.bankName&&e.jsxs(M,{style:[R.bankDetailItem,{flexDirection:l?"row-reverse":"row"}],children:[e.jsxs(g,{style:[R.bankDetailLabel,{fontFamily:h}],children:[o.bank_name,":"]}),e.jsx(g,{style:[R.bankDetailValue,{fontFamily:h}],children:t.bankName})]}),t.bankBranch&&e.jsxs(M,{style:[R.bankDetailItem,{flexDirection:l?"row-reverse":"row"}],children:[e.jsxs(g,{style:[R.bankDetailLabel,{fontFamily:h}],children:[o.branch,":"]}),e.jsx(g,{style:[R.bankDetailValue,{fontFamily:h}],children:t.bankBranch})]}),t.bankAccountNumber&&e.jsxs(M,{style:[R.bankDetailItem,{flexDirection:l?"row-reverse":"row"}],children:[e.jsxs(g,{style:[R.bankDetailLabel,{fontFamily:h}],children:[o.account,":"]}),e.jsx(g,{style:[R.bankDetailValue,{fontFamily:h}],children:t.bankAccountNumber})]}),t.bankIban&&e.jsxs(M,{style:[R.bankDetailItem,{flexDirection:l?"row-reverse":"row"}],children:[e.jsxs(g,{style:[R.bankDetailLabel,{fontFamily:h}],children:[o.iban,":"]}),e.jsx(g,{style:[R.bankDetailValue,{fontFamily:h}],children:t.bankIban})]})]}),t.paymentNotes&&e.jsx(g,{style:[R.paymentNotes,{fontFamily:h,textAlign:j}],children:t.paymentNotes})]}),e.jsxs(M,{style:[R.contactRow,{flexDirection:l?"row-reverse":"row"}],children:[t.email&&e.jsx(g,{style:[R.contactItem,{fontFamily:h}],children:t.email}),t.phone&&e.jsx(g,{style:[R.contactItem,{fontFamily:h}],children:t.phone}),D&&e.jsx(g,{style:[R.contactItem,{fontFamily:h}],children:D})]})]}),e.jsx(g,{style:R.pageNumber,render:({pageNumber:i,totalPages:a})=>o.page_of.replace("{0}",String(i)).replace("{1}",String(a)),fixed:!0})]})}function ie(t,c){const m=t/100,o={USD:"$",ILS:"₪",EUR:"€"}[c]||"",h=m.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return`${o}${h}`}function Ue(t){return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})}function xe({document:t,businessProfile:c,client:m,templateId:p="template1",isOriginal:o=!0}){const h=t.language,j=bt(h),l=Xt(p),k=Ce(h),S=Me(h),b=h==="ar",x=re.create({page:{fontFamily:k},text:{fontFamily:k,textAlign:S},headerRow:{flexDirection:b?"row-reverse":"row"},tableHeader:{flexDirection:b?"row-reverse":"row"},tableRow:{flexDirection:b?"row-reverse":"row"}});return e.jsx(Wt,{children:e.jsxs(Ot,{size:"A4",style:[l.page,x.page],children:[p==="template2"&&e.jsx(M,{style:[l.accentBar,{backgroundColor:c.primaryColor||"#3b82f6"}]}),e.jsx(Zt,{businessProfile:c,language:h}),e.jsx(M,{style:[l.headerRow,x.headerRow,{marginBottom:15}],children:e.jsxs(M,{style:l.documentInfo,children:[e.jsxs(g,{style:[x.text,{fontWeight:700,fontSize:18,marginBottom:8}],children:[Qt(t.type,h)," #",t.number]}),e.jsxs(g,{style:[x.text,{fontSize:11}],children:[j.issued,": ",Ue(t.issueDate)]}),t.dueDate&&e.jsxs(g,{style:[x.text,{fontSize:11}],children:[j.due,": ",Ue(t.dueDate)]})]})}),(t.subject||t.brief)&&e.jsxs(M,{style:{marginBottom:15},children:[t.subject&&e.jsx(g,{style:[x.text,{fontWeight:600,marginBottom:4}],children:t.subject}),t.brief&&e.jsx(g,{style:[x.text,{fontSize:11,color:"#666666"}],children:t.brief})]}),m&&e.jsxs(M,{style:[l.clientSection,...p==="template2"?[{borderLeftColor:c.primaryColor||"#3b82f6"}]:[]],children:[e.jsxs(g,{style:[x.text,{fontSize:10,color:"#666666",marginBottom:4}],children:[j.bill_to,":"]}),e.jsx(g,{style:[x.text,{fontWeight:600}],children:m.name}),m.email&&e.jsx(g,{style:[x.text,{fontSize:11}],children:m.email}),m.phone&&e.jsx(g,{style:[x.text,{fontSize:11}],children:m.phone})]}),e.jsx(M,{style:l.documentLabel,children:e.jsx(g,{children:o?j.original.toUpperCase():j.copy.toUpperCase()})}),e.jsxs(M,{style:l.itemsTable,children:[e.jsxs(M,{style:[l.tableHeader,x.tableHeader],children:[e.jsx(g,{style:[x.text,{width:"45%",fontWeight:600}],children:j.item}),e.jsx(g,{style:[x.text,{width:"15%",textAlign:"center",fontWeight:600}],children:j.quantity}),e.jsx(g,{style:[x.text,{width:"20%",textAlign:"right",fontWeight:600}],children:j.rate}),e.jsx(g,{style:[x.text,{width:"20%",textAlign:"right",fontWeight:600}],children:j.price})]}),t.items.map((D,i)=>{const a=D.quantity*D.rateMinor;return e.jsxs(M,{style:[l.tableRow,x.tableRow],children:[e.jsx(g,{style:[x.text,{width:"45%"}],children:D.name}),e.jsx(g,{style:[x.text,{width:"15%",textAlign:"center"}],children:D.quantity}),e.jsx(g,{style:[x.text,{width:"20%",textAlign:"right"}],children:ie(D.rateMinor,t.currency)}),e.jsx(g,{style:[x.text,{width:"20%",textAlign:"right"}],children:ie(a,t.currency)})]},i)})]}),e.jsxs(M,{style:l.summarySection,children:[e.jsxs(M,{style:l.summaryRow,children:[e.jsxs(g,{style:l.summaryLabel,children:[j.subtotal,":"]}),e.jsx(g,{style:l.summaryValue,children:ie(t.subtotalMinor,t.currency)})]}),t.discountMinor>0&&e.jsxs(M,{style:l.summaryRow,children:[e.jsxs(g,{style:l.summaryLabel,children:[j.discount,":"]}),e.jsxs(g,{style:[l.summaryValue,{color:"#22c55e"}],children:["-",ie(t.discountMinor,t.currency)]})]}),t.taxMinor>0&&e.jsxs(M,{style:l.summaryRow,children:[e.jsxs(g,{style:l.summaryLabel,children:[j.tax," (",Math.round(t.taxRate*100),"%):"]}),e.jsx(g,{style:l.summaryValue,children:ie(t.taxMinor,t.currency)})]}),e.jsxs(M,{style:l.totalRow,children:[e.jsxs(g,{style:[l.summaryLabel,{fontWeight:700}],children:[j.total,":"]}),e.jsx(g,{style:[l.summaryValue,{fontSize:16}],children:ie(t.totalMinor,t.currency)})]})]}),t.notes&&e.jsxs(M,{style:l.notes,children:[e.jsxs(g,{style:[x.text,{fontWeight:600,marginBottom:4}],children:[j.notes,":"]}),e.jsx(g,{style:x.text,children:t.notes})]}),e.jsx(ts,{businessProfile:c,language:h,documentType:t.type})]})})}function ft(){return typeof window<"u"&&"__TAURI__"in window}function gt(t){return t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim().slice(0,100)}function ss(t){return t.slice(0,4)}function as(t,c){const m=gt(t)||"Default",p=ss(c);return["Mutaba3a",m,p]}function ns(t){return`${gt(t)||"document"}.pdf`}async function ze(t,c,m,p){if(ft())try{const o="@tauri-apps/plugin-fs",{writeFile:h,mkdir:j,BaseDirectory:l}=await import(o),k=as(c,m),S=ns(p),b=k.join("/");await j(b,{baseDir:l.Document,recursive:!0});const x=await t.arrayBuffer(),D=new Uint8Array(x),i=`${b}/${S}`;return await h(i,D,{baseDir:l.Document}),`Documents/${i}`}catch(o){console.error("Failed to save PDF to disk:",o);return}}function Ke(){return ft()}function yt(t={}){const[c,m]=N.useState(!1),p=it(),{showToast:o}=Mt(),h=zt(),j=N.useCallback((b,x)=>{const D=URL.createObjectURL(b),i=window.document.createElement("a");i.href=D,i.download=x,i.style.display="none",window.document.body.appendChild(i),i.click(),window.document.body.removeChild(i),URL.revokeObjectURL(D)},[]),l=N.useCallback(async({document:b,businessProfile:x,client:D,templateId:i="template1",isOriginal:a=!0})=>await Ut(e.jsx(xe,{document:b,businessProfile:x,client:D,templateId:i,isOriginal:a})).toBlob(),[]),k=N.useCallback(async({document:b,businessProfile:x,client:D,templateId:i="template1",isOriginal:a=!0,fileName:y})=>{m(!0);try{await p.mutateAsync(b.id);const u=await l({document:{...b,status:"issued"},businessProfile:x,client:D,templateId:i,isOriginal:a});let E;if(Ke())try{E=await ze(u,x.name,b.issueDate,b.number),E&&console.log("PDF archived to:",E)}catch(P){console.warn("Failed to archive PDF to disk:",P),o("PDF saved but archival failed")}const n=y||`${b.number}.pdf`;j(u,n);try{await Ve.lockAfterExport(b.id,E),h.invalidateQueries({queryKey:["document",b.id]}),h.invalidateQueries({queryKey:["documents"]})}catch(P){console.warn("Failed to lock document after export:",P)}o("Document issued and downloaded"),t.onSuccess?.()}catch(u){console.error("Failed to issue and download document:",u),o("Failed to issue document. Please try again."),t.onError?.(u instanceof Error?u:new Error("Unknown error"))}finally{m(!1)}},[p,l,j,o,t,h]),S=N.useCallback(async({document:b,businessProfile:x,client:D,templateId:i="template1",isOriginal:a=!0,fileName:y})=>{m(!0);try{const u=await l({document:b,businessProfile:x,client:D,templateId:i,isOriginal:a});let E;if(!b.lockedAt&&Ke())try{E=await ze(u,x.name,b.issueDate,b.number),E&&console.log("PDF archived to:",E)}catch(C){console.warn("Failed to archive PDF to disk:",C)}const P=y||`${b.number}.pdf`;j(u,P);try{await Ve.lockAfterExport(b.id,E),h.invalidateQueries({queryKey:["document",b.id]}),h.invalidateQueries({queryKey:["documents"]})}catch(C){console.warn("Failed to update document after export:",C)}o("Document downloaded")}catch(u){console.error("Failed to download document:",u),o("Failed to download document. Please try again.")}finally{m(!1)}},[l,j,o,h]);return{issueAndDownload:k,downloadOnly:S,isProcessing:c,isIssuing:p.isPending}}const He={invoice:"Invoice",receipt:"Receipt",invoice_receipt:"Invoice Receipt",credit_note:"Credit Note",price_offer:"Price Offer",proforma_invoice:"Proforma Invoice",donation_receipt:"Donation Receipt"},Ye={draft:{label:"Draft",className:"badge badge-muted"},issued:{label:"Issued",className:"badge badge-warning"},paid:{label:"Paid",className:"badge badge-success"},voided:{label:"Voided",className:"badge badge-danger"}};function Is(){const c=st({strict:!1}).documentId,m=Ie(),p=at(),o=nt(),h=ht(),j=rt(),l=lt(),{issueAndDownload:k,downloadOnly:S,isProcessing:b,isIssuing:x}=yt(),{language:D}=ct(),i=ut(D),[a,y]=N.useState("preview"),[u,E]=N.useState(!0),{data:n,isLoading:P}=we(c),{data:C}=At(n?.businessProfileId||""),{data:L}=Tt(n?.clientId||"");if(P)return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Loading..."}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]});if(!n)return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"Document Not Found"}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:"Document not found"}),e.jsx("p",{className:"empty-state-description",children:"The document you're looking for doesn't exist or has been deleted."}),e.jsx(G,{to:"/documents",className:"btn btn-primary",children:"Back to Documents"})]})})]});const A=!!n.lockedAt,d=!!n.archivedAt,U=n.status==="draft"&&!A,de=n.status==="draft"&&!A,pe=n.status==="issued"&&n.type==="invoice",je=n.status==="issued"&&!A,w=n.status==="paid"&&n.type==="invoice",O=async v=>{v!==n.status&&(v==="paid"?p.mutate(n.id):v==="voided"?confirm("Are you sure you want to void this document?")&&o.mutate(n.id):v==="issued"?C&&k({document:n,businessProfile:C,client:L||void 0,templateId:n.templateId,isOriginal:u}):h.mutate({id:n.id,data:{status:v}}))},z=()=>{C&&k({document:n,businessProfile:C,client:L||void 0,templateId:n.templateId,isOriginal:u})},ae=()=>{C&&S({document:n,businessProfile:C,client:L||void 0,templateId:n.templateId,isOriginal:u})};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:n.number,breadcrumbs:[{label:"Documents",href:"/documents"},{label:n.number}]}),e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("div",{className:"detail-header-info",children:[e.jsxs("div",{className:"detail-header-meta",children:[e.jsx("span",{className:Ye[n.status].className,children:Ye[n.status].label}),e.jsx("span",{className:"badge badge-muted",children:He[n.type]}),A&&e.jsxs("span",{className:"badge badge-info",title:`Locked on ${Z(n.lockedAt,i)}`,children:[e.jsx(pt,{size:12})," Locked"]}),d&&e.jsx("span",{className:"badge badge-warning",children:"Archived"}),e.jsx("span",{className:"text-muted",children:Z(n.issueDate,i)})]}),e.jsxs("div",{className:"detail-header-stats",children:[e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:"Total"}),e.jsx("span",{className:"inline-stat-value",children:X(n.totalMinor,n.currency,i)})]}),n.dueDate&&e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:"Due Date"}),e.jsx("span",{className:"inline-stat-value",children:Z(n.dueDate,i)})]}),L&&e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:"Client"}),e.jsx("span",{className:"inline-stat-value",children:L.name})]})]})]}),e.jsxs("div",{className:"detail-header-actions",children:[U&&e.jsx(G,{to:"/documents/$documentId/edit",params:{documentId:n.id},className:"btn btn-secondary",children:"Edit"}),A&&e.jsx("button",{className:"btn btn-secondary",onClick:()=>m({to:"/documents/new",search:{duplicateFrom:n.id}}),children:"Duplicate"}),pe&&e.jsxs("button",{className:"btn btn-success",onClick:()=>p.mutate(n.id),disabled:p.isPending,children:[e.jsx(mt,{size:16}),"Mark as Paid"]}),je&&e.jsx("button",{className:"btn btn-warning",onClick:()=>{confirm("Are you sure you want to void this document?")&&o.mutate(n.id)},disabled:o.isPending,children:"Void"}),w&&e.jsx(G,{to:"/documents/new",className:"btn btn-secondary",children:"Create Credit Note"}),d?e.jsx("button",{className:"btn btn-ghost",onClick:()=>l.mutate(n.id),disabled:l.isPending,children:"Unarchive"}):e.jsx("button",{className:"btn btn-ghost",onClick:()=>j.mutate(n.id),disabled:j.isPending,children:"Archive"}),de&&C&&e.jsx("button",{className:"btn btn-primary",onClick:z,disabled:b||x,children:b||x?"Preparing...":e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:16}),"Issue & Download PDF"]})}),(!de||A)&&C&&n.status!=="draft"&&e.jsx("button",{className:"btn btn-primary",onClick:ae,disabled:b,children:b?"Preparing...":e.jsxs(e.Fragment,{children:[e.jsx(qe,{size:16}),"Download Copy"]})})]})]}),e.jsx("div",{className:"tabs",children:e.jsxs("div",{className:"tabs-list",children:[e.jsx("button",{className:`tab ${a==="preview"?"active":""}`,onClick:()=>y("preview"),children:"Preview"}),e.jsx("button",{className:`tab ${a==="details"?"active":""}`,onClick:()=>y("details"),children:"Details"}),e.jsxs("button",{className:`tab ${a==="transactions"?"active":""}`,onClick:()=>y("transactions"),children:["Linked Transactions (",n.linkedTransactionIds.length,")"]})]})}),a==="preview"&&C&&e.jsxs("div",{className:"pdf-preview-container",children:[e.jsxs("div",{className:"pdf-preview-toolbar",children:[e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:v=>E(v.target.checked)}),e.jsx("span",{children:"Print as Original"})]}),e.jsx("span",{className:`badge ${u?"badge-success":"badge-muted"}`,children:u?"Original":"Copy"})]}),e.jsx(ke,{width:"100%",height:"600px",showToolbar:!1,children:e.jsx(xe,{document:n,businessProfile:C,client:L||void 0,templateId:n.templateId,isOriginal:u})})]}),a==="details"&&e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-card",children:[e.jsx("h3",{children:"Document Information"}),e.jsxs("dl",{className:"detail-list",children:[e.jsx("dt",{children:"Number"}),e.jsx("dd",{children:n.number}),e.jsx("dt",{children:"Type"}),e.jsx("dd",{children:He[n.type]}),e.jsx("dt",{children:"Status"}),e.jsx("dd",{children:e.jsxs("select",{className:"select select-sm",value:n.status,onChange:v=>O(v.target.value),disabled:p.isPending||o.isPending||x||b||h.isPending,children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"voided",children:"Voided"})]})}),e.jsx("dt",{children:"Issue Date"}),e.jsx("dd",{children:Z(n.issueDate,i)}),n.dueDate&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Due Date"}),e.jsx("dd",{children:Z(n.dueDate,i)})]}),n.paidAt&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Paid At"}),e.jsx("dd",{children:Z(n.paidAt,i)})]}),e.jsx("dt",{children:"Language"}),e.jsx("dd",{children:n.language==="ar"?"Arabic":"English"})]})]}),e.jsxs("div",{className:"detail-card",children:[e.jsx("h3",{children:"Amounts"}),e.jsxs("dl",{className:"detail-list",children:[e.jsx("dt",{children:"Subtotal"}),e.jsx("dd",{children:X(n.subtotalMinor,n.currency,i)}),n.discountMinor>0&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Discount"}),e.jsxs("dd",{children:["-",X(n.discountMinor,n.currency,i)]})]}),e.jsxs("dt",{children:["Tax (",(n.taxRate*100).toFixed(0),"%)"]}),e.jsx("dd",{children:X(n.taxMinor,n.currency,i)}),e.jsx("dt",{children:e.jsx("strong",{children:"Total"})}),e.jsx("dd",{children:e.jsx("strong",{children:X(n.totalMinor,n.currency,i)})})]})]}),L&&e.jsxs("div",{className:"detail-card",children:[e.jsx("h3",{children:"Client"}),e.jsxs("dl",{className:"detail-list",children:[e.jsx("dt",{children:"Name"}),e.jsx("dd",{children:e.jsx(G,{to:"/clients/$clientId",params:{clientId:L.id},children:L.name})}),L.email&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Email"}),e.jsx("dd",{children:L.email})]}),L.phone&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Phone"}),e.jsx("dd",{children:L.phone})]})]})]}),C&&e.jsxs("div",{className:"detail-card",children:[e.jsx("h3",{children:"Business Profile"}),e.jsxs("dl",{className:"detail-list",children:[e.jsx("dt",{children:"Name"}),e.jsx("dd",{children:C.name}),C.nameEn&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Name (English)"}),e.jsx("dd",{children:C.nameEn})]}),C.taxId&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Tax ID"}),e.jsx("dd",{children:C.taxId})]})]})]}),n.items.length>0&&e.jsxs("div",{className:"detail-card detail-card-wide",children:[e.jsx("h3",{children:"Line Items"}),e.jsxs("table",{className:"detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{style:{textAlign:"end"},children:"Qty"}),e.jsx("th",{style:{textAlign:"end"},children:"Rate"}),e.jsx("th",{style:{textAlign:"end"},children:"Total"})]})}),e.jsx("tbody",{children:n.items.map((v,V)=>e.jsxs("tr",{children:[e.jsx("td",{children:v.name}),e.jsx("td",{style:{textAlign:"end"},children:v.quantity}),e.jsx("td",{style:{textAlign:"end"},children:X(v.rateMinor,n.currency,i)}),e.jsx("td",{style:{textAlign:"end"},children:X(v.quantity*v.rateMinor-v.discountMinor,n.currency,i)})]},V))})]})]}),n.notes&&e.jsxs("div",{className:"detail-card detail-card-wide",children:[e.jsx("h3",{children:"Notes"}),e.jsx("p",{className:"detail-notes",children:n.notes})]})]}),a==="transactions"&&e.jsx("div",{className:"detail-transactions",children:n.linkedTransactionIds.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"text-muted",children:"No transactions linked to this document."})}):e.jsxs("p",{className:"text-muted",children:[n.linkedTransactionIds.length," transaction(s) linked."]})})]})]})}const De=N.forwardRef(({value:t,onChange:c,step:m=1,min:p=0,max:o,disabled:h=!1,label:j,error:l,formatDisplay:k,parseInput:S,placeholder:b,className:x="",id:D},i)=>{const a=D||(j?`stepper-${j.toLowerCase().replace(/\s+/g,"-")}`:void 0),y=!!l,u=N.useCallback(A=>{let d=A;return p!==void 0&&(d=Math.max(p,d)),o!==void 0&&(d=Math.min(o,d)),d},[p,o]),E=N.useCallback(()=>{if(h)return;const A=u(t+m);c(A)},[t,m,u,c,h]),n=N.useCallback(()=>{if(h)return;const A=u(t-m);c(A)},[t,m,u,c,h]),P=N.useCallback(A=>{const d=A.target.value;if(d===""||d==="-"){c(p??0);return}const U=S?S(d):parseFloat(d);isNaN(U)||c(u(U))},[S,u,c,p]),C=N.useCallback(A=>{A.key==="ArrowUp"?(A.preventDefault(),E()):A.key==="ArrowDown"&&(A.preventDefault(),n())},[E,n]),L=k?k(t):t.toString();return e.jsxs("div",{className:`stepper-wrapper ${x}`,children:[j&&e.jsx("label",{htmlFor:a,className:"stepper-label",children:j}),e.jsxs("div",{className:`stepper-input-group ${y?"stepper-error":""}`,children:[e.jsx("button",{type:"button",className:"stepper-btn stepper-btn-dec",onClick:n,disabled:h||p!==void 0&&t<=p,"aria-label":"Decrease",tabIndex:-1,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M2.5 6H9.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})})}),e.jsx("input",{ref:i,type:"text",inputMode:"decimal",id:a,className:"stepper-input",value:L,onChange:P,onKeyDown:C,disabled:h,placeholder:b,"aria-invalid":y,"aria-describedby":l?`${a}-error`:void 0}),e.jsx("button",{type:"button",className:"stepper-btn stepper-btn-inc",onClick:E,disabled:h||o!==void 0&&t>=o,"aria-label":"Increase",tabIndex:-1,children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M6 2.5V9.5M2.5 6H9.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})})})]}),l&&e.jsx("p",{id:`${a}-error`,className:"stepper-error-message",role:"alert",children:l})]})});De.displayName="StepperInput";const is={USD:"$",ILS:"₪",EUR:"€"};function Qe(t){return t.quantity*t.rateMinor-t.discountMinor}function Ge(t,c){const m=is[c],p=t/100;return`${m}${p.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function rs(t){return(t/100).toFixed(2)}function ls(t){const c=parseFloat(t);return isNaN(c)?0:Math.round(c*100)}function Je({items:t,currency:c,onChange:m,disabled:p=!1}){const o=N.useRef(new Map),h=()=>({name:"",quantity:1,rateMinor:0,discountMinor:0,taxExempt:!1}),j=N.useCallback((i,a)=>{const y=[...t];y[i]={...y[i],...a},m(y)},[t,m]),l=N.useCallback(()=>{m([...t,h()]),setTimeout(()=>{const i=t.length;o.current.get(`name-${i}`)?.focus()},0)},[t,m]),k=N.useCallback(i=>{if(t.length<=1)return;const a=t.filter((y,u)=>u!==i);m(a)},[t,m]),S=N.useCallback(i=>{const a=[...t],y={...t[i]};a.splice(i+1,0,y),m(a)},[t,m]),b=N.useCallback((i,a,y)=>{i.key==="Enter"&&!i.shiftKey?(i.preventDefault(),a===t.length-1?l():o.current.get(`${y}-${a+1}`)?.focus()):i.key==="Tab"&&!i.shiftKey&&y==="rate"&&a===t.length-1?(i.preventDefault(),l()):i.key==="ArrowDown"&&(i.metaKey||i.ctrlKey)?(i.preventDefault(),o.current.get(`${y}-${Math.min(a+1,t.length-1)}`)?.focus()):i.key==="ArrowUp"&&(i.metaKey||i.ctrlKey)&&(i.preventDefault(),o.current.get(`${y}-${Math.max(a-1,0)}`)?.focus())},[t.length,l]),x=N.useCallback((i,a)=>{a?o.current.set(i,a):o.current.delete(i)},[]),D=t.reduce((i,a)=>i+Qe(a),0);return e.jsxs("div",{className:"line-items-table",children:[e.jsxs("div",{className:"line-items-header",children:[e.jsx("div",{className:"line-items-col line-items-col-name",children:"Item"}),e.jsx("div",{className:"line-items-col line-items-col-qty",children:"Qty"}),e.jsx("div",{className:"line-items-col line-items-col-rate",children:"Rate"}),e.jsx("div",{className:"line-items-col line-items-col-total",children:"Total"}),e.jsx("div",{className:"line-items-col line-items-col-actions"})]}),e.jsx("div",{className:"line-items-body",children:t.map((i,a)=>e.jsxs("div",{className:"line-items-row",children:[e.jsx("div",{className:"line-items-col line-items-col-name",children:e.jsx("input",{ref:y=>x(`name-${a}`,y),type:"text",className:"line-items-input",placeholder:"Item description",value:i.name,onChange:y=>j(a,{name:y.target.value}),onKeyDown:y=>b(y,a,"name"),disabled:p})}),e.jsx("div",{className:"line-items-col line-items-col-qty",children:e.jsx(De,{value:i.quantity,onChange:y=>j(a,{quantity:y}),step:.5,min:.01,disabled:p})}),e.jsx("div",{className:"line-items-col line-items-col-rate",children:e.jsx(De,{value:i.rateMinor,onChange:y=>j(a,{rateMinor:y}),step:1e3,min:0,formatDisplay:y=>rs(y),parseInput:ls,disabled:p})}),e.jsx("div",{className:"line-items-col line-items-col-total",children:e.jsx("span",{className:"line-items-total-value",children:Ge(Qe(i),c)})}),e.jsx("div",{className:"line-items-col line-items-col-actions",children:!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"line-items-action-btn",onClick:()=>S(a),title:"Duplicate item","aria-label":"Duplicate item",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none","aria-hidden":"true",children:[e.jsx("rect",{x:"4",y:"4",width:"8",height:"8",rx:"1.5",stroke:"currentColor",strokeWidth:"1.5"}),e.jsx("path",{d:"M2 10V2.5C2 2.22386 2.22386 2 2.5 2H10",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})}),e.jsx("button",{type:"button",className:"line-items-action-btn line-items-action-btn-danger",onClick:()=>k(a),title:"Remove item","aria-label":"Remove item",disabled:t.length<=1,children:e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M2 4H12M5 4V2.5C5 2.22386 5.22386 2 5.5 2H8.5C8.77614 2 9 2.22386 9 2.5V4M11 4V11.5C11 11.7761 10.7761 12 10.5 12H3.5C3.22386 12 3 11.7761 3 11.5V4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})})})]})})]},a))}),!p&&e.jsxs("button",{type:"button",className:"line-items-add-row",onClick:l,children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M7 2V12M2 7H12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),e.jsx("span",{children:"Add line item"})]}),e.jsx("div",{className:"line-items-footer",children:e.jsxs("div",{className:"line-items-subtotal",children:[e.jsx("span",{className:"line-items-subtotal-label",children:"Subtotal"}),e.jsx("span",{className:"line-items-subtotal-value",children:Ge(D,c)})]})})]})}function os({children:t,document:c,businessProfile:m,client:p,templateId:o,isOriginal:h=!0,onSave:j,onIssue:l,isSaving:k=!1,isIssuing:S=!1,canIssue:b=!1,isDraft:x=!0}){const D=N.useRef(null),[i,a]=N.useState(h);return N.useEffect(()=>{const y=u=>{const n=navigator.platform.toUpperCase().indexOf("MAC")>=0?u.metaKey:u.ctrlKey;n&&u.key==="s"&&(u.preventDefault(),j&&!k&&j()),n&&u.key==="Enter"&&(u.preventDefault(),l&&b&&!S&&l())};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[j,l,k,S,b]),e.jsxs("div",{className:"split-workspace",children:[e.jsxs("div",{className:"split-workspace-actions",children:[e.jsx("div",{className:"split-workspace-actions-left",children:e.jsx("span",{className:"split-workspace-mode-label",children:"Pro Editor"})}),e.jsxs("div",{className:"split-workspace-actions-right",children:[x&&e.jsxs("button",{type:"submit",form:"document-form",className:"btn btn-secondary",disabled:k,children:[k?"Saving...":"Save Draft",e.jsx("kbd",{className:"kbd",children:"⌘S"})]}),b&&e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:l,disabled:S,children:[S?"Issuing...":"Issue & Download",e.jsx("kbd",{className:"kbd",children:"⌘↵"})]})]})]}),e.jsxs("div",{className:"split-workspace-panels",children:[e.jsx("div",{className:"split-workspace-left",ref:D,children:e.jsx("div",{className:"split-workspace-form",children:t})}),e.jsx("div",{className:"split-workspace-divider"}),e.jsxs("div",{className:"split-workspace-right",children:[e.jsxs("div",{className:"split-workspace-preview-header",children:[e.jsx("span",{className:"split-workspace-preview-title",children:"Preview"}),e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:y=>a(y.target.checked)}),e.jsx("span",{children:i?"Original":"Copy"})]})]}),e.jsx("div",{className:"split-workspace-preview",children:e.jsx(ke,{width:"100%",height:"100%",showToolbar:!1,children:e.jsx(xe,{document:c,businessProfile:m,client:p,templateId:o,isOriginal:i})})})]})]})]})}const Xe=[{value:"invoice",label:"Invoice",labelAr:"فاتورة"},{value:"receipt",label:"Receipt",labelAr:"إيصال"},{value:"invoice_receipt",label:"Invoice Receipt",labelAr:"فاتورة وإيصال"},{value:"credit_note",label:"Credit Note",labelAr:"إشعار دائن"},{value:"price_offer",label:"Price Offer",labelAr:"عرض سعر"},{value:"proforma_invoice",label:"Proforma Invoice",labelAr:"فاتورة مبدئية"},{value:"donation_receipt",label:"Donation Receipt",labelAr:"إيصال تبرع"}],Ze=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"cheque",label:"Cheque"},{value:"credit_card",label:"Credit Card"},{value:"other",label:"Other"}],et=[{value:"template1",label:"Classic"},{value:"template2",label:"Modern"},{value:"template3",label:"Minimal"}],cs=Se({name:q().min(1,"Item name is required"),quantity:oe().min(.01,"Quantity must be positive"),rateMinor:oe().min(0,"Rate must be non-negative"),discountMinor:oe().min(0).default(0),taxExempt:xt().default(!1)}),ds=Se({id:q(),amountMinor:oe().min(0),currency:ce(["USD","ILS","EUR"]),method:ce(["cash","bank_transfer","cheque","credit_card","other"]),notes:q().optional(),paidAt:q()}),ms=Se({type:ce(["invoice","receipt","invoice_receipt","credit_note","price_offer","proforma_invoice","donation_receipt"]),number:q().optional(),businessProfileId:q().min(1,"Business profile is required"),clientId:q().optional(),subject:q().optional(),brief:q().optional(),notes:q().optional(),currency:ce(["USD","ILS","EUR"]),language:ce(["ar","en"]),templateId:q(),issueDate:q().min(1,"Issue date is required"),dueDate:q().optional(),taxRate:oe().min(0).max(1),vatEnabled:xt().default(!0),items:$e(cs).min(1,"At least one item is required"),payments:$e(ds).optional(),refDocumentId:q().optional()});function tt(t){return t.quantity*t.rateMinor-t.discountMinor}function Y(t,c){return(t/100).toLocaleString("en-US",{style:"currency",currency:c,minimumFractionDigits:2})}function ks(){const t=st({strict:!1}),c=It({strict:!1}),m=t.documentId,p=c?.duplicateFrom,o=!!m,h=!o&&!!p,j=Ie(),l=ot(),[k,S]=N.useState(!1),[b,x]=N.useState(!0),[D,i]=N.useState(!1),{data:a,isLoading:y}=we(m||""),{data:u,isLoading:E}=we(p||""),{data:n=[]}=Rt(),{data:P=[]}=Et(),{data:C}=Pt(),{data:L=[]}=dt({}),A=Ft(),d=ht(),U=_t(),{issueAndDownload:de,isProcessing:pe}=yt(),je=()=>a?a.businessProfileId:C?C.id:P.length>0?P[0].id:"",w=Kt({resolver:Lt(ms),defaultValues:{type:"invoice",number:"",businessProfileId:je(),clientId:"",subject:"",brief:"",notes:"",currency:"USD",language:"en",templateId:"template1",issueDate:he(),dueDate:"",taxRate:.18,vatEnabled:!0,items:[{name:"",quantity:1,rateMinor:0,discountMinor:0,taxExempt:!1}],payments:[],refDocumentId:""}}),{watch:O,setValue:z,reset:ae,control:v}=w,V=O("type"),W=O("currency"),Q=O("taxRate"),K=O("vatEnabled"),J=O("items"),Ae=O("payments")||[],me=O("businessProfileId"),be=O("clientId"),Te=O("language"),le=O("templateId"),{fields:ue,append:vt,remove:Re}=Ht({control:v,name:"payments"}),Nt=JSON.stringify(J),$=N.useMemo(()=>{const s=J||[],r=s.reduce((H,I)=>H+tt(I),0);let T=0;if(K){const H=s.reduce((I,Be)=>Be.taxExempt?I:I+tt(Be),0);T=Math.round(H*Q)}const F=r+T;return{subtotal:r,tax:T,total:F}},[Nt,Q,K]),fe=N.useMemo(()=>Ae.reduce((s,r)=>s+(r.amountMinor||0),0),[Ae]);N.useEffect(()=>{a&&ae({type:a.type,number:a.number,businessProfileId:a.businessProfileId,clientId:a.clientId||"",subject:a.subject||"",brief:a.brief||"",notes:a.notes||"",currency:a.currency,language:a.language,templateId:a.templateId,issueDate:a.issueDate.split("T")[0],dueDate:a.dueDate||"",taxRate:a.taxRate,vatEnabled:a.vatEnabled??!0,items:a.items.map(s=>({name:s.name,quantity:s.quantity,rateMinor:s.rateMinor,discountMinor:s.discountMinor,taxExempt:s.taxExempt})),payments:a.payments.map(s=>({id:s.id,amountMinor:s.amountMinor,currency:s.currency,method:s.method,notes:s.notes||"",paidAt:s.paidAt.split("T")[0]})),refDocumentId:a.refDocumentId||""})},[a,ae]),N.useEffect(()=>{h&&u&&ae({type:u.type,number:"",businessProfileId:u.businessProfileId,clientId:u.clientId||"",subject:u.subject||"",brief:u.brief||"",notes:u.notes||"",currency:u.currency,language:u.language,templateId:u.templateId,issueDate:he(),dueDate:"",taxRate:u.taxRate,vatEnabled:u.vatEnabled??!0,items:u.items.map(s=>({name:s.name,quantity:s.quantity,rateMinor:s.rateMinor,discountMinor:s.discountMinor,taxExempt:s.taxExempt})),payments:[],refDocumentId:""})},[h,u,ae]),N.useEffect(()=>{const s=w.getValues("businessProfileId"),r=P.find(T=>T.id===s);r&&!o&&!a&&(z("currency",r.defaultCurrency),z("language",r.defaultLanguage))},[me,P,o,a,z]);const ge=async s=>{const r=s.items.map(I=>({name:I.name,quantity:I.quantity,rateMinor:I.rateMinor,rateVatMinor:I.taxExempt?I.rateMinor:Math.round(I.rateMinor*(1+s.taxRate)),discountMinor:I.discountMinor,taxExempt:I.taxExempt})),T=(s.payments||[]).map(I=>({id:I.id,amountMinor:I.amountMinor,currency:I.currency,method:I.method,notes:I.notes,paidAt:new Date(I.paidAt).toISOString()}));let F="draft";V==="receipt"||V==="invoice_receipt"||V==="donation_receipt"?F="paid":(V==="price_offer"||V==="proforma_invoice")&&(F="issued");const H={type:s.type,status:F,businessProfileId:s.businessProfileId,clientId:s.clientId||void 0,subject:s.subject||void 0,brief:s.brief||void 0,notes:s.notes||void 0,items:r,payments:T,subtotalMinor:$.subtotal,discountMinor:0,taxMinor:$.tax,totalMinor:$.total,taxRate:s.taxRate,vatEnabled:s.vatEnabled,currency:s.currency,language:s.language,issueDate:new Date(s.issueDate).toISOString(),dueDate:s.dueDate?s.dueDate:void 0,paidAt:F==="paid"?new Date().toISOString():void 0,refDocumentId:s.refDocumentId||void 0,linkedTransactionIds:a?.linkedTransactionIds||[],templateId:s.templateId,exportCount:a?.exportCount||0};try{if(o&&m){const I=a?.status==="draft"&&s.number&&s.number!==a.number?{...H,number:s.number}:H;await d.mutateAsync({id:m,data:I}),j({to:"/documents/$documentId",params:{documentId:m}})}else{const I=await A.mutateAsync(H);j({to:"/documents/$documentId",params:{documentId:I.id}})}}catch(I){console.error("Failed to save document:",I)}},wt=async()=>{if(m&&confirm("Are you sure you want to delete this document?"))try{await U.mutateAsync(m),j({to:"/documents"})}catch(s){console.error("Failed to delete document:",s)}},Ee=()=>{vt({id:Bt(),amountMinor:$.total-fe,currency:W,method:"cash",notes:"",paidAt:he()})},Dt=async()=>{if(!ne)return;const s=w.getValues();if(await w.trigger())try{let T=m;const F=s.items.map(I=>({name:I.name,quantity:I.quantity,rateMinor:I.rateMinor,rateVatMinor:I.taxExempt?I.rateMinor:Math.round(I.rateMinor*(1+s.taxRate)),discountMinor:I.discountMinor,taxExempt:I.taxExempt})),H={type:s.type,status:"draft",businessProfileId:s.businessProfileId,clientId:s.clientId||void 0,subject:s.subject||void 0,brief:s.brief||void 0,notes:s.notes||void 0,items:F,payments:[],subtotalMinor:$.subtotal,discountMinor:0,taxMinor:$.tax,totalMinor:$.total,taxRate:s.taxRate,vatEnabled:s.vatEnabled,currency:s.currency,language:s.language,issueDate:new Date(s.issueDate).toISOString(),dueDate:s.dueDate?s.dueDate:void 0,linkedTransactionIds:a?.linkedTransactionIds||[],templateId:s.templateId,exportCount:a?.exportCount||0};o&&m?await d.mutateAsync({id:m,data:H}):T=(await A.mutateAsync(H)).id,T&&(await de({document:{...Ne,id:T},businessProfile:ne,client:ve,templateId:le,isOriginal:!0}),j({to:"/documents/$documentId",params:{documentId:T}}))}catch(T){console.error("Failed to issue document:",T)}},ye=A.isPending||d.isPending,Pe=V==="receipt"||V==="invoice_receipt"||V==="donation_receipt",Fe=V==="invoice"||V==="proforma_invoice",_e=V==="credit_note",Le=L.filter(s=>s.status!=="voided"&&(s.type==="invoice"||s.type==="invoice_receipt")),ne=P.find(s=>s.id===me),ve=n.find(s=>s.id===be),Ne=N.useMemo(()=>({id:m||"preview",number:w.getValues("number")||"PREVIEW",type:V,status:"draft",businessProfileId:me,clientId:be||void 0,subject:w.getValues("subject")||void 0,brief:w.getValues("brief")||void 0,notes:w.getValues("notes")||void 0,items:J.map(s=>({name:s.name,quantity:s.quantity,rateMinor:s.rateMinor,rateVatMinor:s.taxExempt?s.rateMinor:Math.round(s.rateMinor*(1+Q)),discountMinor:s.discountMinor,taxExempt:s.taxExempt})),payments:[],subtotalMinor:$.subtotal,discountMinor:0,taxMinor:$.tax,totalMinor:$.total,taxRate:Q,vatEnabled:K,currency:W,language:Te,issueDate:new Date(w.getValues("issueDate")||he()).toISOString(),dueDate:w.getValues("dueDate")||void 0,linkedTransactionIds:[],templateId:le,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),[m,V,me,be,J,$,Q,K,W,Te,le]);if(o&&y||h&&E)return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:l("common.loading")}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]});if(o&&a?.lockedAt)return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:`Document ${a.number} is Locked`,breadcrumbs:[{label:"Documents",href:"/documents"},{label:a.number,href:`/documents/${a.id}`},{label:"Edit"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:"Document is Locked"}),e.jsxs("p",{className:"empty-state-description",children:["This document has been exported and is now immutable. You cannot edit locked documents.",e.jsx("br",{}),'To create a new document based on this one, use the "Duplicate" action.']}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[e.jsx(G,{to:"/documents/$documentId",params:{documentId:a.id},className:"btn btn-secondary",children:"View Document"}),e.jsx(G,{to:"/documents/new",search:{duplicateFrom:a.id},className:"btn btn-primary",children:"Create Duplicate"})]})]})})]});if(P.length===0)return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:o?"Edit Document":"New Document",breadcrumbs:[{label:"Documents",href:"/documents"},{label:o?"Edit":"New"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:l("documentGuard.title")}),e.jsx("p",{className:"empty-state-description",children:l("documentGuard.description")}),e.jsx(G,{to:"/settings",className:"btn btn-primary",children:l("documentGuard.createProfile")})]})})]});const f=o&&a&&(a.status!=="draft"||!!a.lockedAt);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:o?`Edit ${a?.number||"Document"}`:h&&u?`New Document (from ${u.number})`:"New Document",breadcrumbs:[{label:"Documents",href:"/documents"},{label:o?"Edit":"New"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"document-form-page",children:[e.jsxs("div",{className:"document-form-header",children:[e.jsxs("div",{className:"document-form-header-left",children:[e.jsx(G,{to:"/documents",className:"btn btn-ghost",children:"← Back"}),!D&&e.jsx("button",{type:"button",className:se("btn",k?"btn-secondary":"btn-ghost"),onClick:()=>S(!k),children:k?"Hide Preview":"Show Preview"}),e.jsx("button",{type:"button",className:se("btn",D?"btn-secondary":"btn-ghost"),onClick:()=>{i(!D),D||S(!1)},children:D?"Exit Pro Editor":"Pro Editor"})]}),e.jsxs("div",{className:"document-form-header-right",children:[o&&a?.status==="draft"&&e.jsx("button",{type:"button",className:"btn btn-danger",onClick:wt,disabled:U.isPending,children:"Delete"}),e.jsx("button",{type:"submit",form:"document-form",className:"btn btn-primary",disabled:ye||f,children:ye?l("common.saving"):o?"Save Changes":"Create Document"})]})]}),f&&e.jsx("div",{className:"alert alert-info",children:a?.lockedAt?"This document has been exported and is locked. It cannot be edited.":`This document is ${a?.status} and cannot be edited.`}),D&&ne?e.jsx(os,{document:Ne,businessProfile:ne,client:ve,templateId:le,isOriginal:b,onSave:()=>w.handleSubmit(ge)(),onIssue:Dt,isSaving:ye,isIssuing:pe,canIssue:!f&&J.length>0&&J[0].name!=="",isDraft:!o||a?.status==="draft",children:e.jsxs("form",{id:"document-form",onSubmit:w.handleSubmit(ge),children:[e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Document Type"}),e.jsx("div",{className:"document-type-grid",children:Xe.map(s=>e.jsx("button",{type:"button",className:se("document-type-btn",V===s.value&&"active"),onClick:()=>!f&&z("type",s.value),disabled:f,children:s.label},s.value))})]}),o&&a&&e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Document Number"}),e.jsx("input",{type:"text",className:"input",...w.register("number"),disabled:f,placeholder:"e.g., INV-0001"}),e.jsx("p",{className:"form-hint",children:f?"Document numbers can only be changed for draft documents.":"You can manually change the document number. Must be unique."})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Business & Client"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Business Profile *"}),e.jsx(_,{name:"businessProfileId",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"",children:"Select profile..."}),P.map(r=>e.jsxs("option",{value:r.id,children:[r.name," ",r.nameEn?`(${r.nameEn})`:"",r.isDefault?" - Default":""]},r.id))]})}),w.formState.errors.businessProfileId&&e.jsx("p",{className:"form-error",children:w.formState.errors.businessProfileId.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Client"}),e.jsx(_,{name:"clientId",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"",children:"No client"}),n.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})]})]}),_e&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Reference Document *"}),e.jsx(_,{name:"refDocumentId",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"",children:"Select original document..."}),Le.map(r=>e.jsxs("option",{value:r.id,children:[r.number," - ",Y(r.totalMinor,r.currency)]},r.id))]})})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Subject & Description"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{type:"text",className:"input",placeholder:"Document subject...",...w.register("subject"),disabled:f})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Brief Description"}),e.jsx("textarea",{className:"textarea",placeholder:"Brief description...",rows:2,...w.register("brief"),disabled:f})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Currency *"}),e.jsx(_,{name:"currency",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"ILS",children:"ILS (₪)"})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Language *"}),e.jsx(_,{name:"language",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ar",children:"Arabic"})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Template"}),e.jsx(_,{name:"templateId",control:v,render:({field:s})=>e.jsx("select",{className:"select",...s,disabled:f,children:et.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Issue Date *"}),e.jsx("input",{type:"date",className:se("input",w.formState.errors.issueDate&&"input-error"),...w.register("issueDate"),disabled:f})]}),Fe&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Due Date"}),e.jsx("input",{type:"date",className:"input",...w.register("dueDate"),disabled:f})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"VAT"}),e.jsxs("div",{className:"vat-toggle-row",children:[e.jsx(_,{name:"vatEnabled",control:v,render:({field:s})=>e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:s.value,onChange:r=>{s.onChange(r.target.checked),r.target.checked&&Q===0&&z("taxRate",.18)},disabled:f}),e.jsx("span",{children:"Enable VAT"})]})}),K&&e.jsx(_,{name:"taxRate",control:v,render:({field:s})=>e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input input-sm",style:{width:80},value:s.value*100,onChange:r=>s.onChange(parseFloat(r.target.value)/100||0),disabled:f})}),K&&e.jsx("span",{className:"text-muted",children:"%"})]})]})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Line Items"}),e.jsx(Je,{items:J,currency:W,onChange:s=>z("items",s),disabled:f}),w.formState.errors.items&&e.jsx("p",{className:"form-error",children:"At least one item is required"})]}),e.jsx("div",{className:"form-card totals-card",children:e.jsxs("div",{className:"totals-section",children:[e.jsxs("div",{className:"totals-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:Y($.subtotal,W)})]}),K&&e.jsxs("div",{className:"totals-row",children:[e.jsxs("span",{children:["VAT (",(Q*100).toFixed(0),"%)"]}),e.jsx("span",{children:Y($.tax,W)})]}),e.jsxs("div",{className:"totals-row totals-total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:Y($.total,W)})]})]})}),Pe&&e.jsxs("div",{className:"form-card",children:[e.jsxs("div",{className:"form-card-header",children:[e.jsx("h3",{className:"form-card-title",children:"Payment Details"}),!f&&e.jsx("button",{type:"button",className:"btn btn-ghost btn-sm",onClick:Ee,children:"+ Add Payment"})]}),ue.map((s,r)=>e.jsxs("div",{className:"payment-row",children:[e.jsx("div",{className:"payment-method",children:e.jsx(_,{name:`payments.${r}.method`,control:v,render:({field:T})=>e.jsx("select",{className:"select",...T,disabled:f,children:Ze.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))})})}),e.jsx("div",{className:"payment-amount",children:e.jsx(_,{name:`payments.${r}.amountMinor`,control:v,render:({field:T})=>e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input",placeholder:"Amount",value:(T.value??0)/100,onChange:F=>T.onChange(Math.round(parseFloat(F.target.value)*100)||0),disabled:f})})}),e.jsx("div",{className:"payment-date",children:e.jsx("input",{type:"date",className:"input",...w.register(`payments.${r}.paidAt`),disabled:f})}),!f&&e.jsx("button",{type:"button",className:"btn btn-ghost btn-icon",onClick:()=>Re(r),title:"Remove payment",children:"×"})]},s.id)),ue.length>0&&e.jsxs("div",{className:"totals-row",style:{marginTop:8},children:[e.jsx("span",{children:"Total Paid"}),e.jsx("span",{children:Y(fe,W)})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Notes"}),e.jsx("textarea",{className:"textarea",placeholder:"Additional notes (will appear on document)...",rows:3,...w.register("notes"),disabled:f})]})]})}):e.jsxs("div",{className:se("document-form-layout",k&&"with-preview"),children:[e.jsx("div",{className:"document-form-main",children:e.jsxs("form",{id:"document-form",onSubmit:w.handleSubmit(ge),children:[e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Document Type"}),e.jsx("div",{className:"document-type-grid",children:Xe.map(s=>e.jsx("button",{type:"button",className:se("document-type-btn",V===s.value&&"active"),onClick:()=>!f&&z("type",s.value),disabled:f,children:s.label},s.value))})]}),o&&a&&e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Document Number"}),e.jsx("input",{type:"text",className:"input",...w.register("number"),disabled:f,placeholder:"e.g., INV-0001"}),e.jsx("p",{className:"form-hint",children:f?"Document numbers can only be changed for draft documents.":"You can manually change the document number. Must be unique."})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Business & Client"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Business Profile *"}),e.jsx(_,{name:"businessProfileId",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"",children:"Select profile..."}),P.map(r=>e.jsxs("option",{value:r.id,children:[r.name," ",r.nameEn?`(${r.nameEn})`:"",r.isDefault?" - Default":""]},r.id))]})}),w.formState.errors.businessProfileId&&e.jsx("p",{className:"form-error",children:w.formState.errors.businessProfileId.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Client"}),e.jsx(_,{name:"clientId",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"",children:"No client"}),n.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})]})]}),_e&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Reference Document *"}),e.jsx(_,{name:"refDocumentId",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"",children:"Select original document..."}),Le.map(r=>e.jsxs("option",{value:r.id,children:[r.number," - ",Y(r.totalMinor,r.currency)]},r.id))]})})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Subject & Description"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{type:"text",className:"input",placeholder:"Document subject...",...w.register("subject"),disabled:f})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Brief Description"}),e.jsx("textarea",{className:"textarea",placeholder:"Brief description...",rows:2,...w.register("brief"),disabled:f})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Currency *"}),e.jsx(_,{name:"currency",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"ILS",children:"ILS (₪)"})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Language *"}),e.jsx(_,{name:"language",control:v,render:({field:s})=>e.jsxs("select",{className:"select",...s,disabled:f,children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ar",children:"Arabic"})]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Template"}),e.jsx(_,{name:"templateId",control:v,render:({field:s})=>e.jsx("select",{className:"select",...s,disabled:f,children:et.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Issue Date *"}),e.jsx("input",{type:"date",className:se("input",w.formState.errors.issueDate&&"input-error"),...w.register("issueDate"),disabled:f})]}),Fe&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Due Date"}),e.jsx("input",{type:"date",className:"input",...w.register("dueDate"),disabled:f})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"VAT"}),e.jsxs("div",{className:"vat-toggle-row",children:[e.jsx(_,{name:"vatEnabled",control:v,render:({field:s})=>e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:s.value,onChange:r=>{s.onChange(r.target.checked),r.target.checked&&Q===0&&z("taxRate",.18)},disabled:f}),e.jsx("span",{children:"Enable VAT"})]})}),K&&e.jsx(_,{name:"taxRate",control:v,render:({field:s})=>e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input input-sm",style:{width:80},value:s.value*100,onChange:r=>s.onChange(parseFloat(r.target.value)/100||0),disabled:f})}),K&&e.jsx("span",{className:"text-muted",children:"%"})]})]})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Line Items"}),e.jsx(Je,{items:J,currency:W,onChange:s=>z("items",s),disabled:f}),w.formState.errors.items&&e.jsx("p",{className:"form-error",children:"At least one item is required"})]}),e.jsx("div",{className:"form-card totals-card",children:e.jsxs("div",{className:"totals-section",children:[e.jsxs("div",{className:"totals-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:Y($.subtotal,W)})]}),K&&e.jsxs("div",{className:"totals-row",children:[e.jsxs("span",{children:["VAT (",(Q*100).toFixed(0),"%)"]}),e.jsx("span",{children:Y($.tax,W)})]}),e.jsxs("div",{className:"totals-row totals-total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:Y($.total,W)})]})]})}),Pe&&e.jsxs("div",{className:"form-card",children:[e.jsxs("div",{className:"form-card-header",children:[e.jsx("h3",{className:"form-card-title",children:"Payment Details"}),!f&&e.jsx("button",{type:"button",className:"btn btn-ghost btn-sm",onClick:Ee,children:"+ Add Payment"})]}),ue.map((s,r)=>e.jsxs("div",{className:"payment-row",children:[e.jsx("div",{className:"payment-method",children:e.jsx(_,{name:`payments.${r}.method`,control:v,render:({field:T})=>e.jsx("select",{className:"select",...T,disabled:f,children:Ze.map(F=>e.jsx("option",{value:F.value,children:F.label},F.value))})})}),e.jsx("div",{className:"payment-amount",children:e.jsx(_,{name:`payments.${r}.amountMinor`,control:v,render:({field:T})=>e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input",placeholder:"Amount",value:(T.value??0)/100,onChange:F=>T.onChange(Math.round(parseFloat(F.target.value)*100)||0),disabled:f})})}),e.jsx("div",{className:"payment-date",children:e.jsx("input",{type:"date",className:"input",...w.register(`payments.${r}.paidAt`),disabled:f})}),!f&&e.jsx("button",{type:"button",className:"btn btn-ghost btn-icon",onClick:()=>Re(r),title:"Remove payment",children:"×"})]},s.id)),ue.length>0&&e.jsxs("div",{className:"totals-row",style:{marginTop:8},children:[e.jsx("span",{children:"Total Paid"}),e.jsx("span",{children:Y(fe,W)})]})]}),e.jsxs("div",{className:"form-card",children:[e.jsx("h3",{className:"form-card-title",children:"Notes"}),e.jsx("textarea",{className:"textarea",placeholder:"Additional notes (will appear on document)...",rows:3,...w.register("notes"),disabled:f})]})]})}),k&&ne&&e.jsxs("div",{className:"document-form-preview",children:[e.jsxs("div",{className:"preview-header",children:[e.jsx("h3",{children:"Preview"}),e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>x(s.target.checked)}),e.jsx("span",{children:b?"Original":"Copy"})]})]}),e.jsx("div",{className:"preview-container",children:e.jsx(ke,{width:"100%",height:"100%",showToolbar:!1,children:e.jsx(xe,{document:Ne,businessProfile:ne,client:ve||void 0,templateId:le,isOriginal:b})})})]})]})]})})]})}export{Is as DocumentDetailPage,ks as DocumentFormPage,Ds as DocumentsPage};
