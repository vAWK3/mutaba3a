import{r as l,j as e}from"./vendor-router-D4Yqsbqz.js";import{u as w,a as L,d as $,aB as Z,O as T,aC as H,aD as q,N as G,aE as J,T as V,c as x,S as z,p as D,l as g,n as R,aF as K,aG as Q,aH as X,aI as Y,aJ as _}from"./index-DxpiON0U.js";/* empty css              */import{E as ee}from"./EmptyState-r3axvhwz.js";/* empty css                       */import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";function fe(){const s=w(),{language:j}=L(),p=R(j),{openRetainerDrawer:n,openRetainerMatchingDrawer:y,selectedRetainerId:c,selectRetainer:N}=$(),f=Z();l.useState(()=>{f.mutate()});const{data:o=[]}=T(),h=l.useMemo(()=>o.find(W=>W.isDefault)?.id||o[0]?.id,[o]),[r,b]=l.useState(void 0),[d,k]=l.useState("all"),[m,M]=l.useState(void 0),[v,i]=l.useState(void 0),[u,A]=l.useState("");l.useEffect(()=>{h&&!r&&b(h)},[h,r]);const E=l.useMemo(()=>{const t={profileId:r,search:u||void 0,clientId:v};return d==="due"?t.dueOnly=!0:d==="active"&&(t.status="active"),m&&(t.status=m),t},[r,d,m,v,u]),{data:S=[],isLoading:B}=H(E),{data:a}=q(r),{data:F=[]}=G(),{data:C}=J(c||""),O=t=>{N(t)},I=()=>{n({mode:"create",defaultProfileId:r})},U=()=>{y({step:"select-transaction"})};return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:s("retainers.title"),rightSlot:e.jsxs("div",{className:"topbar-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:U,children:s("retainers.matchPayment")}),e.jsxs("button",{className:"btn btn-primary",onClick:I,children:["+ ",s("retainers.new")]})]})}),e.jsxs("div",{className:"retainers-layout",children:[e.jsxs("aside",{className:"retainers-filter-panel",children:[o.length>1&&e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("drawer.expense.profile")}),e.jsx("select",{className:"select filter-select",value:r||"",onChange:t=>b(t.target.value||void 0),children:o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.filters.view")}),e.jsx("div",{className:"filter-radio-group",children:["all","due","active","ending"].map(t=>e.jsxs("label",{className:x("filter-radio",d===t&&"active"),children:[e.jsx("input",{type:"radio",name:"view",checked:d===t,onChange:()=>k(t)}),e.jsx("span",{children:s(`retainers.filters.${t}`)})]},t))})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.filters.status")}),e.jsxs("select",{className:"select filter-select",value:m||"",onChange:t=>M(t.target.value||void 0),children:[e.jsx("option",{value:"",children:s("common.all")}),e.jsx("option",{value:"draft",children:s("retainers.status.draft")}),e.jsx("option",{value:"active",children:s("retainers.status.active")}),e.jsx("option",{value:"paused",children:s("retainers.status.paused")}),e.jsx("option",{value:"ended",children:s("retainers.status.ended")})]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.filters.client")}),e.jsxs("select",{className:"select filter-select",value:v||"",onChange:t=>i(t.target.value||void 0),children:[e.jsx("option",{value:"",children:s("common.all")}),F.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("div",{className:"filter-section",children:e.jsx(z,{value:u,onChange:A,placeholder:s("retainers.searchPlaceholder")})}),a&&e.jsxs("div",{className:"filter-section retainers-summary",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.summary")}),e.jsxs("div",{className:"retainers-summary-stat",children:[e.jsx("span",{className:"retainers-summary-label",children:s("retainers.activeCount")}),e.jsx("span",{className:"retainers-summary-value",children:a.activeCount})]}),e.jsx("div",{className:"retainers-summary-stat",children:e.jsx(D,{usdAmountMinor:a.totalExpectedMonthlyUsdMinor,ilsAmountMinor:a.totalExpectedMonthlyIlsMinor,type:"income",label:s("retainers.monthlyExpected")})}),e.jsx("div",{className:"retainers-summary-stat",children:e.jsx(D,{usdAmountMinor:a.totalDueUsdMinor,ilsAmountMinor:a.totalDueIlsMinor,type:a.totalDueUsdMinor+a.totalDueIlsMinor>0?"expense":"neutral",label:s("retainers.totalDue")})}),a.totalOverdueUsdMinor+a.totalOverdueIlsMinor>0&&e.jsx("div",{className:"retainers-summary-stat",children:e.jsx(D,{usdAmountMinor:a.totalOverdueUsdMinor,ilsAmountMinor:a.totalOverdueIlsMinor,type:"expense",label:s("retainers.totalOverdue")})})]})]}),e.jsx("main",{className:"retainers-main",children:B?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):S.length===0?e.jsx(ee,{title:s("retainers.empty"),description:s(u?"retainers.emptySearch":"retainers.emptyHint"),action:u?void 0:{label:s("retainers.addRetainer"),onClick:I}}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("retainers.columns.status")}),e.jsx("th",{children:s("retainers.columns.title")}),e.jsx("th",{children:s("retainers.columns.client")}),e.jsx("th",{children:s("retainers.columns.amount")}),e.jsx("th",{children:s("retainers.columns.cadence")}),e.jsx("th",{children:s("retainers.columns.nextDue")}),e.jsx("th",{children:s("retainers.columns.dueNow")})]})}),e.jsx("tbody",{children:S.map(t=>e.jsxs("tr",{className:x("clickable",c===t.id&&"selected"),onClick:()=>O(t.id),children:[e.jsx("td",{children:e.jsx(P,{status:t.status})}),e.jsx("td",{className:"cell-primary",children:t.title}),e.jsx("td",{children:t.clientName||"-"}),e.jsx("td",{className:"cell-amount",children:g(t.amountMinor,t.currency,p)}),e.jsx("td",{children:e.jsx("span",{className:"cadence-badge",children:s(`retainers.cadence.${t.cadence}`)})}),e.jsx("td",{children:t.nextExpectedDate?new Date(t.nextExpectedDate).toLocaleDateString(p,{month:"short",day:"numeric"}):"-"}),e.jsx("td",{className:x("cell-amount",t.dueNowAmountMinor>0&&"amount-warning"),children:t.dueNowAmountMinor>0?g(t.dueNowAmountMinor,t.currency,p):"-"})]},t.id))})]})})}),e.jsx("aside",{className:x("retainers-inspector",c&&"visible"),children:C?e.jsx(se,{retainer:C,onClose:()=>N(void 0),onEdit:()=>n({mode:"edit",retainerId:C.id})}):e.jsx("div",{className:"inspector-placeholder",children:e.jsx("p",{children:s("retainers.selectToInspect")})})})]})]})}function P({status:s}){const j=w();return e.jsx("span",{className:x("status-badge",`status-${s}`),children:j(`retainers.status.${s}`)})}function se({retainer:s,onClose:j,onEdit:p}){const n=w(),{language:y}=L(),c=R(y),{data:N=[]}=K(s.id),f=Q(),o=X(),h=Y(),r=_(),d=[...N].sort((i,u)=>i.expectedDate.localeCompare(u.expectedDate)).slice(-6),k=()=>{confirm(n("retainers.confirmPause"))&&f.mutate(s.id)},m=()=>{o.mutate(s.id)},M=()=>{confirm(n("retainers.confirmEnd"))&&h.mutate(s.id)},v=()=>{r.mutate(s.id)};return e.jsxs("div",{className:"inspector-content",children:[e.jsxs("div",{className:"inspector-header",children:[e.jsx("h3",{className:"inspector-title",children:s.title}),e.jsx("button",{className:"btn-icon",onClick:j,"aria-label":n("common.close"),children:e.jsx(ne,{})})]}),e.jsxs("div",{className:"inspector-section",children:[e.jsx("h4",{className:"inspector-section-title",children:n("retainers.inspector.overview")}),e.jsxs("dl",{className:"inspector-details",children:[e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.client")}),e.jsx("dd",{children:s.clientName||n("common.noClient")})]}),s.projectName&&e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.project")}),e.jsx("dd",{children:s.projectName})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.amount")}),e.jsx("dd",{className:"amount-positive",children:g(s.amountMinor,s.currency,c)})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.cadence")}),e.jsx("dd",{children:n(`retainers.cadence.${s.cadence}`)})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.paymentDay")}),e.jsx("dd",{children:s.paymentDay})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.startDate")}),e.jsx("dd",{children:new Date(s.startDate).toLocaleDateString(c)})]}),s.endDate&&e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.endDate")}),e.jsx("dd",{children:new Date(s.endDate).toLocaleDateString(c)})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.status")}),e.jsx("dd",{children:e.jsx(P,{status:s.status})})]})]})]}),e.jsxs("div",{className:"inspector-section",children:[e.jsx("h4",{className:"inspector-section-title",children:n("retainers.inspector.schedule")}),e.jsx("div",{className:"schedule-timeline",children:d.map(i=>e.jsxs("div",{className:x("schedule-item",`state-${i.state}`),children:[e.jsx("div",{className:"schedule-item-icon",children:e.jsx(te,{state:i.state})}),e.jsxs("div",{className:"schedule-item-content",children:[e.jsx("span",{className:"schedule-item-date",children:new Date(i.expectedDate).toLocaleDateString(c,{month:"short",year:"numeric"})}),e.jsx("span",{className:"schedule-item-state",children:n(`retainers.state.${i.state}`)})]}),e.jsx("span",{className:"schedule-item-amount",children:g(i.expectedAmountMinor,i.currency,c)})]},i.id))})]}),e.jsxs("div",{className:"inspector-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:p,children:n("common.edit")}),s.status==="draft"&&e.jsx("button",{className:"btn btn-primary",onClick:v,disabled:r.isPending,children:n("retainers.activate")}),s.status==="active"&&e.jsx("button",{className:"btn btn-secondary",onClick:k,disabled:f.isPending,children:n("retainers.pause")}),s.status==="paused"&&e.jsx("button",{className:"btn btn-primary",onClick:m,disabled:o.isPending,children:n("retainers.resume")}),(s.status==="active"||s.status==="paused")&&e.jsx("button",{className:"btn btn-danger",onClick:M,disabled:h.isPending,children:n("retainers.end")})]}),s.notes&&e.jsxs("div",{className:"inspector-section",children:[e.jsx("h4",{className:"inspector-section-title",children:n("retainers.inspector.notes")}),e.jsx("p",{className:"inspector-notes",children:s.notes})]})]})}function te({state:s}){switch(s){case"received":return e.jsx(ae,{className:"state-icon received"});case"partial":return e.jsx(ie,{className:"state-icon partial"});case"due":return e.jsx(re,{className:"state-icon due"});case"missed":return e.jsx(ce,{className:"state-icon missed"});case"canceled":return e.jsx(le,{className:"state-icon canceled"});default:return e.jsx(oe,{className:"state-icon upcoming"})}}function ne(){return e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})}function ae({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}function ie({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}function re({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})})}function ce({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}function le({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})})}function oe({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("circle",{cx:"12",cy:"12",r:"9",strokeLinecap:"round",strokeLinejoin:"round"})})}export{fe as RetainersPage};
