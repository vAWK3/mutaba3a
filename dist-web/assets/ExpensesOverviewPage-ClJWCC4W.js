import{r as h,j as e,L as U}from"./vendor-router-D4Yqsbqz.js";import{u as b,a as M,ab as T,o as A,T as E,i as C,m as i,c as F}from"./index-BS1N8tX1.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";function O(){const o=b(),{language:f}=M(),n=A(f),p=new Date().getFullYear(),[c,I]=h.useState(p),[s,N]=h.useState(void 0),{data:x=[],isLoading:w}=T(c),D=Array.from({length:6},(t,a)=>p-a),l=h.useMemo(()=>{let t=0,a=0;const r=new Array(12).fill(0),d=new Array(12).fill(0);return x.forEach(S=>{t+=S.totalMinorUSD,a+=S.totalMinorILS,S.monthlyBreakdown.forEach(v=>{r[v.month-1]+=v.totalMinorUSD,d[v.month-1]+=v.totalMinorILS})}),{totalUSD:t,totalILS:a,monthlyTotalsUSD:r,monthlyTotalsILS:d}},[x]),g=s==="ILS"?l.monthlyTotalsILS:l.monthlyTotalsUSD,u=Math.max(...g,1),m=s||"USD",j=s==="ILS"?l.totalILS:l.totalUSD,y=h.useMemo(()=>Array.from({length:12},(t,a)=>new Date(c,a,1).toLocaleDateString(n,{month:"short"})),[c,n]),L=h.useMemo(()=>[...x].sort((t,a)=>{const r=s==="ILS"?t.totalMinorILS:t.totalMinorUSD;return(s==="ILS"?a.totalMinorILS:a.totalMinorUSD)-r}),[x,s]);return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:o("expenses.overview.title"),breadcrumbs:[{label:o("nav.expenses"),href:"/expenses"},{label:o("expenses.overview.title")}],filterSlot:e.jsxs("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24},children:[e.jsx("select",{className:"select",value:c,onChange:t=>I(Number(t.target.value)),children:D.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(C,{value:s,onChange:N})]})}),e.jsx("div",{className:"page-content",children:w?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overview-grand-total",children:[e.jsxs("div",{className:"overview-grand-total-label",children:[o("expenses.overview.totalExpenses")," (",c,")"]}),e.jsx("div",{className:"overview-grand-total-value amount-negative",children:s?i(j,m,n):e.jsxs(e.Fragment,{children:[l.totalUSD>0&&e.jsx("span",{children:i(l.totalUSD,"USD",n)}),l.totalILS>0&&e.jsx("span",{children:i(l.totalILS,"ILS",n)}),l.totalUSD===0&&l.totalILS===0&&e.jsx("span",{children:"-"})]})})]}),e.jsxs("div",{className:"overview-chart-section",children:[e.jsx("h3",{className:"section-title",children:o("expenses.overview.monthlyBreakdown")}),e.jsx("div",{className:"overview-bar-chart",children:g.map((t,a)=>{const r=u>0?t/u*100:0;return e.jsxs("div",{className:"chart-bar-container",children:[e.jsx("div",{className:"chart-bar-wrapper",children:e.jsx("div",{className:F("chart-bar",t>0&&"has-value"),style:{height:`${Math.max(r,2)}%`}})}),e.jsx("div",{className:"chart-bar-label",children:y[a]}),e.jsx("div",{className:"chart-bar-value",children:t>0?i(t,m,n):"-"})]},a)})})]}),e.jsxs("div",{className:"overview-breakdown-section",children:[e.jsx("h3",{className:"section-title",children:o("expenses.overview.byProfile")}),L.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{className:"text-muted",children:o("expenses.overview.noProfiles")})}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:o("expenses.overview.profile")}),!s&&e.jsx("th",{style:{textAlign:"end"},children:"USD"}),!s&&e.jsx("th",{style:{textAlign:"end"},children:"ILS"}),s&&e.jsx("th",{style:{textAlign:"end"},children:o("expenses.overview.total")}),e.jsx("th",{style:{textAlign:"end"},children:o("expenses.overview.percentage")})]})}),e.jsx("tbody",{children:L.map(t=>{const a=s==="ILS"?t.totalMinorILS:t.totalMinorUSD,r=s==="ILS"?l.totalILS:l.totalUSD,d=r>0?(a/r*100).toFixed(1):"0";return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{to:"/expenses/profile/$profileId",params:{profileId:t.profileId},style:{fontWeight:500},children:t.profileName})}),!s&&e.jsx("td",{className:"amount-cell amount-negative",children:t.totalMinorUSD>0?i(t.totalMinorUSD,"USD",n):"-"}),!s&&e.jsx("td",{className:"amount-cell amount-negative",children:t.totalMinorILS>0?i(t.totalMinorILS,"ILS",n):"-"}),s&&e.jsx("td",{className:"amount-cell amount-negative",children:a>0?i(a,m,n):"-"}),e.jsx("td",{className:"amount-cell text-muted",children:a>0?`${d}%`:"-"})]},t.profileId)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:600},children:o("expenses.overview.total")}),!s&&e.jsx("td",{className:"amount-cell amount-negative",style:{fontWeight:600},children:l.totalUSD>0?i(l.totalUSD,"USD",n):"-"}),!s&&e.jsx("td",{className:"amount-cell amount-negative",style:{fontWeight:600},children:l.totalILS>0?i(l.totalILS,"ILS",n):"-"}),s&&e.jsx("td",{className:"amount-cell amount-negative",style:{fontWeight:600},children:j>0?i(j,m,n):"-"}),e.jsx("td",{className:"amount-cell text-muted",children:"100%"})]})})]})})]})]})})]})}export{O as ExpensesOverviewPage};
