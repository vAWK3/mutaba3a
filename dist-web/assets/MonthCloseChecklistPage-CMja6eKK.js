import{g as P,f as B,r as h,j as e,L as f}from"./vendor-router-D4Yqsbqz.js";import{u as K,a as A,K as T,aL as Z,aM as $,aN as O,aO as H,aP as W,T as p,n as D,c as i}from"./index-WOWG8CNN.js";import{a as U,g as V,f as q,i as G,e as J}from"./monthDetection-CWV0R2IH.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-Bf8hyTk9.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";function ie(){const{profileId:l}=P({from:"/expenses/close/profile/$profileId"}),b=B({from:"/expenses/close/profile/$profileId"}),s=K(),{language:N}=A(),x=D(N),k=U(),[a,v]=h.useState(b.month||k),[u,C]=h.useState(!1),[j,y]=h.useState(""),{data:r,isLoading:L}=T(l),{data:t,isLoading:M}=Z(l,a),{data:o,isLoading:z}=$(l,a),F=O(),d=H(),g=W(),w=V(12),m=(n,I)=>{F.mutate({profileId:l,monthKey:a,updates:{[n]:I}})},E=async()=>{if(r){C(!0);try{await J(l,r.name,a),m("zipExported",!0)}catch(n){console.error("Failed to export receipts:",n)}finally{C(!1)}}},R=async()=>{if(confirm(s("monthClose.confirmClose")))try{await d.mutateAsync({profileId:l,monthKey:a,notes:j||void 0})}catch{}},S=async()=>{if(confirm(s("monthClose.confirmReopen")))try{await g.mutateAsync({profileId:l,monthKey:a})}catch{}},c=h.useMemo(()=>!t||!o?!1:o.isFullyLinked&&o.isFullyCategorized&&t.checklist.recurringConfirmed,[t,o]);return L||M||z?e.jsxs(e.Fragment,{children:[e.jsx(p,{title:s("common.loading"),breadcrumbs:[{label:s("nav.expenses"),href:"/expenses"},{label:s("common.loading")}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):r?e.jsxs(e.Fragment,{children:[e.jsx(p,{title:s("monthClose.title"),breadcrumbs:[{label:s("nav.expenses"),href:"/expenses"},{label:r.name,href:`/expenses/profile/${l}`},{label:s("monthClose.title")}],filterSlot:e.jsx("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24},children:e.jsx("select",{className:"select",value:a,onChange:n=>v(n.target.value),children:w.map(n=>e.jsx("option",{value:n,children:q(n,x)},n))})})}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"month-close-container",children:[t?.isClosed?e.jsxs("div",{className:"month-close-banner closed",children:[e.jsx("div",{className:"month-close-banner-icon",children:e.jsx(Q,{})}),e.jsxs("div",{className:"month-close-banner-content",children:[e.jsx("h3",{className:"month-close-banner-title",children:s("monthClose.monthClosed")}),e.jsx("p",{className:"month-close-banner-text",children:s("monthClose.closedAt",{date:t.closedAt?new Date(t.closedAt).toLocaleDateString(x):""})}),t.notes&&e.jsx("p",{className:"month-close-banner-notes",children:t.notes})]}),e.jsx("button",{className:"btn btn-secondary",onClick:S,disabled:g.isPending,children:s("monthClose.reopen")})]}):e.jsxs("div",{className:i("month-close-banner",c?"ready":"pending"),children:[e.jsx("div",{className:"month-close-banner-icon",children:c?e.jsx(X,{}):e.jsx(Y,{})}),e.jsxs("div",{className:"month-close-banner-content",children:[e.jsx("h3",{className:"month-close-banner-title",children:s(c?"monthClose.readyToClose":"monthClose.notReady")}),e.jsx("p",{className:"month-close-banner-text",children:s(c?"monthClose.allTasksComplete":"monthClose.completeTasks")})]})]}),!t?.isClosed&&e.jsxs("div",{className:"month-close-checklist",children:[e.jsx("h4",{className:"month-close-section-title",children:s("monthClose.checklist")}),e.jsxs("div",{className:i("month-close-item",o?.isFullyLinked&&"completed"),children:[e.jsx("div",{className:"month-close-item-checkbox",children:e.jsx("input",{type:"checkbox",checked:o?.isFullyLinked||!1,disabled:!0,readOnly:!0})}),e.jsxs("div",{className:"month-close-item-content",children:[e.jsx("span",{className:"month-close-item-label",children:s("monthClose.receiptsLinked")}),e.jsx("span",{className:"month-close-item-status",children:o?.unlinkedReceiptsCount===0?s("monthClose.allLinked"):s("monthClose.unlinkedCount",{count:o?.unlinkedReceiptsCount||0})})]}),!o?.isFullyLinked&&e.jsx(f,{to:"/expenses/profile/$profileId/receipts",params:{profileId:l},className:"btn btn-sm btn-secondary",children:s("monthClose.viewReceipts")})]}),e.jsxs("div",{className:i("month-close-item",o?.isFullyCategorized&&"completed"),children:[e.jsx("div",{className:"month-close-item-checkbox",children:e.jsx("input",{type:"checkbox",checked:o?.isFullyCategorized||!1,disabled:!0,readOnly:!0})}),e.jsxs("div",{className:"month-close-item-content",children:[e.jsx("span",{className:"month-close-item-label",children:s("monthClose.allCategorized")}),e.jsx("span",{className:"month-close-item-status",children:o?.uncategorizedExpensesCount===0?s("monthClose.allCategorizedStatus"):s("monthClose.uncategorizedCount",{count:o?.uncategorizedExpensesCount||0})})]}),!o?.isFullyCategorized&&e.jsx(f,{to:"/expenses/profile/$profileId",params:{profileId:l},className:"btn btn-sm btn-secondary",children:s("monthClose.viewExpenses")})]}),e.jsxs("div",{className:i("month-close-item",t?.checklist.recurringConfirmed&&"completed"),children:[e.jsx("div",{className:"month-close-item-checkbox",children:e.jsx("input",{type:"checkbox",checked:t?.checklist.recurringConfirmed||!1,onChange:n=>m("recurringConfirmed",n.target.checked)})}),e.jsxs("div",{className:"month-close-item-content",children:[e.jsx("span",{className:"month-close-item-label",children:s("monthClose.recurringConfirmed")}),e.jsx("span",{className:"month-close-item-hint",children:s("monthClose.recurringConfirmedHint")})]})]}),e.jsxs("div",{className:i("month-close-item",t?.checklist.zipExported&&"completed"),children:[e.jsx("div",{className:"month-close-item-checkbox",children:e.jsx("input",{type:"checkbox",checked:t?.checklist.zipExported||!1,onChange:n=>m("zipExported",n.target.checked)})}),e.jsxs("div",{className:"month-close-item-content",children:[e.jsx("span",{className:"month-close-item-label",children:s("monthClose.zipExported")}),e.jsx("span",{className:"month-close-item-hint",children:s("monthClose.zipExportedHint")})]}),e.jsx("button",{className:"btn btn-sm btn-secondary",onClick:E,disabled:u,children:s(u?"expenses.receipts.exporting":"monthClose.exportZip")})]})]}),!t?.isClosed&&G(a)&&e.jsxs("div",{className:"month-close-action-section",children:[e.jsx("h4",{className:"month-close-section-title",children:s("monthClose.closeMonth")}),e.jsxs("div",{className:"month-close-notes",children:[e.jsx("label",{className:"form-label",children:s("monthClose.notesLabel")}),e.jsx("textarea",{className:"textarea",value:j,onChange:n=>y(n.target.value),placeholder:s("monthClose.notesPlaceholder")})]}),e.jsx("button",{className:"btn btn-primary",onClick:R,disabled:!c||d.isPending,children:d.isPending?s("common.saving"):s("monthClose.closeMonthButton")}),!c&&e.jsx("p",{className:"month-close-hint text-warning",children:s("monthClose.completeChecklistFirst")})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{title:s("expenses.profileNotFound"),breadcrumbs:[{label:s("nav.expenses"),href:"/expenses"}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"empty-state",children:e.jsx("h3",{className:"empty-state-title",children:s("expenses.profileNotFound")})})})]})}function Q(){return e.jsx("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})})}function X(){return e.jsx("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}function Y(){return e.jsx("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}export{ie as MonthCloseChecklistPage};
