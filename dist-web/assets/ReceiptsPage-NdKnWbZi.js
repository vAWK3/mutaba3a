import{j as e,r as x,g as re}from"./vendor-router-D4Yqsbqz.js";import{u as Z,a as ee,an as ae,j as O,n as se,c as L,ao as oe,ap as de,aq as ue,d as pe,K as me,ar as he,as as xe,at as ge,al as je,au as be,av as fe,aw as ve,T as J}from"./index-WOWG8CNN.js";import{g as Ne,d as ke,f as Q,e as ye}from"./monthDetection-CWV0R2IH.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-Bf8hyTk9.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";function we(a){switch(a){case"high":return"text-success";case"medium":return"text-warning";case"low":return"text-muted";default:return"text-muted"}}function Ce(a){switch(a){case"high":return"High match";case"medium":return"Likely match";case"low":return"Possible match";default:return"Low match"}}function te({receipt:a,suggestions:n,onLinkSuccess:k,onCreateExpense:g}){const c=Z(),{language:p}=ee(),f=se(p),m=ae(),i=n[0],l=async u=>{try{await m.mutateAsync({receiptId:a.id,expenseId:u.expenseId}),k?.()}catch{}},j=()=>{g?.(a)};return e.jsxs("div",{className:"receipt-match-card",children:[e.jsxs("div",{className:"receipt-match-card-preview",children:[e.jsx("div",{className:"receipt-match-thumbnail",children:a.mimeType.startsWith("image/")?e.jsx("img",{src:`data:${a.mimeType};base64,${a.data}`,alt:""}):e.jsx("div",{className:"receipt-pdf-icon",children:e.jsx(Me,{})})}),e.jsxs("div",{className:"receipt-match-info",children:[e.jsx("div",{className:"receipt-match-filename",title:a.fileName,children:a.fileName}),e.jsxs("div",{className:"receipt-match-meta",children:[e.jsx("span",{className:"text-muted text-sm",children:O(a.createdAt,f)}),a.amountMinor&&e.jsxs("span",{className:"receipt-match-amount",children:[a.currency," ",(a.amountMinor/100).toFixed(2)]})]}),a.vendorRaw&&e.jsx("div",{className:"receipt-match-vendor text-sm text-muted",children:a.vendorRaw})]})]}),n.length>0?e.jsxs("div",{className:"receipt-match-suggestions",children:[e.jsx("div",{className:"receipt-match-suggestions-header",children:e.jsx("span",{className:"text-sm text-muted",children:c("receipts.suggestions.title")})}),n.slice(0,3).map(u=>e.jsxs("div",{className:L("receipt-match-suggestion",u===i&&"is-best"),children:[e.jsxs("div",{className:"suggestion-info",children:[e.jsx("div",{className:"suggestion-title",children:u.expense.title||u.expense.vendor||c("expenses.untitled")}),e.jsxs("div",{className:"suggestion-details text-sm text-muted",children:[e.jsx("span",{children:O(u.expense.occurredAt,f)}),e.jsxs("span",{className:"suggestion-amount",children:[u.expense.currency," ",(u.expense.amountMinor/100).toFixed(2)]})]})]}),e.jsxs("div",{className:"suggestion-actions",children:[e.jsxs("span",{className:L("suggestion-score",we(u.confidence)),title:Ce(u.confidence),children:[u.score,"%"]}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>l(u),disabled:m.isPending,children:c("receipts.suggestions.link")})]})]},u.expenseId))]}):e.jsx("div",{className:"receipt-match-no-suggestions",children:e.jsx("span",{className:"text-sm text-muted",children:c("receipts.suggestions.noMatches")})}),e.jsx("div",{className:"receipt-match-card-footer",children:e.jsx("button",{type:"button",className:"btn btn-sm btn-secondary",onClick:j,children:c("receipts.suggestions.createAndLink")})})]})}function Me(){return e.jsx("svg",{width:"32",height:"32",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}function Le({items:a,isLoading:n,onLinkSuccess:k,onCreateExpense:g,groupByConfidence:c=!0}){const p=Z(),f=x.useMemo(()=>{if(!c)return{all:a};const i={high:[],medium:[],low:[],none:[]};for(const l of a){const j=l.suggestions[0];j?i[j.confidence].push(l):i.none.push(l)}return i},[a,c]);if(n)return e.jsxs("div",{className:"receipt-match-list-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{className:"text-muted",children:p("common.loading")})]});if(a.length===0)return e.jsxs("div",{className:"receipt-match-list-empty",children:[e.jsx("h4",{className:"empty-state-title",children:p("receipts.suggestions.allLinked")}),e.jsx("p",{className:"text-muted",children:p("receipts.suggestions.allLinkedHint")})]});const m=(i,l,j)=>l.length===0?null:e.jsxs("div",{className:"receipt-match-group",children:[e.jsxs("div",{className:"receipt-match-group-header",children:[e.jsx("span",{className:L("receipt-match-group-badge",`confidence-${i}`),children:l.length}),e.jsx("span",{className:"receipt-match-group-label",children:j})]}),e.jsx("div",{className:"receipt-match-group-items",children:l.map(({receipt:u,suggestions:v})=>e.jsx(te,{receipt:u,suggestions:v,onLinkSuccess:k,onCreateExpense:g},u.id))})]},i);if(c&&"high"in f){const i=f;return e.jsxs("div",{className:"receipt-match-list",children:[m("high",i.high,p("receipts.suggestions.highConfidence")),m("medium",i.medium,p("receipts.suggestions.mediumConfidence")),m("low",i.low,p("receipts.suggestions.lowConfidence")),m("none",i.none,p("receipts.suggestions.noMatches"))]})}return e.jsx("div",{className:"receipt-match-list",children:e.jsx("div",{className:"receipt-match-group-items",children:a.map(({receipt:i,suggestions:l})=>e.jsx(te,{receipt:i,suggestions:l,onLinkSuccess:k,onCreateExpense:g},i.id))})})}const Re=5*1024*1024,ne=100;function Fe({profileId:a,isOpen:n,onClose:k,onSuccess:g}){const c=Z(),{language:p}=ee(),f=se(p),m=x.useRef(null),[i,l]=x.useState([]),[j,u]=x.useState(!1),[v,E]=x.useState(!0),[M,S]=x.useState(""),[R,z]=x.useState({current:0,total:0}),T=oe(),_=de(),F=Ne(12),I=x.useCallback(async s=>{const r=Array.from(s.target.files||[]);if(r.length===0)return;const o=r.slice(0,ne-i.length).map(d=>{let y="pending",w;return d.size>Re?(y="error",w=c("expenses.receipts.fileTooLarge",{maxSize:"5MB"})):!d.type.startsWith("image/")&&d.type!=="application/pdf"&&(y="error",w=c("expenses.receipts.invalidFileType")),{file:d,detectedMonthKey:ke(d),status:y,error:w}});l(d=>[...d,...o]),m.current&&(m.current.value="")},[i.length,c]),V=s=>{l(r=>r.filter((h,o)=>o!==s))},C=(s,r)=>{l(h=>h.map((o,d)=>d===s?{...o,overrideMonthKey:r||void 0}:o))},X=s=>{S(s),l(s?r=>r.map(h=>({...h,overrideMonthKey:s})):r=>r.map(h=>({...h,overrideMonthKey:void 0})))},$=s=>!v&&M?M:s.overrideMonthKey||s.detectedMonthKey,P=s=>new Promise((r,h)=>{const o=new FileReader;o.onload=()=>{const y=o.result.split(",")[1];r(y)},o.onerror=h,o.readAsDataURL(s)}),Y=async()=>{const s=i.filter(o=>o.status==="pending");if(s.length===0)return;u(!0),z({current:0,total:s.length});const r=[...i];for(let o=0;o<i.length;o++){const d=i[o];if(d.status!=="pending")continue;const y=$(d);r[o]={...d,status:"uploading"},l([...r]);try{if(await _.mutateAsync({profileId:a,fileName:d.file.name,sizeBytes:d.file.size,monthKey:y}))r[o]={...d,status:"duplicate",error:c("bulkUpload.duplicate")};else{const K=await P(d.file),q=await T.mutateAsync([{profileId:a,monthKey:y,fileName:d.file.name,mimeType:d.file.type,sizeBytes:d.file.size,data:K}]);r[o]={...d,status:"success",receiptId:q[0]?.id}}}catch{r[o]={...d,status:"error",error:c("expenses.receipts.uploadFailed")}}l([...r]),z(w=>({...w,current:w.current+1}))}u(!1),r.every(o=>o.status==="success"||o.status==="duplicate")&&g?.()},G=()=>{l(s=>s.map(r=>r.status==="error"?{...r,status:"pending",error:void 0}:r))},B=()=>{l([]),u(!1),S(""),k()},A=i.filter(s=>s.status==="pending").length,W=i.filter(s=>s.status==="success").length,U=i.filter(s=>s.status==="error").length,H=i.filter(s=>s.status==="duplicate").length;return n?e.jsx(ue,{title:c("bulkUpload.title"),onClose:B,footer:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"drawer-footer-left",children:U>0&&!j&&e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:G,children:[c("bulkUpload.retryFailed")," (",U,")"]})}),e.jsxs("div",{className:"drawer-footer-right",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:B,children:c("common.close")}),A>0&&e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Y,disabled:j,children:j?`${c("bulkUpload.uploading")} (${R.current}/${R.total})`:`${c("bulkUpload.upload")} (${A})`})]})]}),children:e.jsxs("div",{className:"bulk-upload-content",children:[e.jsxs("div",{className:"bulk-upload-dropzone",onClick:()=>m.current?.click(),children:[e.jsx("input",{ref:m,type:"file",accept:"image/*,.pdf",multiple:!0,onChange:I,style:{display:"none"}}),e.jsx("div",{className:"bulk-upload-dropzone-icon",children:e.jsx(Se,{})}),e.jsxs("div",{className:"bulk-upload-dropzone-text",children:[e.jsx("span",{className:"bulk-upload-dropzone-title",children:c("bulkUpload.dropzoneTitle")}),e.jsx("span",{className:"bulk-upload-dropzone-hint",children:c("bulkUpload.dropzoneHint",{maxFiles:ne,maxSize:"5MB"})})]})]}),i.length>0&&e.jsxs("div",{className:"bulk-upload-options",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:s=>{E(s.target.checked),s.target.checked&&S("")}}),e.jsx("span",{children:c("bulkUpload.autoDetectMonth")})]}),!v&&e.jsxs("div",{className:"bulk-upload-batch-override",children:[e.jsx("label",{className:"form-label",children:c("bulkUpload.batchMonth")}),e.jsxs("select",{className:"select",value:M,onChange:s=>X(s.target.value),children:[e.jsx("option",{value:"",children:c("bulkUpload.selectMonth")}),F.map(s=>e.jsx("option",{value:s,children:Q(s,f)},s))]})]})]}),i.length>0&&e.jsxs("div",{className:"bulk-upload-stats",children:[e.jsxs("span",{className:"bulk-upload-stat",children:[c("bulkUpload.total"),": ",i.length]}),W>0&&e.jsxs("span",{className:"bulk-upload-stat text-success",children:[c("bulkUpload.success"),": ",W]}),H>0&&e.jsxs("span",{className:"bulk-upload-stat text-warning",children:[c("bulkUpload.duplicates"),": ",H]}),U>0&&e.jsxs("span",{className:"bulk-upload-stat text-danger",children:[c("bulkUpload.errors"),": ",U]})]}),j&&e.jsx("div",{className:"bulk-upload-progress",children:e.jsx("div",{className:"bulk-upload-progress-bar",style:{width:`${R.current/R.total*100}%`}})}),i.length>0&&e.jsx("div",{className:"bulk-upload-files",children:i.map((s,r)=>e.jsxs("div",{className:L("bulk-upload-file",`status-${s.status}`),children:[e.jsxs("div",{className:"bulk-upload-file-info",children:[e.jsx("span",{className:"bulk-upload-file-name",title:s.file.name,children:s.file.name}),e.jsxs("span",{className:"bulk-upload-file-size",children:[(s.file.size/1024).toFixed(1)," KB"]})]}),e.jsx("div",{className:"bulk-upload-file-month",children:v?e.jsx("select",{className:"select select-sm",value:s.overrideMonthKey||s.detectedMonthKey,onChange:h=>C(r,h.target.value),disabled:s.status!=="pending",children:F.map(h=>e.jsx("option",{value:h,children:Q(h,f)},h))}):e.jsx("span",{className:"text-muted text-sm",children:Q($(s),f)})}),e.jsxs("div",{className:"bulk-upload-file-status",children:[s.status==="pending"&&e.jsx("span",{className:"status-badge status-pending",children:c("bulkUpload.statusPending")}),s.status==="uploading"&&e.jsx("span",{className:"status-badge status-uploading",children:e.jsx("span",{className:"spinner-sm"})}),s.status==="success"&&e.jsx("span",{className:"status-badge status-success",children:e.jsx(Ie,{})}),s.status==="duplicate"&&e.jsx("span",{className:"status-badge status-duplicate",title:s.error,children:e.jsx(Ue,{})}),s.status==="error"&&e.jsx("span",{className:"status-badge status-error",title:s.error,children:e.jsx(Ae,{})})]}),s.status==="pending"&&e.jsx("button",{type:"button",className:"bulk-upload-file-remove",onClick:()=>V(r),children:e.jsx(Te,{})})]},`${s.file.name}-${r}`))})]})}):null}function Se(){return e.jsx("svg",{width:"48",height:"48",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"})})}function Ie(){return e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}function Ae(){return e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})})}function Ue(){return e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})})}function Te(){return e.jsx("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}const $e=5*1024*1024;function _e(){const{profileId:a}=re({from:"/expenses/profile/$profileId/receipts"}),n=Z(),{language:k}=ee(),g=se(k),c=new Date,[p,f]=x.useState(`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`),[m,i]=x.useState("all"),[l,j]=x.useState(null),[u,v]=x.useState(null),[E,M]=x.useState(""),[S,R]=x.useState(!1),[z,T]=x.useState(!1),{openExpenseDrawer:_}=pe(),F=x.useRef(null),{data:I,isLoading:V}=me(a),{data:C=[],isLoading:X}=he(a,p),{data:$=[]}=xe(a),{data:P=[],isLoading:Y}=ge(a),G=x.useMemo(()=>({profileId:a,year:parseInt(p.split("-")[0]),month:parseInt(p.split("-")[1])}),[a,p]),{data:B=[]}=je(G),A=be(),W=fe(),U=ae(),H=ve(),s=x.useMemo(()=>{const t=[],b=new Date;for(let N=0;N<12;N++){const D=new Date(b.getFullYear(),b.getMonth()-N,1),le=`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}`,ce=D.toLocaleDateString(g,{year:"numeric",month:"long"});t.push({key:le,label:ce})}return t},[g]),r=m==="inbox"?$:C,h=C.filter(t=>t.expenseId).length,o=C.filter(t=>!t.expenseId).length,d=async t=>{const b=t.target.files;if(!(!b||b.length===0)){M("");for(const N of Array.from(b)){if(N.size>$e){M(n("expenses.receipts.fileTooLarge",{maxSize:"5MB"}));continue}if(!N.type.startsWith("image/")&&N.type!=="application/pdf"){M(n("expenses.receipts.invalidFileType"));continue}try{const D=await Be(N);await A.mutateAsync({profileId:a,monthKey:p,fileName:N.name,mimeType:N.type,sizeBytes:N.size,data:D})}catch{M(n("expenses.receipts.uploadFailed"))}}F.current&&(F.current.value="")}},y=async t=>{if(u)try{await U.mutateAsync({receiptId:u.id,expenseId:t}),v(null)}catch{}},w=async t=>{confirm(n("expenses.receipts.confirmUnlink"))&&await H.mutateAsync(t)},K=async t=>{confirm(n("expenses.receipts.confirmDelete"))&&(await W.mutateAsync(t),j(null))},q=async()=>{if(!(!I||C.length===0)){R(!0);try{await ye(a,I.name,p)}catch(t){console.error("Failed to export receipts:",t)}finally{R(!1)}}},ie=t=>{_({mode:"create",defaultProfileId:a,prefillData:{vendor:t.vendorRaw,amountMinor:t.amountMinor,currency:t.currency,occurredAt:t.occurredAt},linkReceiptId:t.id})};return V?e.jsxs(e.Fragment,{children:[e.jsx(J,{title:n("common.loading"),breadcrumbs:[{label:n("nav.expenses"),href:"/expenses"},{label:n("common.loading"),href:`/expenses/profile/${a}`}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):I?e.jsxs(e.Fragment,{children:[e.jsx(J,{title:n("expenses.receipts.title"),breadcrumbs:[{label:n("nav.expenses"),href:"/expenses"},{label:I.name,href:`/expenses/profile/${a}`},{label:n("expenses.receipts.title")}],filterSlot:e.jsx("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24},children:e.jsx("select",{className:"select",value:p,onChange:t=>f(t.target.value),children:s.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))})})}),e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"receipts-stats",children:[e.jsxs("div",{className:"receipts-stat",children:[e.jsx("span",{className:"receipts-stat-value",children:C.length}),e.jsx("span",{className:"receipts-stat-label",children:n("expenses.receipts.total")})]}),e.jsxs("div",{className:"receipts-stat",children:[e.jsx("span",{className:"receipts-stat-value text-success",children:h}),e.jsx("span",{className:"receipts-stat-label",children:n("expenses.receipts.linked")})]}),e.jsxs("div",{className:"receipts-stat",children:[e.jsx("span",{className:"receipts-stat-value text-warning",children:o}),e.jsx("span",{className:"receipts-stat-label",children:n("expenses.receipts.unlinked")})]})]}),e.jsxs("div",{className:"receipts-upload-section",children:[e.jsx("input",{ref:F,type:"file",accept:"image/*,.pdf",multiple:!0,onChange:d,style:{display:"none"}}),e.jsx("button",{className:"btn btn-primary",onClick:()=>F.current?.click(),disabled:A.isPending,children:A.isPending?n("expenses.receipts.uploading"):n("expenses.receipts.upload")}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>T(!0),children:n("bulkUpload.button")}),C.length>0&&e.jsx("button",{className:"btn btn-secondary",onClick:q,disabled:S,children:n(S?"expenses.receipts.exporting":"expenses.receipts.exportZip")}),E&&e.jsx("span",{className:"text-danger text-sm",children:E})]}),e.jsx("div",{className:"tabs",style:{marginBottom:16},children:e.jsxs("div",{className:"tabs-list",children:[e.jsxs("button",{className:L("tab",m==="all"&&"active"),onClick:()=>i("all"),children:[n("expenses.receipts.allTab")," (",C.length,")"]}),e.jsxs("button",{className:L("tab",m==="inbox"&&"active"),onClick:()=>i("inbox"),children:[n("expenses.receipts.inboxTab")," (",$.length,")"]}),e.jsxs("button",{className:L("tab",m==="suggestions"&&"active"),onClick:()=>i("suggestions"),children:[n("expenses.receipts.suggestionsTab")," (",P.length,")"]})]})}),m==="suggestions"?e.jsx(Le,{items:P,isLoading:Y,onLinkSuccess:()=>{},onCreateExpense:ie,groupByConfidence:!0}):X?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):r.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:n("expenses.receipts.empty")}),e.jsx("p",{className:"empty-state-description",children:n("expenses.receipts.emptyHint")})]}):e.jsx("div",{className:"receipts-grid",children:r.map(t=>e.jsxs("div",{className:L("receipt-card",!t.expenseId&&"unlinked",l?.id===t.id&&"selected"),onClick:()=>j(t),children:[e.jsx("div",{className:"receipt-thumbnail",children:t.mimeType.startsWith("image/")?e.jsx("img",{src:`data:${t.mimeType};base64,${t.data}`,alt:""}):e.jsx("div",{className:"receipt-pdf-icon",children:e.jsx(De,{})})}),e.jsxs("div",{className:"receipt-info",children:[e.jsx("div",{className:"receipt-filename",title:t.fileName,children:t.fileName}),e.jsxs("div",{className:"receipt-meta",children:[e.jsx("span",{className:"text-muted text-sm",children:O(t.createdAt,g)}),t.expenseId?e.jsx("span",{className:"receipt-status linked",children:n("expenses.receipts.linked")}):e.jsx("span",{className:"receipt-status unlinked",children:n("expenses.receipts.unlinked")})]})]}),e.jsxs("div",{className:"receipt-actions",children:[t.expenseId?e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:b=>{b.stopPropagation(),w(t.id)},children:n("expenses.receipts.unlink")}):e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:b=>{b.stopPropagation(),v(t)},children:n("expenses.receipts.link")}),e.jsx("button",{className:"btn btn-ghost btn-sm text-danger",onClick:b=>{b.stopPropagation(),K(t.id)},children:n("common.delete")})]})]},t.id))}),u&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(null),children:e.jsxs("div",{className:"modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:n("expenses.receipts.linkToExpense")}),e.jsx("button",{className:"modal-close",onClick:()=>v(null),children:"×"})]}),e.jsx("div",{className:"modal-body",children:B.length===0?e.jsx("p",{className:"text-muted",children:n("expenses.receipts.noExpensesToLink")}):e.jsx("div",{className:"link-expense-list",children:B.map(t=>e.jsxs("button",{className:"link-expense-item",onClick:()=>y(t.id),children:[e.jsxs("div",{className:"link-expense-info",children:[e.jsx("span",{className:"link-expense-title",children:t.title||t.vendor||n("expenses.untitled")}),e.jsx("span",{className:"link-expense-date",children:O(t.occurredAt,g)})]}),e.jsxs("span",{className:"link-expense-amount amount-negative",children:[t.currency," ",(t.amountMinor/100).toFixed(2)]})]},t.id))})})]})}),l&&e.jsx("div",{className:"modal-overlay",onClick:()=>j(null),children:e.jsxs("div",{className:"modal modal-lg",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:l.fileName}),e.jsx("button",{className:"modal-close",onClick:()=>j(null),children:"×"})]}),e.jsx("div",{className:"modal-body receipt-preview-body",children:l.mimeType.startsWith("image/")?e.jsx("img",{src:`data:${l.mimeType};base64,${l.data}`,alt:"",className:"receipt-preview-image"}):e.jsx("iframe",{src:`data:${l.mimeType};base64,${l.data}`,className:"receipt-preview-pdf",title:l.fileName})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("a",{href:`data:${l.mimeType};base64,${l.data}`,download:l.fileName,className:"btn btn-secondary",children:n("expenses.receipts.download")}),e.jsx("button",{className:"btn btn-danger",onClick:()=>K(l.id),children:n("common.delete")})]})]})}),e.jsx(Fe,{profileId:a,isOpen:z,onClose:()=>T(!1),onSuccess:()=>{T(!1)}})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{title:n("expenses.profileNotFound"),breadcrumbs:[{label:n("nav.expenses"),href:"/expenses"}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"empty-state",children:e.jsx("h3",{className:"empty-state-title",children:n("expenses.profileNotFound")})})})]})}function Be(a){return new Promise((n,k)=>{const g=new FileReader;g.onload=()=>{const p=g.result.split(",")[1];n(p)},g.onerror=k,g.readAsDataURL(a)})}function De(){return e.jsx("svg",{width:"48",height:"48",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}export{_e as ReceiptsPage};
