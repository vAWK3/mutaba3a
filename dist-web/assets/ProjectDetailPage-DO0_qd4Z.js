import{g as F,r as d,j as s}from"./vendor-router-D4Yqsbqz.js";import{d as R,e as P,u as U,a as L,f as w,r as E,s as B,h as z,T as x,p as m,c as u,D as H,S as q,g as O,j as $,l as G,m as J,n as K}from"./index-WOWG8CNN.js";import{S as Q}from"./StatusSegment-S_JJYS48.js";/* empty css              */import{R as V}from"./RowActionsMenu-L_ZpjB9G.js";import{C as W}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-Bf8hyTk9.js";/* empty css                       */function cs(){const{projectId:r}=F({from:"/projects/$projectId"}),{openTransactionDrawer:p,openProjectDrawer:N}=R(),M=P(),e=U(),{language:I}=L(),b=K(I),[l,g]=d.useState("summary"),[n,S]=d.useState(()=>w("all")),[j,T]=d.useState(void 0),[h,k]=d.useState(""),{data:i,isLoading:f}=E(r),{data:a}=B(r,{dateFrom:n.dateFrom,dateTo:n.dateTo}),A=d.useMemo(()=>({projectId:r,dateFrom:n.dateFrom,dateTo:n.dateTo,status:j,search:h||void 0,sort:{by:"occurredAt",dir:"desc"}}),[r,n,j,h]),{data:y=[]}=z(A),C=t=>{p({mode:"edit",transactionId:t})},v=()=>{p({mode:"create",defaultProjectId:r,defaultClientId:i?.clientId})};return f?s.jsxs(s.Fragment,{children:[s.jsx(x,{title:e("common.loading"),breadcrumbs:[{label:e("nav.projects"),href:"/projects"}]}),s.jsx("div",{className:"page-content",children:s.jsx("div",{className:"loading",children:s.jsx("div",{className:"spinner"})})})]}):i?s.jsxs(s.Fragment,{children:[s.jsx(x,{title:i.name,breadcrumbs:[{label:e("nav.projects"),href:"/projects"},{label:i.name}],rightSlot:s.jsx("button",{className:"btn btn-ghost",onClick:()=>N({mode:"edit",projectId:r}),children:e("common.edit")})}),s.jsxs("div",{className:"page-content",children:[a&&s.jsxs("div",{className:"inline-stats",style:{marginBottom:24},children:[s.jsxs("div",{className:"inline-stat",children:[s.jsx("span",{className:"inline-stat-label",children:e("projects.columns.paid")}),s.jsx(m,{usdAmountMinor:a.paidIncomeMinorUSD??0,ilsAmountMinor:a.paidIncomeMinorILS??0,eurAmountMinor:a.paidIncomeMinorEUR??0,type:"income"})]}),s.jsxs("div",{className:"inline-stat",children:[s.jsx("span",{className:"inline-stat-label",children:e("projects.columns.unpaid")}),s.jsx(m,{usdAmountMinor:a.unpaidIncomeMinorUSD??0,ilsAmountMinor:a.unpaidIncomeMinorILS??0,eurAmountMinor:a.unpaidIncomeMinorEUR??0,type:"neutral"})]}),s.jsxs("div",{className:"inline-stat",children:[s.jsx("span",{className:"inline-stat-label",children:e("projects.columns.expenses")}),s.jsx(m,{usdAmountMinor:a.expensesMinorUSD??0,ilsAmountMinor:a.expensesMinorILS??0,eurAmountMinor:a.expensesMinorEUR??0,type:"expense"})]}),s.jsxs("div",{className:"inline-stat",children:[s.jsx("span",{className:"inline-stat-label",children:e("projects.columns.net")}),s.jsx(m,{usdAmountMinor:(a.paidIncomeMinorUSD??0)-(a.expensesMinorUSD??0),ilsAmountMinor:(a.paidIncomeMinorILS??0)-(a.expensesMinorILS??0),eurAmountMinor:(a.paidIncomeMinorEUR??0)-(a.expensesMinorEUR??0),type:"net"})]})]}),s.jsx("div",{className:"tabs",children:s.jsxs("div",{className:"tabs-list",children:[s.jsx("button",{className:u("tab",l==="summary"&&"active"),onClick:()=>g("summary"),children:e("projects.tabs.summary")}),s.jsx("button",{className:u("tab",l==="transactions"&&"active"),onClick:()=>g("transactions"),children:e("projects.tabs.transactions")})]})}),l==="summary"&&s.jsxs("div",{children:[s.jsxs("div",{className:"card",style:{marginBottom:16},children:[s.jsx("h4",{style:{marginBottom:12},children:e("projects.detail.projectDetails")}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16},children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-muted text-sm",children:e("projects.columns.client")}),s.jsx("div",{children:a?.clientName||"-"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-muted text-sm",children:e("projects.columns.field")}),s.jsx("div",{children:i.field||"-"})]})]}),i.notes&&s.jsxs("div",{style:{marginTop:16},children:[s.jsx("div",{className:"text-muted text-sm",children:e("drawer.project.notes")}),s.jsx("div",{children:i.notes})]})]}),s.jsx("button",{className:"btn btn-primary",onClick:v,children:e("transactions.addTransaction")})]}),l==="transactions"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"filters-row",children:[s.jsx(H,{dateFrom:n.dateFrom,dateTo:n.dateTo,onChange:(t,c)=>S({dateFrom:t,dateTo:c})}),s.jsx(Q,{value:j,onChange:T}),s.jsx(q,{value:h,onChange:k})]}),y.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("h3",{className:"empty-state-title",children:e("projects.detail.noTransactions")}),s.jsx("p",{className:"empty-state-description",children:e("projects.detail.noTransactionsHint")}),s.jsx("button",{className:"btn btn-primary",onClick:v,children:e("transactions.addTransaction")})]}):s.jsx("div",{className:"data-table",children:s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:e("transactions.columns.date")}),s.jsx("th",{children:e("transactions.columns.type")}),s.jsx("th",{children:e("transactions.columns.client")}),s.jsx("th",{children:e("transactions.columns.category")}),s.jsx("th",{style:{textAlign:"end"},children:e("transactions.columns.amount")}),s.jsx("th",{children:e("transactions.columns.status")}),s.jsx("th",{style:{width:40}})]})}),s.jsx("tbody",{children:y.map(t=>{const c=t.kind==="income"&&t.status==="unpaid",o=t.dueDate?O(t.dueDate):null,D=o!==null&&o<0;return s.jsxs("tr",{className:"clickable",onClick:()=>C(t.id),children:[s.jsx("td",{children:$(t.occurredAt,b)}),s.jsx("td",{children:s.jsx("span",{className:u("type-badge",t.kind==="expense"&&"expense",t.kind==="income"&&t.status==="paid"&&"income",c&&"receivable"),children:c?e("transactions.type.receivable"):t.kind==="income"?e("transactions.type.income"):e("transactions.type.expense")})}),s.jsx("td",{className:"text-secondary",children:t.clientName||"-"}),s.jsx("td",{className:"text-secondary",children:t.categoryName||"-"}),s.jsxs("td",{className:u("amount-cell",t.kind==="income"&&"amount-positive",t.kind==="expense"&&"amount-negative"),children:[t.kind==="expense"?"-":"",G(t.amountMinor,t.currency,b)]}),s.jsx("td",{children:t.kind==="income"&&s.jsx(s.Fragment,{children:t.status==="paid"?s.jsx("span",{className:"status-badge paid",children:e("transactions.status.paid")}):D?s.jsx("span",{className:"status-badge overdue",children:e("transactions.status.overdue",{days:Math.abs(o)})}):s.jsx("span",{className:"status-badge unpaid",children:o===0?e("transactions.status.dueToday"):e("transactions.status.dueIn",{days:o??0})})})}),s.jsx("td",{children:s.jsx(V,{actions:[...c?[{label:e("common.markPaid"),icon:s.jsx(J,{size:16}),onClick:()=>M.mutate(t.id)}]:[],{label:e("common.duplicate"),icon:s.jsx(W,{size:16}),onClick:()=>p({mode:"create",duplicateFromId:t.id})}]})})]},t.id)})})]})})]})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(x,{title:e("projects.notFound"),breadcrumbs:[{label:e("nav.projects"),href:"/projects"}]}),s.jsx("div",{className:"page-content",children:s.jsxs("div",{className:"empty-state",children:[s.jsx("h3",{className:"empty-state-title",children:e("projects.notFound")}),s.jsx("p",{className:"empty-state-description",children:e("projects.notFoundHint")})]})})]})}export{cs as ProjectDetailPage};
