import{g as P,r as d,j as e}from"./vendor-router-D4Yqsbqz.js";import{d as w,e as R,u as A,a as B,f as z,r as E,s as H,h as q,T as g,m as i,c as j,D as O,i as $,S as G,g as J,k as K,n as Q,o as V}from"./index-DobPoVyB.js";import{S as W}from"./StatusSegment-CYrejh5y.js";/* empty css              */import{R as X}from"./RowActionsMenu-L_ZpjB9G.js";import{C as Y}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";/* empty css                       */function de(){const{projectId:o}=P({from:"/projects/$projectId"}),{openTransactionDrawer:h,openProjectDrawer:S}=w(),D=R(),s=A(),{language:I}=B(),t=V(I),[u,b]=d.useState("summary"),[c,M]=d.useState(()=>z("all")),[p,T]=d.useState(void 0),[x,k]=d.useState(void 0),[v,F]=d.useState(""),{data:r,isLoading:f}=E(o),{data:n}=H(o,{dateFrom:c.dateFrom,dateTo:c.dateTo}),C=d.useMemo(()=>({projectId:o,dateFrom:c.dateFrom,dateTo:c.dateTo,currency:p,status:x,search:v||void 0,sort:{by:"occurredAt",dir:"desc"}}),[o,c,p,x,v]),{data:N=[]}=q(C),U=a=>{h({mode:"edit",transactionId:a})},y=()=>{h({mode:"create",defaultProjectId:o,defaultClientId:r?.clientId})};return f?e.jsxs(e.Fragment,{children:[e.jsx(g,{title:s("common.loading"),breadcrumbs:[{label:s("nav.projects"),href:"/projects"}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):r?e.jsxs(e.Fragment,{children:[e.jsx(g,{title:r.name,breadcrumbs:[{label:s("nav.projects"),href:"/projects"},{label:r.name}],rightSlot:e.jsx("button",{className:"btn btn-ghost",onClick:()=>S({mode:"edit",projectId:o}),children:s("common.edit")})}),e.jsxs("div",{className:"page-content",children:[n&&e.jsxs("div",{className:"inline-stats",style:{marginBottom:24},children:[e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.paid")}),e.jsx("div",{className:"inline-stat-value text-success",children:n.paidIncomeMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i(n.paidIncomeMinorUSD,"USD",t)}),e.jsx("div",{children:i(n.paidIncomeMinorILS??0,"ILS",t)})]}):i(n.paidIncomeMinor,"USD",t)})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.unpaid")}),e.jsx("div",{className:"inline-stat-value text-warning",children:n.unpaidIncomeMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i(n.unpaidIncomeMinorUSD,"USD",t)}),e.jsx("div",{children:i(n.unpaidIncomeMinorILS??0,"ILS",t)})]}):i(n.unpaidIncomeMinor,"USD",t)})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.expenses")}),e.jsx("div",{className:"inline-stat-value",children:n.expensesMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i(n.expensesMinorUSD,"USD",t)}),e.jsx("div",{children:i(n.expensesMinorILS??0,"ILS",t)})]}):i(n.expensesMinor,"USD",t)})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.net")}),e.jsx("div",{className:j("inline-stat-value",n.netMinor>=0?"text-success":"text-danger"),children:n.paidIncomeMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i((n.paidIncomeMinorUSD??0)-(n.expensesMinorUSD??0),"USD",t)}),e.jsx("div",{children:i((n.paidIncomeMinorILS??0)-(n.expensesMinorILS??0),"ILS",t)})]}):i(n.netMinor,"USD",t)})]})]}),e.jsx("div",{className:"tabs",children:e.jsxs("div",{className:"tabs-list",children:[e.jsx("button",{className:j("tab",u==="summary"&&"active"),onClick:()=>b("summary"),children:s("projects.tabs.summary")}),e.jsx("button",{className:j("tab",u==="transactions"&&"active"),onClick:()=>b("transactions"),children:s("projects.tabs.transactions")})]})}),u==="summary"&&e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsx("h4",{style:{marginBottom:12},children:s("projects.detail.projectDetails")}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("projects.columns.client")}),e.jsx("div",{children:n?.clientName||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("projects.columns.field")}),e.jsx("div",{children:r.field||"-"})]})]}),r.notes&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{className:"text-muted text-sm",children:s("drawer.project.notes")}),e.jsx("div",{children:r.notes})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:y,children:s("transactions.addTransaction")})]}),u==="transactions"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"filters-row",children:[e.jsx(O,{dateFrom:c.dateFrom,dateTo:c.dateTo,onChange:(a,l)=>M({dateFrom:a,dateTo:l})}),e.jsx($,{value:p,onChange:T}),e.jsx(W,{value:x,onChange:k}),e.jsx(G,{value:v,onChange:F})]}),N.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("projects.detail.noTransactions")}),e.jsx("p",{className:"empty-state-description",children:s("projects.detail.noTransactionsHint")}),e.jsx("button",{className:"btn btn-primary",onClick:y,children:s("transactions.addTransaction")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("transactions.columns.date")}),e.jsx("th",{children:s("transactions.columns.type")}),e.jsx("th",{children:s("transactions.columns.client")}),e.jsx("th",{children:s("transactions.columns.category")}),e.jsx("th",{style:{textAlign:"end"},children:s("transactions.columns.amount")}),e.jsx("th",{children:s("transactions.columns.status")}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:N.map(a=>{const l=a.kind==="income"&&a.status==="unpaid",m=a.dueDate?J(a.dueDate):null,L=m!==null&&m<0;return e.jsxs("tr",{className:"clickable",onClick:()=>U(a.id),children:[e.jsx("td",{children:K(a.occurredAt,t)}),e.jsx("td",{children:e.jsx("span",{className:j("type-badge",a.kind==="expense"&&"expense",a.kind==="income"&&a.status==="paid"&&"income",l&&"receivable"),children:l?s("transactions.type.receivable"):a.kind==="income"?s("transactions.type.income"):s("transactions.type.expense")})}),e.jsx("td",{className:"text-secondary",children:a.clientName||"-"}),e.jsx("td",{className:"text-secondary",children:a.categoryName||"-"}),e.jsxs("td",{className:j("amount-cell",a.kind==="income"&&"amount-positive",a.kind==="expense"&&"amount-negative"),children:[a.kind==="expense"?"-":"",i(a.amountMinor,a.currency,t)]}),e.jsx("td",{children:a.kind==="income"&&e.jsx(e.Fragment,{children:a.status==="paid"?e.jsx("span",{className:"status-badge paid",children:s("transactions.status.paid")}):L?e.jsx("span",{className:"status-badge overdue",children:s("transactions.status.overdue",{days:Math.abs(m)})}):e.jsx("span",{className:"status-badge unpaid",children:m===0?s("transactions.status.dueToday"):s("transactions.status.dueIn",{days:m??0})})})}),e.jsx("td",{children:e.jsx(X,{actions:[...l?[{label:s("common.markPaid"),icon:e.jsx(Q,{size:16}),onClick:()=>D.mutate(a.id)}]:[],{label:s("common.duplicate"),icon:e.jsx(Y,{size:16}),onClick:()=>h({mode:"create",duplicateFromId:a.id})}]})})]},a.id)})})]})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{title:s("projects.notFound"),breadcrumbs:[{label:s("nav.projects"),href:"/projects"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("projects.notFound")}),e.jsx("p",{className:"empty-state-description",children:s("projects.notFoundHint")})]})})]})}export{de as ProjectDetailPage};
