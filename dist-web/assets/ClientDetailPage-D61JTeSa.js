import{g as $,r as o,j as e,L as q}from"./vendor-router-D4Yqsbqz.js";import{d as W,e as G,u as J,a as K,f as Q,v as V,w as X,x as Y,h as D,T as b,p as F,c as m,g as I,j as T,l as M,m as S,D as Z,S as _,n as ee}from"./index-DxpiON0U.js";import{S as se}from"./StatusSegment-lQ9dq4F8.js";/* empty css              */import{R as P}from"./RowActionsMenu-L_ZpjB9G.js";import{C as A}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";/* empty css                       */function he(){const{clientId:a}=$({from:"/clients/$clientId"}),{openTransactionDrawer:u,openClientDrawer:R,openProjectDrawer:v}=W(),y=G(),s=J(),{language:w}=K(),h=ee(w),[i,j]=o.useState("summary"),[r,L]=o.useState(()=>Q("all")),[p,U]=o.useState(void 0),[x,z]=o.useState(""),{data:d,isLoading:B}=V(a),{data:c}=X(a,{dateFrom:r.dateFrom,dateTo:r.dateTo}),{data:N=[]}=Y(a),E=o.useMemo(()=>({clientId:a,dateFrom:r.dateFrom,dateTo:r.dateTo,status:p,search:x||void 0,sort:{by:"occurredAt",dir:"desc"}}),[a,r,p,x]),H=o.useMemo(()=>({clientId:a,kind:"income",status:"unpaid",sort:{by:"dueDate",dir:"asc"}}),[a]),{data:g=[]}=D(E),{data:k=[]}=D(H),C=t=>{u({mode:"edit",transactionId:t})},f=()=>{u({mode:"create",defaultClientId:a})};return B?e.jsxs(e.Fragment,{children:[e.jsx(b,{title:s("common.loading"),breadcrumbs:[{label:s("nav.clients"),href:"/clients"}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):d?e.jsxs(e.Fragment,{children:[e.jsx(b,{title:d.name,breadcrumbs:[{label:s("nav.clients"),href:"/clients"},{label:d.name}],rightSlot:e.jsx("button",{className:"btn btn-ghost",onClick:()=>R({mode:"edit",clientId:a}),children:s("common.edit")})}),e.jsxs("div",{className:"page-content",children:[c&&e.jsxs("div",{className:"inline-stats",style:{marginBottom:24},children:[e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("clients.columns.activeProjects")}),e.jsx("span",{className:"inline-stat-value",children:c.activeProjectCount})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("clients.columns.paidIncome")}),e.jsx(F,{usdAmountMinor:c.paidIncomeMinorUSD??0,ilsAmountMinor:c.paidIncomeMinorILS??0,eurAmountMinor:c.paidIncomeMinorEUR??0,type:"income"})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("clients.columns.unpaid")}),e.jsx(F,{usdAmountMinor:c.unpaidIncomeMinorUSD??0,ilsAmountMinor:c.unpaidIncomeMinorILS??0,eurAmountMinor:c.unpaidIncomeMinorEUR??0,type:"neutral"})]})]}),e.jsx("div",{className:"tabs",children:e.jsxs("div",{className:"tabs-list",children:[e.jsx("button",{className:m("tab",i==="summary"&&"active"),onClick:()=>j("summary"),children:s("clients.tabs.summary")}),e.jsx("button",{className:m("tab",i==="projects"&&"active"),onClick:()=>j("projects"),children:s("clients.tabs.projects")}),e.jsx("button",{className:m("tab",i==="receivables"&&"active"),onClick:()=>j("receivables"),children:s("clients.tabs.receivables")}),e.jsx("button",{className:m("tab",i==="transactions"&&"active"),onClick:()=>j("transactions"),children:s("clients.tabs.transactions")})]})}),i==="summary"&&e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsx("h4",{style:{marginBottom:12},children:s("clients.detail.clientDetails")}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("clients.detail.email")}),e.jsx("div",{children:d.email||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("clients.detail.phone")}),e.jsx("div",{children:d.phone||"-"})]})]}),d.notes&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{className:"text-muted text-sm",children:s("drawer.client.notes")}),e.jsx("div",{children:d.notes})]})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("button",{className:"btn btn-primary",onClick:f,children:s("transactions.addTransaction")}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>v({mode:"create",defaultClientId:a}),children:s("projects.addProject")})]})]}),i==="projects"&&e.jsx(e.Fragment,{children:N.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.detail.noProjects")}),e.jsx("p",{className:"empty-state-description",children:s("clients.detail.noProjectsHint")}),e.jsx("button",{className:"btn btn-primary",onClick:()=>v({mode:"create",defaultClientId:a}),children:s("projects.addProject")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("projects.columns.project")}),e.jsx("th",{children:s("projects.columns.field")})]})}),e.jsx("tbody",{children:N.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(q,{to:"/projects/$projectId",params:{projectId:t.id},style:{fontWeight:500},children:t.name})}),e.jsx("td",{className:"text-secondary",children:t.field||"-"})]},t.id))})]})})}),i==="receivables"&&e.jsx(e.Fragment,{children:k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.detail.noReceivables")}),e.jsx("p",{className:"empty-state-description",children:s("clients.detail.noReceivablesHint")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("clients.receivables.dueDate")}),e.jsx("th",{children:s("transactions.columns.project")}),e.jsx("th",{style:{textAlign:"end"},children:s("transactions.columns.amount")}),e.jsx("th",{children:s("clients.receivables.daysOverdue")}),e.jsx("th",{children:s("transactions.columns.status")}),e.jsx("th",{style:{width:80},children:s("clients.receivables.action")})]})}),e.jsx("tbody",{children:k.map(t=>{const l=t.dueDate?I(t.dueDate):0,n=l<0;return e.jsxs("tr",{className:"clickable",onClick:()=>C(t.id),children:[e.jsx("td",{children:t.dueDate?T(t.dueDate,h):"-"}),e.jsx("td",{className:"text-secondary",children:t.projectName||"-"}),e.jsx("td",{className:"amount-cell",style:{color:"var(--color-warning)"},children:M(t.amountMinor,t.currency,h)}),e.jsx("td",{className:n?"text-danger":"text-muted",children:n?Math.abs(l):"-"}),e.jsx("td",{children:n?e.jsx("span",{className:"status-badge overdue",children:s("filters.status.overdue")}):e.jsx("span",{className:"status-badge unpaid",children:s("filters.status.unpaid")})}),e.jsx("td",{children:e.jsx(P,{actions:[{label:s("common.markPaid"),icon:e.jsx(S,{size:16}),onClick:()=>y.mutate(t.id)},{label:s("common.duplicate"),icon:e.jsx(A,{size:16}),onClick:()=>u({mode:"create",duplicateFromId:t.id})}]})})]},t.id)})})]})})}),i==="transactions"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"filters-row",children:[e.jsx(Z,{dateFrom:r.dateFrom,dateTo:r.dateTo,onChange:(t,l)=>L({dateFrom:t,dateTo:l})}),e.jsx(se,{value:p,onChange:U}),e.jsx(_,{value:x,onChange:z})]}),g.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.detail.noTransactions")}),e.jsx("p",{className:"empty-state-description",children:s("clients.detail.noTransactionsHint")}),e.jsx("button",{className:"btn btn-primary",onClick:f,children:s("transactions.addTransaction")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("transactions.columns.date")}),e.jsx("th",{children:s("transactions.columns.type")}),e.jsx("th",{children:s("transactions.columns.project")}),e.jsx("th",{children:s("transactions.columns.category")}),e.jsx("th",{style:{textAlign:"end"},children:s("transactions.columns.amount")}),e.jsx("th",{children:s("transactions.columns.status")}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:g.map(t=>{const l=t.kind==="income"&&t.status==="unpaid",n=t.dueDate?I(t.dueDate):null,O=n!==null&&n<0;return e.jsxs("tr",{className:"clickable",onClick:()=>C(t.id),children:[e.jsx("td",{children:T(t.occurredAt,h)}),e.jsx("td",{children:e.jsx("span",{className:m("type-badge",t.kind==="expense"&&"expense",t.kind==="income"&&t.status==="paid"&&"income",l&&"receivable"),children:l?s("transactions.type.receivable"):t.kind==="income"?s("transactions.type.income"):s("transactions.type.expense")})}),e.jsx("td",{className:"text-secondary",children:t.projectName||"-"}),e.jsx("td",{className:"text-secondary",children:t.categoryName||"-"}),e.jsxs("td",{className:m("amount-cell",t.kind==="income"&&"amount-positive",t.kind==="expense"&&"amount-negative"),children:[t.kind==="expense"?"-":"",M(t.amountMinor,t.currency,h)]}),e.jsx("td",{children:t.kind==="income"&&e.jsx(e.Fragment,{children:t.status==="paid"?e.jsx("span",{className:"status-badge paid",children:s("transactions.status.paid")}):O?e.jsx("span",{className:"status-badge overdue",children:s("transactions.status.overdue",{days:Math.abs(n)})}):e.jsx("span",{className:"status-badge unpaid",children:n===0?s("transactions.status.dueToday"):s("transactions.status.dueIn",{days:n??0})})})}),e.jsx("td",{children:e.jsx(P,{actions:[...l?[{label:s("common.markPaid"),icon:e.jsx(S,{size:16}),onClick:()=>y.mutate(t.id)}]:[],{label:s("common.duplicate"),icon:e.jsx(A,{size:16}),onClick:()=>u({mode:"create",duplicateFromId:t.id})}]})})]},t.id)})})]})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{title:s("clients.notFound"),breadcrumbs:[{label:s("nav.clients"),href:"/clients"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.notFound")}),e.jsx("p",{className:"empty-state-description",children:s("clients.notFoundHint")})]})})]})}export{he as ClientDetailPage};
