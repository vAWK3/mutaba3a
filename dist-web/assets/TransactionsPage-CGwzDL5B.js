import{j as e,r as o,f as M}from"./vendor-router-D4Yqsbqz.js";import{u as g,c as j,g as b,d as P,e as A,a as E,f as R,h as L,T as K,D as B,S as U,i as H,j as z,k as O,l as V,m as W,n as $}from"./index-DxpiON0U.js";import{S as G}from"./StatusSegment-lQ9dq4F8.js";/* empty css              */import{E as Q}from"./EmptyState-r3axvhwz.js";import{R as Z}from"./RowActionsMenu-L_ZpjB9G.js";import{C as q}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";/* empty css                       */function J({value:n,onChange:r}){const c=g(),a=[{value:void 0,labelKey:"filters.type.all"},{value:"income",labelKey:"filters.type.income"},{value:"receivable",labelKey:"filters.type.receivable"},{value:"expense",labelKey:"filters.type.expense"}];return e.jsx("div",{className:"segment-control",children:a.map(s=>e.jsx("button",{className:j("segment-button",n===s.value&&"active"),onClick:()=>r(s.value),children:c(s.labelKey)},s.labelKey))})}function X({size:n=16,className:r}){return e.jsx("svg",{width:n,height:n,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:r,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}function Y({kind:n,status:r,dueDate:c}){const a=g();if(n!=="income")return null;if(r==="paid")return e.jsx("span",{className:"status-badge paid",children:a("transactions.status.paid")});const s=c?b(c):null;return s!==null&&s<0?e.jsx("span",{className:"status-badge overdue",children:a("transactions.status.overdue",{days:Math.abs(s)})}):e.jsx("span",{className:"status-badge unpaid",children:s===0?a("transactions.status.dueToday"):a("transactions.status.dueIn",{days:s??0})})}function _(n){const[r,c]=o.useState(()=>typeof window<"u"&&window.matchMedia(n).matches);return o.useEffect(()=>{if(typeof window>"u")return;const a=window.matchMedia(n),s=u=>c(u.matches);return Promise.resolve().then(()=>{c(a.matches)}),a.addEventListener("change",s),()=>a.removeEventListener("change",s)},[n]),r}function ee(){return _("(max-width: 768px)")}function pe(){const{openTransactionDrawer:n,openDocumentDrawer:r}=P(),c=A(),a=g(),{language:s}=E(),u=$(s),i=M({strict:!1}),[m,w]=o.useState(()=>i.dateFrom&&i.dateTo?{dateFrom:i.dateFrom,dateTo:i.dateTo}:R("all")),y=o.useMemo(()=>i.kind==="income"&&i.status==="unpaid"?"receivable":i.kind,[i.kind,i.status]),[d,T]=o.useState(y),[p,C]=o.useState(y==="receivable"?void 0:i.status),[h,D]=o.useState(""),[k,S]=o.useState(!1);o.useEffect(()=>{!k&&(i.dateFrom||i.kind)&&S(!0)},[k,i]);const N=o.useMemo(()=>{const t={dateFrom:m.dateFrom,dateTo:m.dateTo,search:h||void 0,sort:{by:"occurredAt",dir:"desc"}};return d==="receivable"?(t.kind="income",t.status="unpaid"):d&&(t.kind=d),p&&d!=="receivable"&&(t.status=p),t},[m,d,p,h]),{data:x=[],isLoading:I}=L(N),l=ee(),v=t=>t.kind!=="income"?null:t.status==="paid"?"paid":t.dueDate&&b(t.dueDate)<0?"overdue":"unpaid",F=t=>{n({mode:"edit",transactionId:t})};return e.jsxs(e.Fragment,{children:[e.jsx(K,{title:a("transactions.title"),filterSlot:e.jsx("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24,flexWrap:"nowrap"},children:e.jsx(B,{dateFrom:m.dateFrom,dateTo:m.dateTo,onChange:(t,f)=>w({dateFrom:t,dateTo:f})})})}),e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"filters-row",children:[e.jsx(J,{value:d,onChange:T}),e.jsx(G,{value:p,onChange:C}),e.jsx(U,{value:h,onChange:D,placeholder:a("transactions.searchPlaceholder")})]}),I?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):x.length===0?e.jsx(Q,{title:a("transactions.empty"),description:a(h?"transactions.emptySearch":"transactions.emptyHint"),action:{label:a("transactions.addTransaction"),onClick:()=>n({mode:"create"})}}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a("transactions.columns.date")}),e.jsx("th",{children:a("transactions.columns.type")}),e.jsx("th",{children:a("transactions.columns.client")}),e.jsx("th",{children:a("transactions.columns.project")}),e.jsx("th",{style:{textAlign:"end"},children:a("transactions.columns.amount")}),!l&&e.jsx("th",{children:a("transactions.columns.status")}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:x.map(t=>e.jsxs("tr",{className:"clickable",onClick:()=>F(t.id),children:[e.jsxs("td",{className:l?"date-cell-compact":void 0,children:[l&&v(t)&&e.jsx("span",{className:"status-dot","data-status":v(t),"aria-label":v(t)||void 0}),l?H(t.occurredAt):z(t.occurredAt,u)]}),e.jsx("td",{children:e.jsx(O,{kind:t.kind,status:t.status})}),e.jsx("td",{className:j("text-secondary",l&&"text-sm-responsive"),children:t.clientName||"-"}),e.jsx("td",{className:j("text-secondary",l&&"text-sm-responsive"),children:t.projectName||"-"}),e.jsxs("td",{className:j("amount-cell",t.kind==="income"&&"amount-positive",t.kind==="expense"&&"amount-negative"),children:[t.kind==="expense"?"-":"",V(t.amountMinor,t.currency,u)]}),!l&&e.jsx("td",{children:e.jsx(Y,{kind:t.kind,status:t.status,dueDate:t.dueDate})}),e.jsxs("td",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(Z,{actions:[...t.kind==="income"&&t.status==="unpaid"?[{label:a("common.markPaid"),icon:e.jsx(W,{size:16}),onClick:()=>c.mutate(t.id)}]:[],{label:a("common.duplicate"),icon:e.jsx(q,{size:16}),onClick:()=>n({mode:"create",duplicateFromId:t.id})},...t.kind==="income"&&!t.linkedDocumentId?[{label:"Generate Invoice",onClick:()=>r({mode:"create",defaultType:t.status==="paid"?"receipt":"invoice",defaultClientId:t.clientId})}]:[],...t.linkedDocumentId?[{label:"View Invoice",onClick:()=>{window.location.href=`/documents/${t.linkedDocumentId}`}}]:[]]}),t.linkedDocumentId&&e.jsx("span",{className:"doc-indicator",title:a("transactions.hasDocument"),onClick:f=>{f.stopPropagation(),window.location.href=`/documents/${t.linkedDocumentId}`},children:e.jsx(X,{size:14})}),t.notes&&e.jsx("span",{className:"note-indicator",title:a("drawer.transaction.notes")})]})]},t.id))})]})})]})]})}export{pe as TransactionsPage};
