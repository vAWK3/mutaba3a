import{r as x,j as e,L as D}from"./vendor-router-D4Yqsbqz.js";import{u as E,a as S,J as C,av as W,aw as Y,o as B,T as O,i as _,m as i,c as b}from"./index-DobPoVyB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";function G(){const t=E(),{language:T}=S(),r=B(T),h=new Date().getFullYear(),N=new Date().getMonth()+1,[o,P]=x.useState(h),[l,M]=x.useState("USD"),{data:j=[]}=C(),A=x.useMemo(()=>j.map(s=>s.id),[j]),{data:u=[],isLoading:R}=W(o,A,l),{data:g=[]}=Y(),p=x.useMemo(()=>g.filter(s=>s.currency===l),[g,l]),k=Array.from({length:3},(s,c)=>h+c-1),d=x.useMemo(()=>{if(u.length===0)return null;const s=[];for(let a=1;a<=12;a++){let m=0,v=0,y=!1;u.forEach(I=>{const f=I.breakdown.find(L=>L.month===a);f&&(m+=f.projectedMinor,v+=f.actualMinor||0,y=f.isPast)}),s.push({month:a,projectedTotal:m,actualTotal:v,isPast:y})}const c=s.filter(a=>!a.isPast).reduce((a,m)=>a+m.projectedTotal,0),n=s.reduce((a,m)=>a+m.projectedTotal,0);return{breakdown:s,minimumNeeded:c,grandTotal:n}},[u]),F=x.useMemo(()=>Array.from({length:12},(s,c)=>new Date(o,c,1).toLocaleDateString(r,{month:"short"})),[o,r]);return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:t("expenses.forecast.title"),breadcrumbs:[{label:t("nav.expenses"),href:"/expenses"},{label:t("expenses.forecast.title")}],filterSlot:e.jsxs("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24},children:[e.jsx("select",{className:"select",value:o,onChange:s=>P(Number(s.target.value)),children:k.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(_,{value:l,onChange:s=>s&&M(s),showAll:!1})]})}),e.jsx("div",{className:"page-content",children:R?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"forecast-hero",children:[e.jsx("div",{className:"forecast-hero-label",children:t("expenses.forecast.minimumNeeded")}),e.jsx("div",{className:"forecast-hero-value amount-negative",children:i(d.minimumNeeded,l,r)}),e.jsx("div",{className:"forecast-hero-subtitle",children:t("expenses.forecast.untilEndOfYear",{year:o})})]}),e.jsxs("div",{className:"forecast-stats",children:[e.jsxs("div",{className:"forecast-stat",children:[e.jsx("span",{className:"forecast-stat-label",children:t("expenses.forecast.yearTotal")}),e.jsx("span",{className:"forecast-stat-value amount-negative",children:i(d.grandTotal,l,r)})]}),e.jsxs("div",{className:"forecast-stat",children:[e.jsx("span",{className:"forecast-stat-label",children:t("expenses.forecast.activeRules")}),e.jsx("span",{className:"forecast-stat-value",children:p.length})]}),e.jsxs("div",{className:"forecast-stat",children:[e.jsx("span",{className:"forecast-stat-label",children:t("expenses.forecast.monthsRemaining")}),e.jsx("span",{className:"forecast-stat-value",children:o===h?12-N:o>h?12:0})]})]}),e.jsxs("div",{className:"forecast-table-section",children:[e.jsx("h3",{className:"section-title",children:t("expenses.forecast.monthlyForecast")}),e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("expenses.forecast.month")}),e.jsx("th",{style:{textAlign:"end"},children:t("expenses.forecast.projected")}),e.jsx("th",{style:{textAlign:"end"},children:t("expenses.forecast.actual")}),e.jsx("th",{style:{textAlign:"end"},children:t("expenses.forecast.delta")})]})}),e.jsx("tbody",{children:d.breakdown.map((s,c)=>{const n=s.isPast?s.actualTotal-s.projectedTotal:0,a=o===h&&s.month===N;return e.jsxs("tr",{className:b(a&&"current-month",!s.isPast&&"future-month"),children:[e.jsxs("td",{children:[e.jsx("span",{style:{fontWeight:a?600:400},children:F[c]}),a&&e.jsx("span",{className:"current-badge",children:t("expenses.forecast.current")})]}),e.jsx("td",{className:"amount-cell",children:s.projectedTotal>0?e.jsx("span",{className:s.isPast?"text-muted":"amount-negative",children:i(s.projectedTotal,l,r)}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"amount-cell",children:s.isPast?s.actualTotal>0?e.jsx("span",{className:"amount-negative",children:i(s.actualTotal,l,r)}):e.jsx("span",{className:"text-muted",children:"-"}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"amount-cell",children:s.isPast&&s.projectedTotal>0?e.jsxs("span",{className:b(n>0&&"text-danger",n<0&&"text-success",n===0&&"text-muted"),children:[n>0?"+":"",i(n,l,r)]}):e.jsx("span",{className:"text-muted",children:"-"})})]},s.month)})}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:600},children:t("expenses.forecast.total")}),e.jsx("td",{className:"amount-cell amount-negative",style:{fontWeight:600},children:i(d.grandTotal,l,r)}),e.jsx("td",{className:"amount-cell amount-negative",style:{fontWeight:600},children:i(d.breakdown.filter(s=>s.isPast).reduce((s,c)=>s+c.actualTotal,0),l,r)}),e.jsx("td",{className:"amount-cell text-muted",children:"-"})]})})]})})]}),p.length>0&&e.jsxs("div",{className:"forecast-rules-section",children:[e.jsxs("h3",{className:"section-title",children:[t("expenses.forecast.activeRecurringRules")," (",p.length,")"]}),e.jsx("div",{className:"forecast-rules-list",children:p.map(s=>{const c=j.find(n=>n.id===s.profileId);return e.jsxs("div",{className:"forecast-rule-item",children:[e.jsxs("div",{className:"forecast-rule-info",children:[e.jsx("div",{className:"forecast-rule-title",children:s.title}),e.jsxs("div",{className:"forecast-rule-meta",children:[e.jsx("span",{className:"text-muted",children:c?.name||t("expenses.unknownProfile")}),e.jsx("span",{className:"text-muted",children:s.frequency==="monthly"?t("expenses.monthly"):t("expenses.yearly")})]})]}),e.jsx("div",{className:"forecast-rule-amount amount-negative",children:i(s.amountMinor,s.currency,r)})]},s.id)})})]}),u.length>1&&e.jsxs("div",{className:"forecast-profiles-section",children:[e.jsx("h3",{className:"section-title",children:t("expenses.forecast.byProfile")}),e.jsx("div",{className:"forecast-profiles-list",children:u.map(s=>{const c=s.breakdown.filter(n=>!n.isPast).reduce((n,a)=>n+a.projectedMinor,0);return e.jsxs(D,{to:"/expenses/profile/$profileId",params:{profileId:s.profileId},className:"forecast-profile-card",children:[e.jsx("div",{className:"forecast-profile-name",children:s.profileName}),e.jsxs("div",{className:"forecast-profile-stats",children:[e.jsxs("div",{className:"forecast-profile-stat",children:[e.jsx("span",{className:"text-muted",children:t("expenses.forecast.minimumNeeded")}),e.jsx("span",{className:"amount-negative",children:i(c,l,r)})]}),e.jsxs("div",{className:"forecast-profile-stat",children:[e.jsx("span",{className:"text-muted",children:t("expenses.forecast.yearTotal")}),e.jsx("span",{className:"amount-negative",children:i(s.projectedTotalMinor,l,r)})]})]})]},s.profileId)})})]})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:t("expenses.forecast.empty")}),e.jsx("p",{className:"empty-state-description",children:t("expenses.forecast.emptyHint")})]})})]})}export{G as ExpensesForecastPage};
