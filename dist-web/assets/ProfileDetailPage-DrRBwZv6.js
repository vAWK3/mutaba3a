import{g as P,a as U,r as g,j as e}from"./vendor-router-D4Yqsbqz.js";import{u as R,o as _,c as r,e as F,n as M,_ as b,d as V}from"./vendor-forms-CPtPuEGg.js";import{u as q,H as O,a5 as $,a4 as z,a6 as W,a7 as Y,O as H,T as N,c as m}from"./index-Su4uSoYk.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";const X=_({name:r().min(1,"Business name is required"),nameEn:r().optional(),email:r().email("Invalid email"),phone:r().optional(),taxId:r().optional(),businessType:b(["exempt","authorized","company","lawyer","none"]),address1:r().optional(),address1En:r().optional(),city:r().optional(),cityEn:r().optional(),country:r().optional(),countryEn:r().optional(),postalCode:r().optional(),primaryColor:r().optional(),defaultCurrency:b(["USD","ILS"]),defaultLanguage:b(["ar","en"]),isDefault:V(),website:r().optional(),defaultTemplateId:b(["template1","template2","template3"]).optional(),defaultTaxRate:M().min(0).max(1).optional(),allowedCurrencies:F(b(["USD","ILS"])).optional(),bankName:r().optional(),bankBranch:r().optional(),bankAccountNumber:r().optional(),bankIban:r().optional(),paymentNotes:r().optional()}),G=[{value:"template1",label:"Classic"},{value:"template2",label:"Modern"},{value:"template3",label:"Minimal"}],J=[{value:"none",label:"Individual / Freelancer"},{value:"exempt",label:"Exempt Dealer"},{value:"authorized",label:"Authorized Dealer"},{value:"company",label:"Company / Corporation"},{value:"lawyer",label:"Lawyer / Law Firm"}],K={invoice:"Invoice",receipt:"Receipt",invoice_receipt:"Invoice Receipt",credit_note:"Credit Note",price_offer:"Price Offer",proforma_invoice:"Proforma Invoice",donation_receipt:"Donation Receipt"},T={invoice:"INV",receipt:"REC",invoice_receipt:"IR",credit_note:"CN",price_offer:"PO",proforma_invoice:"PI",donation_receipt:"DR"},Q=["invoice","receipt","invoice_receipt","credit_note","price_offer","proforma_invoice","donation_receipt"];function re(){const{profileId:p}=P({from:"/settings/profiles/$profileId"}),E=U(),i=q(),C=g.useRef(null),[c,f]=g.useState("info"),[u,y]=g.useState(null),{data:t,isLoading:I}=O(p),w=$(),S=z(),{data:k=[]}=W(p),D=Y(),a=R({resolver:H(X),defaultValues:{name:"",nameEn:"",email:"",phone:"",taxId:"",businessType:"none",address1:"",address1En:"",city:"",cityEn:"",country:"",countryEn:"",postalCode:"",primaryColor:"#3b82f6",defaultCurrency:"USD",defaultLanguage:"en",isDefault:!1,website:"",defaultTemplateId:"template1",defaultTaxRate:.17,allowedCurrencies:["USD","ILS"],bankName:"",bankBranch:"",bankAccountNumber:"",bankIban:"",paymentNotes:""}});g.useEffect(()=>{t&&(a.reset({name:t.name,nameEn:t.nameEn||"",email:t.email,phone:t.phone||"",taxId:t.taxId||"",businessType:t.businessType,address1:t.address1||"",address1En:t.address1En||"",city:t.city||"",cityEn:t.cityEn||"",country:t.country||"",countryEn:t.countryEn||"",postalCode:t.postalCode||"",primaryColor:t.primaryColor||"#3b82f6",defaultCurrency:t.defaultCurrency,defaultLanguage:t.defaultLanguage,isDefault:t.isDefault,website:t.website||"",defaultTemplateId:t.defaultTemplateId||"template1",defaultTaxRate:t.defaultTaxRate??.17,allowedCurrencies:t.allowedCurrencies||["USD","ILS"],bankName:t.bankName||"",bankBranch:t.bankBranch||"",bankAccountNumber:t.bankAccountNumber||"",bankIban:t.bankIban||"",paymentNotes:t.paymentNotes||""}),t.logoDataUrl&&y(t.logoDataUrl))},[t,a]);const x=k.reduce((s,l)=>(s[l.documentType]=l,s),{}),A=s=>{const l=s.target.files?.[0];if(!l)return;const n=new FileReader;n.onloadend=()=>{const o=n.result;y(o)},n.readAsDataURL(l)},j=(s,l,n)=>{const o={};l==="prefix"?o.prefix=n:l==="prefixEnabled"?o.prefixEnabled=n:l==="lastNumber"&&(o.lastNumber=Math.max(0,n-1)),D.mutate({businessProfileId:p,documentType:s,updates:o})},v=async s=>{const l={name:s.name,nameEn:s.nameEn||void 0,email:s.email,phone:s.phone||void 0,taxId:s.taxId||void 0,businessType:s.businessType,address1:s.address1||void 0,address1En:s.address1En||void 0,city:s.city||void 0,cityEn:s.cityEn||void 0,country:s.country||void 0,countryEn:s.countryEn||void 0,postalCode:s.postalCode||void 0,logoDataUrl:u||void 0,primaryColor:s.primaryColor||void 0,defaultCurrency:s.defaultCurrency,defaultLanguage:s.defaultLanguage,isDefault:s.isDefault,website:s.website||void 0,defaultTemplateId:s.defaultTemplateId||void 0,defaultTaxRate:s.defaultTaxRate,allowedCurrencies:s.allowedCurrencies||void 0,bankName:s.bankName||void 0,bankBranch:s.bankBranch||void 0,bankAccountNumber:s.bankAccountNumber||void 0,bankIban:s.bankIban||void 0,paymentNotes:s.paymentNotes||void 0};try{await w.mutateAsync({id:p,data:l})}catch(n){console.error("Failed to save business profile:",n)}},B=async()=>{if(confirm("Are you sure you want to archive this business profile?"))try{await S.mutateAsync(p),E({to:"/settings"})}catch(s){console.error("Failed to archive profile:",s)}},d=w.isPending;return I?e.jsxs(e.Fragment,{children:[e.jsx(N,{title:i("common.loading"),breadcrumbs:[{label:i("nav.settings"),href:"/settings"},{label:"Profiles"}],hideAddMenu:!0}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):t?e.jsxs(e.Fragment,{children:[e.jsx(N,{title:t.name,breadcrumbs:[{label:i("nav.settings"),href:"/settings"},{label:"Profiles"},{label:t.name}],hideAddMenu:!0}),e.jsxs("div",{className:"page-content",style:{maxWidth:700},children:[e.jsx("div",{className:"tabs",style:{marginBottom:24},children:e.jsxs("div",{className:"tabs-list",children:[e.jsx("button",{className:m("tab",c==="info"&&"active"),onClick:()=>f("info"),children:"Profile Info"}),e.jsx("button",{className:m("tab",c==="numbering"&&"active"),onClick:()=>f("numbering"),children:"Document Numbering"}),e.jsx("button",{className:m("tab",c==="currency"&&"active"),onClick:()=>f("currency"),children:"Document Defaults"}),e.jsx("button",{className:m("tab",c==="payment"&&"active"),onClick:()=>f("payment"),children:"Payment Details"})]})}),c==="info"&&e.jsxs("form",{onSubmit:a.handleSubmit(v),children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Logo"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[u?e.jsx("img",{src:u,alt:"Logo preview",style:{width:64,height:64,objectFit:"contain",borderRadius:4}}):e.jsx("div",{style:{width:64,height:64,backgroundColor:"var(--color-bg-secondary)",borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",color:"var(--color-text-tertiary)",fontSize:12},children:"No logo"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>C.current?.click(),children:u?"Change":"Upload"}),u&&e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:()=>y(null),children:"Remove"})]}),e.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:A,style:{display:"none"}})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Business Name (Arabic) *"}),e.jsx("input",{type:"text",className:m("input",a.formState.errors.name&&"input-error"),placeholder:"اسم الشركة",dir:"rtl",...a.register("name")}),a.formState.errors.name&&e.jsx("p",{className:"form-error",children:a.formState.errors.name.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Business Name (English)"}),e.jsx("input",{type:"text",className:"input",placeholder:"Company Name",...a.register("nameEn")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Email *"}),e.jsx("input",{type:"email",className:m("input",a.formState.errors.email&&"input-error"),placeholder:"email@example.com",...a.register("email")}),a.formState.errors.email&&e.jsx("p",{className:"form-error",children:a.formState.errors.email.message})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{type:"tel",className:"input",placeholder:"+972 50 000 0000",...a.register("phone")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Business Type"}),e.jsx("select",{className:"select",...a.register("businessType"),children:J.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Tax ID"}),e.jsx("input",{type:"text",className:"input",placeholder:"Tax/VAT Number",...a.register("taxId")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Address (Arabic)"}),e.jsx("input",{type:"text",className:"input",placeholder:"العنوان",dir:"rtl",...a.register("address1")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Address (English)"}),e.jsx("input",{type:"text",className:"input",placeholder:"123 Main St",...a.register("address1En")})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"City (Arabic)"}),e.jsx("input",{type:"text",className:"input",placeholder:"المدينة",dir:"rtl",...a.register("city")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"City (English)"}),e.jsx("input",{type:"text",className:"input",placeholder:"City",...a.register("cityEn")})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Brand Color"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"color",style:{width:40,height:32,padding:0,border:"none",cursor:"pointer"},...a.register("primaryColor")}),e.jsx("input",{type:"text",className:"input",style:{width:120},placeholder:"#3b82f6",...a.register("primaryColor")})]})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",...a.register("isDefault")}),e.jsx("span",{children:"Set as default profile"})]})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:24,paddingTop:16,borderTop:"1px solid var(--color-border)"},children:[e.jsx("div",{children:!t.isDefault&&e.jsx("button",{type:"button",className:"btn btn-danger",onClick:B,disabled:S.isPending,children:i("common.archive")})}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:i(d?"common.saving":"common.save")})]})]}),c==="numbering"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted text-sm",style:{marginBottom:16},children:"Configure how document numbers are generated for each type. These settings apply to this business profile only."}),e.jsxs("table",{className:"settings-table",style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"start",padding:"8px 12px",borderBottom:"1px solid var(--color-border)"},children:"Type"}),e.jsx("th",{style:{textAlign:"start",padding:"8px 12px",borderBottom:"1px solid var(--color-border)"},children:"Prefix"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 12px",borderBottom:"1px solid var(--color-border)"},children:"Use Prefix"}),e.jsx("th",{style:{textAlign:"end",padding:"8px 12px",borderBottom:"1px solid var(--color-border)"},children:"Next #"})]})}),e.jsx("tbody",{children:Q.map(s=>{const l=x[s],n=l?.prefix||T[s],o=l?.prefixEnabled??!0,L=(l?.lastNumber||0)+1;return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--color-border)"},children:K[s]}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--color-border)"},children:e.jsx("input",{type:"text",className:"input input-sm",style:{width:80},value:n,onChange:h=>j(s,"prefix",h.target.value),placeholder:T[s],disabled:!o})}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--color-border)",textAlign:"center"},children:e.jsx("input",{type:"checkbox",checked:o,onChange:h=>j(s,"prefixEnabled",h.target.checked)})}),e.jsx("td",{style:{padding:"8px 12px",borderBottom:"1px solid var(--color-border)",textAlign:"end"},children:e.jsx("input",{type:"number",className:"input input-sm",style:{width:80,textAlign:"end"},min:1,value:L,onChange:h=>j(s,"lastNumber",parseInt(h.target.value)||1)})})]},s)})})]}),e.jsxs("p",{className:"text-muted text-sm",style:{marginTop:12},children:["Example: ",x.invoice?.prefixEnabled!==!1?`${x.invoice?.prefix||"INV"}-${String((x.invoice?.lastNumber||0)+1).padStart(4,"0")}`:String((x.invoice?.lastNumber||0)+1).padStart(4,"0")]})]}),c==="currency"&&e.jsxs("form",{onSubmit:a.handleSubmit(v),children:[e.jsx("p",{className:"text-muted text-sm",style:{marginBottom:24},children:"Configure default settings for documents created with this profile."}),e.jsxs("div",{className:"settings-row",style:{marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"settings-label",children:"Default Currency"}),e.jsx("div",{className:"settings-description",children:"Currency used by default for new documents"})]}),e.jsxs("select",{className:"select",...a.register("defaultCurrency"),children:[e.jsx("option",{value:"USD",children:"USD ($)"}),e.jsx("option",{value:"ILS",children:"ILS (₪)"})]})]}),e.jsxs("div",{className:"settings-row",style:{marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"settings-label",children:"Default Language"}),e.jsx("div",{className:"settings-description",children:"Language used by default for document content"})]}),e.jsxs("select",{className:"select",...a.register("defaultLanguage"),children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ar",children:"Arabic"})]})]}),e.jsxs("div",{className:"settings-row",style:{marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"settings-label",children:"Default Template"}),e.jsx("div",{className:"settings-description",children:"PDF template style for documents"})]}),e.jsx("select",{className:"select",...a.register("defaultTemplateId"),children:G.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"settings-row",style:{marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"settings-label",children:"Default Tax Rate"}),e.jsx("div",{className:"settings-description",children:"VAT rate for new documents (e.g., 17%)"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("input",{type:"number",className:"input input-sm",style:{width:80,textAlign:"right"},step:"0.01",min:"0",max:"100",value:(a.watch("defaultTaxRate")??.17)*100,onChange:s=>a.setValue("defaultTaxRate",parseFloat(s.target.value)/100||0)}),e.jsx("span",{className:"text-muted",children:"%"})]})]}),e.jsxs("div",{className:"settings-row",style:{marginBottom:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"settings-label",children:"Website"}),e.jsx("div",{className:"settings-description",children:"Website URL shown on documents"})]}),e.jsx("input",{type:"url",className:"input",style:{width:200},placeholder:"https://example.com",...a.register("website")})]}),e.jsxs("div",{className:"settings-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"settings-label",children:"Allowed Currencies"}),e.jsx("div",{className:"settings-description",children:"Currencies available when creating documents"})]}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.watch("allowedCurrencies")?.includes("USD")??!0,onChange:s=>{const l=a.getValues("allowedCurrencies")||["USD","ILS"];s.target.checked?a.setValue("allowedCurrencies",[...new Set([...l,"USD"])]):a.setValue("allowedCurrencies",l.filter(n=>n!=="USD"))}}),e.jsx("span",{children:"USD ($)"})]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:a.watch("allowedCurrencies")?.includes("ILS")??!0,onChange:s=>{const l=a.getValues("allowedCurrencies")||["USD","ILS"];s.target.checked?a.setValue("allowedCurrencies",[...new Set([...l,"ILS"])]):a.setValue("allowedCurrencies",l.filter(n=>n!=="ILS"))}}),e.jsx("span",{children:"ILS (₪)"})]})]})]}),e.jsx("div",{style:{marginTop:24,paddingTop:16,borderTop:"1px solid var(--color-border)",textAlign:"end"},children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:i(d?"common.saving":"common.save")})})]}),c==="payment"&&e.jsxs("form",{onSubmit:a.handleSubmit(v),children:[e.jsx("p",{className:"text-muted text-sm",style:{marginBottom:24},children:"Bank and payment details to display on invoices and other documents."}),e.jsxs("div",{className:"form-row",style:{marginBottom:16},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Bank Name"}),e.jsx("input",{type:"text",className:"input",placeholder:"Bank of Example",...a.register("bankName")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Branch"}),e.jsx("input",{type:"text",className:"input",placeholder:"Main Branch",...a.register("bankBranch")})]})]}),e.jsxs("div",{className:"form-row",style:{marginBottom:16},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Account Number"}),e.jsx("input",{type:"text",className:"input",placeholder:"12345678",...a.register("bankAccountNumber")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"IBAN"}),e.jsx("input",{type:"text",className:"input",placeholder:"IL12 3456 7890 1234 5678 901",...a.register("bankIban")})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:16},children:[e.jsx("label",{className:"form-label",children:"Payment Notes"}),e.jsx("textarea",{className:"textarea",rows:3,placeholder:"Additional payment instructions (e.g., payment terms, wire transfer details)...",...a.register("paymentNotes")}),e.jsx("p",{className:"text-muted text-sm",style:{marginTop:4},children:"These notes will appear in the footer of invoices."})]}),e.jsx("div",{style:{marginTop:24,paddingTop:16,borderTop:"1px solid var(--color-border)",textAlign:"end"},children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:i(d?"common.saving":"common.save")})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{title:"Profile Not Found",breadcrumbs:[{label:i("nav.settings"),href:"/settings"},{label:"Profiles"}],hideAddMenu:!0}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:"Profile not found"}),e.jsx("p",{className:"empty-state-description",children:"This profile may have been archived or deleted."})]})})]})}export{re as ProfileDetailPage};
