import{g as G,r as o,j as e,L as J}from"./vendor-router-D4Yqsbqz.js";import{a as K,b as Q,u as V,d as X,e as Y,s as Z,t as _,v as ee,f as S,T as y,k as p,c as h,C as P,g as w,i as M,l as R,D as se,S as te,m as ae}from"./index-Clb4NbgW.js";import{S as ne}from"./StatusSegment-SjdJzshv.js";/* empty css              */import{R as A}from"./RowActionsMenu-L_ZpjB9G.js";import{C as L}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";/* empty css                       */function pe(){const{clientId:a}=G({from:"/clients/$clientId"}),{openTransactionDrawer:u,openClientDrawer:z,openProjectDrawer:N}=K(),g=Q(),s=V(),{language:B}=X(),m=ae(B),[i,j]=o.useState("summary"),[r,H]=o.useState(()=>Y("all")),[c,C]=o.useState(void 0),[b,U]=o.useState(void 0),[v,O]=o.useState(""),{data:d,isLoading:E}=Z(a),{data:x}=_(a,{dateFrom:r.dateFrom,dateTo:r.dateTo,currency:c}),{data:k=[]}=ee(a),$=o.useMemo(()=>({clientId:a,dateFrom:r.dateFrom,dateTo:r.dateTo,currency:c,status:b,search:v||void 0,sort:{by:"occurredAt",dir:"desc"}}),[a,r,c,b,v]),q=o.useMemo(()=>({clientId:a,kind:"income",status:"unpaid",currency:c,sort:{by:"dueDate",dir:"asc"}}),[a,c]),{data:f=[]}=S($),{data:T=[]}=S(q),D=c||"USD",F=t=>{u({mode:"edit",transactionId:t})},I=()=>{u({mode:"create",defaultClientId:a})};return E?e.jsxs(e.Fragment,{children:[e.jsx(y,{title:s("common.loading"),breadcrumbs:[{label:s("nav.clients"),href:"/clients"}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):d?e.jsxs(e.Fragment,{children:[e.jsx(y,{title:d.name,breadcrumbs:[{label:s("nav.clients"),href:"/clients"},{label:d.name}],rightSlot:e.jsx("button",{className:"btn btn-ghost",onClick:()=>z({mode:"edit",clientId:a}),children:s("common.edit")})}),e.jsxs("div",{className:"page-content",children:[x&&e.jsxs("div",{className:"inline-stats",style:{marginBottom:24},children:[e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("clients.columns.activeProjects")}),e.jsx("span",{className:"inline-stat-value",children:x.activeProjectCount})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("clients.columns.paidIncome")}),e.jsx("span",{className:"inline-stat-value text-success",children:p(x.paidIncomeMinor,D,m)})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("clients.columns.unpaid")}),e.jsx("span",{className:"inline-stat-value text-warning",children:p(x.unpaidIncomeMinor,D,m)})]})]}),e.jsx("div",{className:"tabs",children:e.jsxs("div",{className:"tabs-list",children:[e.jsx("button",{className:h("tab",i==="summary"&&"active"),onClick:()=>j("summary"),children:s("clients.tabs.summary")}),e.jsx("button",{className:h("tab",i==="projects"&&"active"),onClick:()=>j("projects"),children:s("clients.tabs.projects")}),e.jsx("button",{className:h("tab",i==="receivables"&&"active"),onClick:()=>j("receivables"),children:s("clients.tabs.receivables")}),e.jsx("button",{className:h("tab",i==="transactions"&&"active"),onClick:()=>j("transactions"),children:s("clients.tabs.transactions")})]})}),i==="summary"&&e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsx("h4",{style:{marginBottom:12},children:s("clients.detail.clientDetails")}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("clients.detail.email")}),e.jsx("div",{children:d.email||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("clients.detail.phone")}),e.jsx("div",{children:d.phone||"-"})]})]}),d.notes&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{className:"text-muted text-sm",children:s("drawer.client.notes")}),e.jsx("div",{children:d.notes})]})]}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("button",{className:"btn btn-primary",onClick:I,children:s("transactions.addTransaction")}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>N({mode:"create",defaultClientId:a}),children:s("projects.addProject")})]})]}),i==="projects"&&e.jsx(e.Fragment,{children:k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.detail.noProjects")}),e.jsx("p",{className:"empty-state-description",children:s("clients.detail.noProjectsHint")}),e.jsx("button",{className:"btn btn-primary",onClick:()=>N({mode:"create",defaultClientId:a}),children:s("projects.addProject")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("projects.columns.project")}),e.jsx("th",{children:s("projects.columns.field")})]})}),e.jsx("tbody",{children:k.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(J,{to:"/projects/$projectId",params:{projectId:t.id},style:{fontWeight:500},children:t.name})}),e.jsx("td",{className:"text-secondary",children:t.field||"-"})]},t.id))})]})})}),i==="receivables"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"filters-row",children:e.jsx(P,{value:c,onChange:C})}),T.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.detail.noReceivables")}),e.jsx("p",{className:"empty-state-description",children:s("clients.detail.noReceivablesHint")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("clients.receivables.dueDate")}),e.jsx("th",{children:s("transactions.columns.project")}),e.jsx("th",{style:{textAlign:"end"},children:s("transactions.columns.amount")}),e.jsx("th",{children:s("clients.receivables.daysOverdue")}),e.jsx("th",{children:s("transactions.columns.status")}),e.jsx("th",{style:{width:80},children:s("clients.receivables.action")})]})}),e.jsx("tbody",{children:T.map(t=>{const l=t.dueDate?w(t.dueDate):0,n=l<0;return e.jsxs("tr",{className:"clickable",onClick:()=>F(t.id),children:[e.jsx("td",{children:t.dueDate?M(t.dueDate,m):"-"}),e.jsx("td",{className:"text-secondary",children:t.projectName||"-"}),e.jsx("td",{className:"amount-cell",style:{color:"var(--color-warning)"},children:p(t.amountMinor,t.currency,m)}),e.jsx("td",{className:n?"text-danger":"text-muted",children:n?Math.abs(l):"-"}),e.jsx("td",{children:n?e.jsx("span",{className:"status-badge overdue",children:s("filters.status.overdue")}):e.jsx("span",{className:"status-badge unpaid",children:s("filters.status.unpaid")})}),e.jsx("td",{children:e.jsx(A,{actions:[{label:s("common.markPaid"),icon:e.jsx(R,{size:16}),onClick:()=>g.mutate(t.id)},{label:s("common.duplicate"),icon:e.jsx(L,{size:16}),onClick:()=>u({mode:"create",duplicateFromId:t.id})}]})})]},t.id)})})]})})]}),i==="transactions"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"filters-row",children:[e.jsx(se,{dateFrom:r.dateFrom,dateTo:r.dateTo,onChange:(t,l)=>H({dateFrom:t,dateTo:l})}),e.jsx(P,{value:c,onChange:C}),e.jsx(ne,{value:b,onChange:U}),e.jsx(te,{value:v,onChange:O})]}),f.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.detail.noTransactions")}),e.jsx("p",{className:"empty-state-description",children:s("clients.detail.noTransactionsHint")}),e.jsx("button",{className:"btn btn-primary",onClick:I,children:s("transactions.addTransaction")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("transactions.columns.date")}),e.jsx("th",{children:s("transactions.columns.type")}),e.jsx("th",{children:s("transactions.columns.project")}),e.jsx("th",{children:s("transactions.columns.category")}),e.jsx("th",{style:{textAlign:"end"},children:s("transactions.columns.amount")}),e.jsx("th",{children:s("transactions.columns.status")}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:f.map(t=>{const l=t.kind==="income"&&t.status==="unpaid",n=t.dueDate?w(t.dueDate):null,W=n!==null&&n<0;return e.jsxs("tr",{className:"clickable",onClick:()=>F(t.id),children:[e.jsx("td",{children:M(t.occurredAt,m)}),e.jsx("td",{children:e.jsx("span",{className:h("type-badge",t.kind==="expense"&&"expense",t.kind==="income"&&t.status==="paid"&&"income",l&&"receivable"),children:l?s("transactions.type.receivable"):t.kind==="income"?s("transactions.type.income"):s("transactions.type.expense")})}),e.jsx("td",{className:"text-secondary",children:t.projectName||"-"}),e.jsx("td",{className:"text-secondary",children:t.categoryName||"-"}),e.jsxs("td",{className:h("amount-cell",t.kind==="income"&&"amount-positive",t.kind==="expense"&&"amount-negative"),children:[t.kind==="expense"?"-":"",p(t.amountMinor,t.currency,m)]}),e.jsx("td",{children:t.kind==="income"&&e.jsx(e.Fragment,{children:t.status==="paid"?e.jsx("span",{className:"status-badge paid",children:s("transactions.status.paid")}):W?e.jsx("span",{className:"status-badge overdue",children:s("transactions.status.overdue",{days:Math.abs(n)})}):e.jsx("span",{className:"status-badge unpaid",children:n===0?s("transactions.status.dueToday"):s("transactions.status.dueIn",{days:n??0})})})}),e.jsx("td",{children:e.jsx(A,{actions:[...l?[{label:s("common.markPaid"),icon:e.jsx(R,{size:16}),onClick:()=>g.mutate(t.id)}]:[],{label:s("common.duplicate"),icon:e.jsx(L,{size:16}),onClick:()=>u({mode:"create",duplicateFromId:t.id})}]})})]},t.id)})})]})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{title:s("clients.notFound"),breadcrumbs:[{label:s("nav.clients"),href:"/clients"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("clients.notFound")}),e.jsx("p",{className:"empty-state-description",children:s("clients.notFoundHint")})]})})]})}export{pe as ClientDetailPage};
