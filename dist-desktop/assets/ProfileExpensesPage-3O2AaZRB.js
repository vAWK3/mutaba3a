import{j as e,g as Z,r as c,L as $}from"./vendor-router-D4Yqsbqz.js";import{a as q,u as S,d as w,F as z,ac as _,ad as G,ae as J,af as K,ag as Q,ah as V,ai as X,aj as ee,T as b,k as g,S as se,C as ne,i as te,c as f,ak as ae,m as re}from"./index-Clb4NbgW.js";/* empty css              */import{R as ie}from"./RowActionsMenu-L_ZpjB9G.js";import{C as le}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";/* empty css                       */function ce({size:t=16,className:i}){return e.jsx("svg",{width:t,height:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,className:i,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})}function Ce(){const{profileId:t}=Z({from:"/expenses/profile/$profileId"}),{openExpenseDrawer:i}=q(),n=S(),{language:a}=w(),o=re(a),d=new Date().getFullYear(),[l,m]=c.useState(d),[u,j]=c.useState(void 0),[r,L]=c.useState(""),[x,I]=c.useState(""),[v,P]=c.useState(!0),[M,y]=c.useState(!1),{data:N,isLoading:E}=z(t),{data:p}=_(t,l),{data:C=[]}=G(t),{data:h=[]}=J(t),D=K(),F=Q(),A=V(),B=X(),T=c.useMemo(()=>({profileId:t,year:l,currency:u,categoryId:r||void 0,search:x||void 0,sort:{by:"occurredAt",dir:"desc"}}),[t,l,u,r,x]),{data:k=[],isLoading:W}=ee(T),H=Array.from({length:6},(s,O)=>d-O),U=s=>{i({mode:"edit",expenseId:s,defaultProfileId:t})},R=()=>{i({mode:"create",defaultProfileId:t})},Y=()=>{i({mode:"create",defaultProfileId:t,isRecurring:!0})};return E?e.jsxs(e.Fragment,{children:[e.jsx(b,{title:n("common.loading"),breadcrumbs:[{label:n("nav.expenses"),href:"/expenses"}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):N?e.jsxs(e.Fragment,{children:[e.jsx(b,{title:N.name,breadcrumbs:[{label:n("nav.expenses"),href:"/expenses"},{label:N.name}],filterSlot:e.jsx("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24},children:e.jsx("select",{className:"select",value:l,onChange:s=>m(Number(s.target.value)),children:H.map(s=>e.jsx("option",{value:s,children:s},s))})}),rightSlot:e.jsx($,{to:"/expenses/profile/$profileId/receipts",params:{profileId:t},className:"btn btn-ghost",children:n("expenses.manageReceipts")})}),e.jsxs("div",{className:"page-content",children:[p&&e.jsxs("div",{className:"inline-stats",style:{marginBottom:24},children:[e.jsxs("div",{className:"inline-stat",children:[e.jsxs("span",{className:"inline-stat-label",children:["USD (",l,")"]}),e.jsx("span",{className:"inline-stat-value amount-negative",children:p.totalMinorUSD>0?g(p.totalMinorUSD,"USD",o):"-"})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsxs("span",{className:"inline-stat-label",children:["ILS (",l,")"]}),e.jsx("span",{className:"inline-stat-value amount-negative",children:p.totalMinorILS>0?g(p.totalMinorILS,"ILS",o):"-"})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:n("expenses.recurringRules")}),e.jsx("span",{className:"inline-stat-value",children:h.filter(s=>!s.isPaused).length})]})]}),e.jsxs("div",{className:"filters-row",children:[e.jsx(se,{value:x,onChange:I,placeholder:n("expenses.searchPlaceholder")}),e.jsx(ne,{value:u,onChange:j}),C.length>0?e.jsxs("select",{className:"select",value:r,onChange:s=>L(s.target.value),children:[e.jsx("option",{value:"",children:n("expenses.allCategories")}),C.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}):e.jsxs("button",{className:"btn btn-ghost btn-sm",onClick:()=>y(!0),children:["+ ",n("expenses.categories.setup")]})]}),W?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:n("expenses.emptyExpenses")}),e.jsx("p",{className:"empty-state-description",children:n(x?"expenses.emptyExpensesSearch":"expenses.emptyExpensesHint")}),e.jsx("button",{className:"btn btn-primary",onClick:R,children:n("expenses.addExpense")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:n("expenses.columns.date")}),e.jsx("th",{children:n("expenses.columns.title")}),e.jsx("th",{children:n("expenses.columns.vendor")}),e.jsx("th",{children:n("expenses.columns.category")}),e.jsx("th",{style:{textAlign:"end"},children:n("expenses.columns.amount")}),e.jsx("th",{style:{textAlign:"center"},children:n("expenses.columns.receipts")}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:k.map(s=>e.jsxs("tr",{className:"clickable",onClick:()=>U(s.id),children:[e.jsx("td",{children:te(s.occurredAt,o)}),e.jsxs("td",{children:[e.jsx("span",{style:{fontWeight:500},children:s.title||"-"}),s.isFromRecurring&&e.jsx("span",{className:"recurring-badge",title:n("expenses.fromRecurring"),children:e.jsx(oe,{})})]}),e.jsx("td",{className:"text-secondary",children:s.vendor||"-"}),e.jsx("td",{className:"text-secondary",children:s.categoryName?e.jsx("span",{className:"category-badge",style:{"--category-color":s.categoryColor||"#888"},children:s.categoryName}):"-"}),e.jsx("td",{className:"amount-cell amount-negative",children:g(s.amountMinor,s.currency,o)}),e.jsx("td",{style:{textAlign:"center"},children:s.receiptCount>0?e.jsx("span",{className:"receipt-count",children:s.receiptCount}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:e.jsx(ie,{actions:[{label:n("common.duplicate"),icon:e.jsx(le,{size:16}),onClick:()=>i({mode:"create",defaultProfileId:t,expenseId:s.id})},{label:n("common.delete"),icon:e.jsx(ce,{size:16}),variant:"danger",onClick:()=>{confirm(n("expenses.confirmDelete"))&&D.mutate(s.id)}}]})})]},s.id))})]})}),e.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:R,children:n("expenses.addExpense")}),e.jsx("button",{className:"btn btn-secondary",onClick:Y,children:n("expenses.addRecurring")})]}),h.length>0&&e.jsxs("div",{className:"recurring-rules-section",children:[e.jsxs("button",{className:"recurring-rules-header",onClick:()=>P(!v),children:[e.jsxs("span",{className:"recurring-rules-title",children:[n("expenses.recurringRules")," (",h.length,")"]}),e.jsx(de,{className:f("recurring-rules-chevron",v&&"expanded")})]}),v&&e.jsx("div",{className:"recurring-rules-list",children:h.map(s=>e.jsxs("div",{className:f("recurring-rule-item",s.isPaused&&"paused"),children:[e.jsxs("div",{className:"recurring-rule-info",children:[e.jsxs("div",{className:"recurring-rule-title",children:[s.title,s.isPaused&&e.jsx("span",{className:"paused-badge",children:n("expenses.paused")})]}),e.jsxs("div",{className:"recurring-rule-meta",children:[e.jsx("span",{className:"amount-negative",children:g(s.amountMinor,s.currency,o)}),e.jsxs("span",{className:"text-muted",children:["/ ",s.frequency==="monthly"?n("expenses.monthly"):n("expenses.yearly")]})]})]}),e.jsxs("div",{className:"recurring-rule-actions",children:[e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>s.isPaused?A.mutate(s.id):F.mutate(s.id),children:s.isPaused?n("expenses.resume"):n("expenses.pause")}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>i({mode:"edit",recurringRuleId:s.id,defaultProfileId:t,isRecurring:!0}),children:n("common.edit")}),e.jsx("button",{className:"btn btn-ghost btn-sm text-danger",onClick:()=>{confirm(n("expenses.confirmDeleteRule"))&&B.mutate(s.id)},children:n("common.delete")})]})]},s.id))})]})]}),e.jsx(me,{isOpen:M,onClose:()=>y(!1),profileId:t})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{title:n("expenses.profileNotFound"),breadcrumbs:[{label:n("nav.expenses"),href:"/expenses"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:n("expenses.profileNotFound")}),e.jsx("p",{className:"empty-state-description",children:n("expenses.profileNotFoundHint")})]})})]})}function oe(){return e.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3"})})}function de({className:t}){return e.jsx("svg",{className:t,width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})})}function me({isOpen:t,onClose:i,profileId:n}){const a=S(),{language:o}=w(),[d,l]=c.useState("general"),m=ae(),u=[{value:"general",label:a("expenses.categories.presets.general"),description:a("expenses.categories.presetDescriptions.general")},{value:"startup",label:a("expenses.categories.presets.startup"),description:a("expenses.categories.presetDescriptions.startup")},{value:"lawFirm",label:a("expenses.categories.presets.lawFirm"),description:a("expenses.categories.presetDescriptions.lawFirm")},{value:"freelancer",label:a("expenses.categories.presets.freelancer"),description:a("expenses.categories.presetDescriptions.freelancer")}],j=async()=>{try{await m.mutateAsync({profileId:n,preset:d,language:o==="ar"?"ar":"en"}),i()}catch(r){console.error("Failed to seed categories:",r)}};return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:i}),e.jsxs("div",{className:"modal category-setup-modal",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:a("expenses.categories.setupTitle")}),e.jsx("button",{className:"modal-close",onClick:i,"aria-label":a("common.close"),children:e.jsx(ue,{})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{className:"modal-description",children:a("expenses.categories.selectPreset")}),m.isError&&e.jsxs("div",{className:"modal-warning",style:{marginBottom:16},children:[e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})}),e.jsx("p",{children:a("common.error")||"An error occurred. Please try again."})]}),e.jsx("div",{className:"preset-options",children:u.map(r=>e.jsxs("label",{className:f("preset-option",d===r.value&&"selected"),children:[e.jsx("input",{type:"radio",name:"preset",value:r.value,checked:d===r.value,onChange:()=>l(r.value)}),e.jsxs("div",{className:"preset-content",children:[e.jsx("span",{className:"preset-label",children:r.label}),e.jsx("span",{className:"preset-description",children:r.description})]})]},r.value))})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-ghost",onClick:i,children:a("common.cancel")}),e.jsx("button",{className:"btn btn-primary",onClick:j,disabled:m.isPending,children:m.isPending?a("common.saving"):a("expenses.categories.seedCategories")})]})]})]}):null}function ue(){return e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}export{Ce as ProfileExpensesPage};
