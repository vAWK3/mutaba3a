import{g as P,r as d,j as e}from"./vendor-router-D4Yqsbqz.js";import{a as w,b as R,u as A,d as B,e as q,p as z,q as E,f as H,T as g,k as i,c as j,D as O,C as $,S as G,g as J,i as K,l as Q,m as V}from"./index-C9T1eVUk.js";import{S as W}from"./StatusSegment-DfLSV7Ua.js";/* empty css              */import{R as X}from"./RowActionsMenu-L_ZpjB9G.js";import{C as Y}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";/* empty css                       */function de(){const{projectId:o}=P({from:"/projects/$projectId"}),{openTransactionDrawer:p,openProjectDrawer:S}=w(),D=R(),s=A(),{language:I}=B(),n=V(I),[u,b]=d.useState("summary"),[c,M]=d.useState(()=>q("all")),[h,T]=d.useState(void 0),[x,k]=d.useState(void 0),[v,F]=d.useState(""),{data:r,isLoading:C}=z(o),{data:t}=E(o,{dateFrom:c.dateFrom,dateTo:c.dateTo}),f=d.useMemo(()=>({projectId:o,dateFrom:c.dateFrom,dateTo:c.dateTo,currency:h,status:x,search:v||void 0,sort:{by:"occurredAt",dir:"desc"}}),[o,c,h,x,v]),{data:N=[]}=H(f),U=a=>{p({mode:"edit",transactionId:a})},y=()=>{p({mode:"create",defaultProjectId:o,defaultClientId:r?.clientId})};return C?e.jsxs(e.Fragment,{children:[e.jsx(g,{title:s("common.loading"),breadcrumbs:[{label:s("nav.projects"),href:"/projects"}]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})})})]}):r?e.jsxs(e.Fragment,{children:[e.jsx(g,{title:r.name,breadcrumbs:[{label:s("nav.projects"),href:"/projects"},{label:r.name}],rightSlot:e.jsx("button",{className:"btn btn-ghost",onClick:()=>S({mode:"edit",projectId:o}),children:s("common.edit")})}),e.jsxs("div",{className:"page-content",children:[t&&e.jsxs("div",{className:"inline-stats",style:{marginBottom:24},children:[e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.paid")}),e.jsx("div",{className:"inline-stat-value text-success",children:t.paidIncomeMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i(t.paidIncomeMinorUSD,"USD",n)}),e.jsx("div",{children:i(t.paidIncomeMinorILS??0,"ILS",n)})]}):i(t.paidIncomeMinor,"USD",n)})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.unpaid")}),e.jsx("div",{className:"inline-stat-value text-warning",children:t.unpaidIncomeMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i(t.unpaidIncomeMinorUSD,"USD",n)}),e.jsx("div",{children:i(t.unpaidIncomeMinorILS??0,"ILS",n)})]}):i(t.unpaidIncomeMinor,"USD",n)})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.expenses")}),e.jsx("div",{className:"inline-stat-value",children:t.expensesMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i(t.expensesMinorUSD,"USD",n)}),e.jsx("div",{children:i(t.expensesMinorILS??0,"ILS",n)})]}):i(t.expensesMinor,"USD",n)})]}),e.jsxs("div",{className:"inline-stat",children:[e.jsx("span",{className:"inline-stat-label",children:s("projects.columns.net")}),e.jsx("div",{className:j("inline-stat-value",t.netMinor>=0?"text-success":"text-danger"),children:t.paidIncomeMinorUSD!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:i((t.paidIncomeMinorUSD??0)-(t.expensesMinorUSD??0),"USD",n)}),e.jsx("div",{children:i((t.paidIncomeMinorILS??0)-(t.expensesMinorILS??0),"ILS",n)})]}):i(t.netMinor,"USD",n)})]})]}),e.jsx("div",{className:"tabs",children:e.jsxs("div",{className:"tabs-list",children:[e.jsx("button",{className:j("tab",u==="summary"&&"active"),onClick:()=>b("summary"),children:s("projects.tabs.summary")}),e.jsx("button",{className:j("tab",u==="transactions"&&"active"),onClick:()=>b("transactions"),children:s("projects.tabs.transactions")})]})}),u==="summary"&&e.jsxs("div",{children:[e.jsxs("div",{className:"card",style:{marginBottom:16},children:[e.jsx("h4",{style:{marginBottom:12},children:s("projects.detail.projectDetails")}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("projects.columns.client")}),e.jsx("div",{children:t?.clientName||"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted text-sm",children:s("projects.columns.field")}),e.jsx("div",{children:r.field||"-"})]})]}),r.notes&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{className:"text-muted text-sm",children:s("drawer.project.notes")}),e.jsx("div",{children:r.notes})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:y,children:s("transactions.addTransaction")})]}),u==="transactions"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"filters-row",children:[e.jsx(O,{dateFrom:c.dateFrom,dateTo:c.dateTo,onChange:(a,l)=>M({dateFrom:a,dateTo:l})}),e.jsx($,{value:h,onChange:T}),e.jsx(W,{value:x,onChange:k}),e.jsx(G,{value:v,onChange:F})]}),N.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("projects.detail.noTransactions")}),e.jsx("p",{className:"empty-state-description",children:s("projects.detail.noTransactionsHint")}),e.jsx("button",{className:"btn btn-primary",onClick:y,children:s("transactions.addTransaction")})]}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("transactions.columns.date")}),e.jsx("th",{children:s("transactions.columns.type")}),e.jsx("th",{children:s("transactions.columns.client")}),e.jsx("th",{children:s("transactions.columns.category")}),e.jsx("th",{style:{textAlign:"end"},children:s("transactions.columns.amount")}),e.jsx("th",{children:s("transactions.columns.status")}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:N.map(a=>{const l=a.kind==="income"&&a.status==="unpaid",m=a.dueDate?J(a.dueDate):null,L=m!==null&&m<0;return e.jsxs("tr",{className:"clickable",onClick:()=>U(a.id),children:[e.jsx("td",{children:K(a.occurredAt,n)}),e.jsx("td",{children:e.jsx("span",{className:j("type-badge",a.kind==="expense"&&"expense",a.kind==="income"&&a.status==="paid"&&"income",l&&"receivable"),children:l?s("transactions.type.receivable"):a.kind==="income"?s("transactions.type.income"):s("transactions.type.expense")})}),e.jsx("td",{className:"text-secondary",children:a.clientName||"-"}),e.jsx("td",{className:"text-secondary",children:a.categoryName||"-"}),e.jsxs("td",{className:j("amount-cell",a.kind==="income"&&"amount-positive",a.kind==="expense"&&"amount-negative"),children:[a.kind==="expense"?"-":"",i(a.amountMinor,a.currency,n)]}),e.jsx("td",{children:a.kind==="income"&&e.jsx(e.Fragment,{children:a.status==="paid"?e.jsx("span",{className:"status-badge paid",children:s("transactions.status.paid")}):L?e.jsx("span",{className:"status-badge overdue",children:s("transactions.status.overdue",{days:Math.abs(m)})}):e.jsx("span",{className:"status-badge unpaid",children:m===0?s("transactions.status.dueToday"):s("transactions.status.dueIn",{days:m??0})})})}),e.jsx("td",{children:e.jsx(X,{actions:[...l?[{label:s("common.markPaid"),icon:e.jsx(Q,{size:16}),onClick:()=>D.mutate(a.id)}]:[],{label:s("common.duplicate"),icon:e.jsx(Y,{size:16}),onClick:()=>p({mode:"create",duplicateFromId:a.id})}]})})]},a.id)})})]})})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{title:s("projects.notFound"),breadcrumbs:[{label:s("nav.projects"),href:"/projects"}]}),e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"empty-state",children:[e.jsx("h3",{className:"empty-state-title",children:s("projects.notFound")}),e.jsx("p",{className:"empty-state-description",children:s("projects.notFoundHint")})]})})]})}export{de as ProjectDetailPage};
