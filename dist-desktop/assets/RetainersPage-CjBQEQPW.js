import{r as c,j as e}from"./vendor-router-D4Yqsbqz.js";import{u as w,d as R,a as Z,ax as H,H as q,ay as z,az as G,G as V,aA as J,T as K,c as x,C as Q,S as X,k as g,m as P,aB as Y,aC as _,aD as ee,aE as se,aF as te}from"./index-C9T1eVUk.js";/* empty css              */import{E as ne}from"./EmptyState-r3axvhwz.js";/* empty css                       */import{C as S}from"./CurrencySummaryPopup-CGGE0F85.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";function Ce(){const s=w(),{language:j}=R(),p=P(j),{openRetainerDrawer:n,openRetainerMatchingDrawer:b,selectedRetainerId:l,selectRetainer:f}=Z(),y=H();c.useState(()=>{y.mutate()});const{data:o=[]}=q(),u=c.useMemo(()=>o.find(T=>T.isDefault)?.id||o[0]?.id,[o]),[r,C]=c.useState(void 0),[d,k]=c.useState("all"),[h,M]=c.useState(void 0),[m,i]=c.useState(void 0),[v,E]=c.useState(void 0),[N,F]=c.useState("");c.useEffect(()=>{u&&!r&&C(u)},[u,r]);const B=c.useMemo(()=>{const t={profileId:r,search:N||void 0,currency:m,clientId:v};return d==="due"?t.dueOnly=!0:d==="active"&&(t.status="active"),h&&(t.status=h),t},[r,d,h,m,v,N]),{data:L=[],isLoading:O}=z(B),{data:a}=G(r,m),{data:U=[]}=V(),{data:D}=J(l||""),W=t=>{f(t)},I=()=>{n({mode:"create",defaultProfileId:r})},$=()=>{b({step:"select-transaction"})};return e.jsxs(e.Fragment,{children:[e.jsx(K,{title:s("retainers.title"),rightSlot:e.jsxs("div",{className:"topbar-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:$,children:s("retainers.matchPayment")}),e.jsxs("button",{className:"btn btn-primary",onClick:I,children:["+ ",s("retainers.new")]})]})}),e.jsxs("div",{className:"retainers-layout",children:[e.jsxs("aside",{className:"retainers-filter-panel",children:[o.length>1&&e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("drawer.expense.profile")}),e.jsx("select",{className:"select filter-select",value:r||"",onChange:t=>C(t.target.value||void 0),children:o.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.filters.view")}),e.jsx("div",{className:"filter-radio-group",children:["all","due","active","ending"].map(t=>e.jsxs("label",{className:x("filter-radio",d===t&&"active"),children:[e.jsx("input",{type:"radio",name:"view",checked:d===t,onChange:()=>k(t)}),e.jsx("span",{children:s(`retainers.filters.${t}`)})]},t))})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.filters.status")}),e.jsxs("select",{className:"select filter-select",value:h||"",onChange:t=>M(t.target.value||void 0),children:[e.jsx("option",{value:"",children:s("common.all")}),e.jsx("option",{value:"draft",children:s("retainers.status.draft")}),e.jsx("option",{value:"active",children:s("retainers.status.active")}),e.jsx("option",{value:"paused",children:s("retainers.status.paused")}),e.jsx("option",{value:"ended",children:s("retainers.status.ended")})]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.filters.currency")}),e.jsx(Q,{value:m,onChange:i})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.filters.client")}),e.jsxs("select",{className:"select filter-select",value:v||"",onChange:t=>E(t.target.value||void 0),children:[e.jsx("option",{value:"",children:s("common.all")}),U.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("div",{className:"filter-section",children:e.jsx(X,{value:N,onChange:F,placeholder:s("retainers.searchPlaceholder")})}),a&&e.jsxs("div",{className:"filter-section retainers-summary",children:[e.jsx("h4",{className:"filter-section-title",children:s("retainers.summary")}),e.jsxs("div",{className:"retainers-summary-stat",children:[e.jsx("span",{className:"retainers-summary-label",children:s("retainers.activeCount")}),e.jsx("span",{className:"retainers-summary-value",children:a.activeCount})]}),e.jsx("div",{className:"retainers-summary-stat",children:e.jsx(S,{usdAmountMinor:a.totalExpectedMonthlyUsdMinor,ilsAmountMinor:a.totalExpectedMonthlyIlsMinor,unifiedCurrency:"ILS",type:"income",label:s("retainers.monthlyExpected")})}),e.jsx("div",{className:"retainers-summary-stat",children:e.jsx(S,{usdAmountMinor:a.totalDueUsdMinor,ilsAmountMinor:a.totalDueIlsMinor,unifiedCurrency:"ILS",type:a.totalDueUsdMinor+a.totalDueIlsMinor>0?"expense":"neutral",label:s("retainers.totalDue")})}),a.totalOverdueUsdMinor+a.totalOverdueIlsMinor>0&&e.jsx("div",{className:"retainers-summary-stat",children:e.jsx(S,{usdAmountMinor:a.totalOverdueUsdMinor,ilsAmountMinor:a.totalOverdueIlsMinor,unifiedCurrency:"ILS",type:"expense",label:s("retainers.totalOverdue")})})]})]}),e.jsx("main",{className:"retainers-main",children:O?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):L.length===0?e.jsx(ne,{title:s("retainers.empty"),description:s(N?"retainers.emptySearch":"retainers.emptyHint"),action:N?void 0:{label:s("retainers.addRetainer"),onClick:I}}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("retainers.columns.status")}),e.jsx("th",{children:s("retainers.columns.title")}),e.jsx("th",{children:s("retainers.columns.client")}),e.jsx("th",{children:s("retainers.columns.amount")}),e.jsx("th",{children:s("retainers.columns.cadence")}),e.jsx("th",{children:s("retainers.columns.nextDue")}),e.jsx("th",{children:s("retainers.columns.dueNow")})]})}),e.jsx("tbody",{children:L.map(t=>e.jsxs("tr",{className:x("clickable",l===t.id&&"selected"),onClick:()=>W(t.id),children:[e.jsx("td",{children:e.jsx(A,{status:t.status})}),e.jsx("td",{className:"cell-primary",children:t.title}),e.jsx("td",{children:t.clientName||"-"}),e.jsx("td",{className:"cell-amount",children:g(t.amountMinor,t.currency,p)}),e.jsx("td",{children:e.jsx("span",{className:"cadence-badge",children:s(`retainers.cadence.${t.cadence}`)})}),e.jsx("td",{children:t.nextExpectedDate?new Date(t.nextExpectedDate).toLocaleDateString(p,{month:"short",day:"numeric"}):"-"}),e.jsx("td",{className:x("cell-amount",t.dueNowAmountMinor>0&&"amount-warning"),children:t.dueNowAmountMinor>0?g(t.dueNowAmountMinor,t.currency,p):"-"})]},t.id))})]})})}),e.jsx("aside",{className:x("retainers-inspector",l&&"visible"),children:D?e.jsx(ae,{retainer:D,onClose:()=>f(void 0),onEdit:()=>n({mode:"edit",retainerId:D.id})}):e.jsx("div",{className:"inspector-placeholder",children:e.jsx("p",{children:s("retainers.selectToInspect")})})})]})]})}function A({status:s}){const j=w();return e.jsx("span",{className:x("status-badge",`status-${s}`),children:j(`retainers.status.${s}`)})}function ae({retainer:s,onClose:j,onEdit:p}){const n=w(),{language:b}=R(),l=P(b),{data:f=[]}=Y(s.id),y=_(),o=ee(),u=se(),r=te(),d=[...f].sort((i,v)=>i.expectedDate.localeCompare(v.expectedDate)).slice(-6),k=()=>{confirm(n("retainers.confirmPause"))&&y.mutate(s.id)},h=()=>{o.mutate(s.id)},M=()=>{confirm(n("retainers.confirmEnd"))&&u.mutate(s.id)},m=()=>{r.mutate(s.id)};return e.jsxs("div",{className:"inspector-content",children:[e.jsxs("div",{className:"inspector-header",children:[e.jsx("h3",{className:"inspector-title",children:s.title}),e.jsx("button",{className:"btn-icon",onClick:j,"aria-label":n("common.close"),children:e.jsx(re,{})})]}),e.jsxs("div",{className:"inspector-section",children:[e.jsx("h4",{className:"inspector-section-title",children:n("retainers.inspector.overview")}),e.jsxs("dl",{className:"inspector-details",children:[e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.client")}),e.jsx("dd",{children:s.clientName||n("common.noClient")})]}),s.projectName&&e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.project")}),e.jsx("dd",{children:s.projectName})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.amount")}),e.jsx("dd",{className:"amount-positive",children:g(s.amountMinor,s.currency,l)})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.cadence")}),e.jsx("dd",{children:n(`retainers.cadence.${s.cadence}`)})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.paymentDay")}),e.jsx("dd",{children:s.paymentDay})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.startDate")}),e.jsx("dd",{children:new Date(s.startDate).toLocaleDateString(l)})]}),s.endDate&&e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.endDate")}),e.jsx("dd",{children:new Date(s.endDate).toLocaleDateString(l)})]}),e.jsxs("div",{className:"inspector-detail",children:[e.jsx("dt",{children:n("retainers.inspector.status")}),e.jsx("dd",{children:e.jsx(A,{status:s.status})})]})]})]}),e.jsxs("div",{className:"inspector-section",children:[e.jsx("h4",{className:"inspector-section-title",children:n("retainers.inspector.schedule")}),e.jsx("div",{className:"schedule-timeline",children:d.map(i=>e.jsxs("div",{className:x("schedule-item",`state-${i.state}`),children:[e.jsx("div",{className:"schedule-item-icon",children:e.jsx(ie,{state:i.state})}),e.jsxs("div",{className:"schedule-item-content",children:[e.jsx("span",{className:"schedule-item-date",children:new Date(i.expectedDate).toLocaleDateString(l,{month:"short",year:"numeric"})}),e.jsx("span",{className:"schedule-item-state",children:n(`retainers.state.${i.state}`)})]}),e.jsx("span",{className:"schedule-item-amount",children:g(i.expectedAmountMinor,i.currency,l)})]},i.id))})]}),e.jsxs("div",{className:"inspector-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:p,children:n("common.edit")}),s.status==="draft"&&e.jsx("button",{className:"btn btn-primary",onClick:m,disabled:r.isPending,children:n("retainers.activate")}),s.status==="active"&&e.jsx("button",{className:"btn btn-secondary",onClick:k,disabled:y.isPending,children:n("retainers.pause")}),s.status==="paused"&&e.jsx("button",{className:"btn btn-primary",onClick:h,disabled:o.isPending,children:n("retainers.resume")}),(s.status==="active"||s.status==="paused")&&e.jsx("button",{className:"btn btn-danger",onClick:M,disabled:u.isPending,children:n("retainers.end")})]}),s.notes&&e.jsxs("div",{className:"inspector-section",children:[e.jsx("h4",{className:"inspector-section-title",children:n("retainers.inspector.notes")}),e.jsx("p",{className:"inspector-notes",children:s.notes})]})]})}function ie({state:s}){switch(s){case"received":return e.jsx(ce,{className:"state-icon received"});case"partial":return e.jsx(le,{className:"state-icon partial"});case"due":return e.jsx(oe,{className:"state-icon due"});case"missed":return e.jsx(de,{className:"state-icon missed"});case"canceled":return e.jsx(ue,{className:"state-icon canceled"});default:return e.jsx(he,{className:"state-icon upcoming"})}}function re(){return e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})}function ce({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}function le({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}function oe({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"})})}function de({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})})}function ue({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 0 1 5.636 5.636m12.728 12.728L5.636 5.636"})})}function he({className:s}){return e.jsx("svg",{className:s,width:"16",height:"16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("circle",{cx:"12",cy:"12",r:"9",strokeLinecap:"round",strokeLinejoin:"round"})})}export{Ce as RetainersPage};
