import{j as e,r,f as A}from"./vendor-router-D4Yqsbqz.js";import{u as g,c as j,g as C,a as E,b as R,d as L,e as K,f as B,T as U,D as H,C as z,S as O,h as V,i as W,j as $,k as G,l as Q,m as Z}from"./index-Clb4NbgW.js";import{S as q}from"./StatusSegment-SjdJzshv.js";/* empty css              */import{E as J}from"./EmptyState-r3axvhwz.js";import{R as X}from"./RowActionsMenu-L_ZpjB9G.js";import{C as Y}from"./CopyIcon-VW8NgKZB.js";import"./vendor-react-BdxwsYZ-.js";import"./vendor-query-CI0tl4qS.js";import"./vendor-db-BMy7eggi.js";import"./vendor-forms-CPtPuEGg.js";/* empty css                       */function _({value:i,onChange:o}){const c=g(),a=[{value:void 0,labelKey:"filters.type.all"},{value:"income",labelKey:"filters.type.income"},{value:"receivable",labelKey:"filters.type.receivable"},{value:"expense",labelKey:"filters.type.expense"}];return e.jsx("div",{className:"segment-control",children:a.map(s=>e.jsx("button",{className:j("segment-button",i===s.value&&"active"),onClick:()=>o(s.value),children:c(s.labelKey)},s.labelKey))})}function ee({size:i=16,className:o}){return e.jsx("svg",{width:i,height:i,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:o,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})})}function te({kind:i,status:o,dueDate:c}){const a=g();if(i!=="income")return null;if(o==="paid")return e.jsx("span",{className:"status-badge paid",children:a("transactions.status.paid")});const s=c?C(c):null;return s!==null&&s<0?e.jsx("span",{className:"status-badge overdue",children:a("transactions.status.overdue",{days:Math.abs(s)})}):e.jsx("span",{className:"status-badge unpaid",children:s===0?a("transactions.status.dueToday"):a("transactions.status.dueIn",{days:s??0})})}function ae(i){const[o,c]=r.useState(()=>typeof window<"u"&&window.matchMedia(i).matches);return r.useEffect(()=>{if(typeof window>"u")return;const a=window.matchMedia(i),s=u=>c(u.matches);return Promise.resolve().then(()=>{c(a.matches)}),a.addEventListener("change",s),()=>a.removeEventListener("change",s)},[i]),o}function se(){return ae("(max-width: 768px)")}function je(){const{openTransactionDrawer:i,openDocumentDrawer:o}=E(),c=R(),a=g(),{language:s}=L(),u=Z(s),n=A({strict:!1}),[m,w]=r.useState(()=>n.dateFrom&&n.dateTo?{dateFrom:n.dateFrom,dateTo:n.dateTo}:K("all")),[v,T]=r.useState(n.currency),k=r.useMemo(()=>n.kind==="income"&&n.status==="unpaid"?"receivable":n.kind,[n.kind,n.status]),[d,D]=r.useState(k),[p,S]=r.useState(k==="receivable"?void 0:n.status),[h,N]=r.useState(""),[x,I]=r.useState(!1);r.useEffect(()=>{!x&&(n.dateFrom||n.currency||n.kind)&&I(!0)},[x,n]);const F=r.useMemo(()=>{const t={dateFrom:m.dateFrom,dateTo:m.dateTo,currency:v,search:h||void 0,sort:{by:"occurredAt",dir:"desc"}};return d==="receivable"?(t.kind="income",t.status="unpaid"):d&&(t.kind=d),p&&d!=="receivable"&&(t.status=p),t},[m,v,d,p,h]),{data:b=[],isLoading:M}=B(F),l=se(),y=t=>t.kind!=="income"?null:t.status==="paid"?"paid":t.dueDate&&C(t.dueDate)<0?"overdue":"unpaid",P=t=>{i({mode:"edit",transactionId:t})};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:a("transactions.title"),filterSlot:e.jsxs("div",{className:"filters-row",style:{marginBottom:0,marginInlineStart:24,flexWrap:"nowrap"},children:[e.jsx(H,{dateFrom:m.dateFrom,dateTo:m.dateTo,onChange:(t,f)=>w({dateFrom:t,dateTo:f})}),e.jsx(z,{value:v,onChange:T})]})}),e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"filters-row",children:[e.jsx(_,{value:d,onChange:D}),e.jsx(q,{value:p,onChange:S}),e.jsx(O,{value:h,onChange:N,placeholder:a("transactions.searchPlaceholder")})]}),M?e.jsx("div",{className:"loading",children:e.jsx("div",{className:"spinner"})}):b.length===0?e.jsx(J,{title:a("transactions.empty"),description:a(h?"transactions.emptySearch":"transactions.emptyHint"),action:{label:a("transactions.addTransaction"),onClick:()=>i({mode:"create"})}}):e.jsx("div",{className:"data-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a("transactions.columns.date")}),e.jsx("th",{children:a("transactions.columns.type")}),e.jsx("th",{children:a("transactions.columns.client")}),e.jsx("th",{children:a("transactions.columns.project")}),e.jsx("th",{style:{textAlign:"end"},children:a("transactions.columns.amount")}),!l&&e.jsx("th",{children:a("transactions.columns.status")}),e.jsx("th",{style:{width:40}})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{className:"clickable",onClick:()=>P(t.id),children:[e.jsxs("td",{className:l?"date-cell-compact":void 0,children:[l&&y(t)&&e.jsx("span",{className:"status-dot","data-status":y(t),"aria-label":y(t)||void 0}),l?V(t.occurredAt):W(t.occurredAt,u)]}),e.jsx("td",{children:e.jsx($,{kind:t.kind,status:t.status})}),e.jsx("td",{className:j("text-secondary",l&&"text-sm-responsive"),children:t.clientName||"-"}),e.jsx("td",{className:j("text-secondary",l&&"text-sm-responsive"),children:t.projectName||"-"}),e.jsxs("td",{className:j("amount-cell",t.kind==="income"&&"amount-positive",t.kind==="expense"&&"amount-negative"),children:[t.kind==="expense"?"-":"",G(t.amountMinor,t.currency,u)]}),!l&&e.jsx("td",{children:e.jsx(te,{kind:t.kind,status:t.status,dueDate:t.dueDate})}),e.jsxs("td",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx(X,{actions:[...t.kind==="income"&&t.status==="unpaid"?[{label:a("common.markPaid"),icon:e.jsx(Q,{size:16}),onClick:()=>c.mutate(t.id)}]:[],{label:a("common.duplicate"),icon:e.jsx(Y,{size:16}),onClick:()=>i({mode:"create",duplicateFromId:t.id})},...t.kind==="income"&&!t.linkedDocumentId?[{label:"Generate Invoice",onClick:()=>o({mode:"create",defaultType:t.status==="paid"?"receipt":"invoice",defaultClientId:t.clientId})}]:[],...t.linkedDocumentId?[{label:"View Invoice",onClick:()=>{window.location.href=`/documents/${t.linkedDocumentId}`}}]:[]]}),t.linkedDocumentId&&e.jsx("span",{className:"doc-indicator",title:a("transactions.hasDocument"),onClick:f=>{f.stopPropagation(),window.location.href=`/documents/${t.linkedDocumentId}`},children:e.jsx(ee,{size:14})}),t.notes&&e.jsx("span",{className:"note-indicator",title:a("drawer.transaction.notes")})]})]},t.id))})]})})]})]})}export{je as TransactionsPage};
